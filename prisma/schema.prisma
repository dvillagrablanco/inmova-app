generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model B2BFinancialReport {
  id                 String   @id
  periodo            String   @unique
  tipoReporte        String
  ingresosBrutos     Float
  descuentosTotal    Float
  impuestosTotal     Float
  ingresosNetos      Float
  empresasActivas    Int
  empresasNuevas     Int
  empresasCanceladas Int
  tasaRetencion      Float
  facturasEmitidas   Int
  facturasPagadas    Int
  facturasVencidas   Int
  ticketPromedio     Float
  crecimientoMoM     Float?
  crecimientoYoY     Float?
  detalles           Json
  fechaGeneracion    DateTime @default(now())

  @@index([periodo])
  @@index([tipoReporte])
}

model B2BInvoice {
  id                    String              @id
  companyId             String
  numeroFactura         String              @unique
  fechaEmision          DateTime            @default(now())
  fechaVencimiento      DateTime
  periodo               String
  subscriptionPlanId    String?
  subtotal              Float
  descuento             Float               @default(0)
  impuestos             Float
  total                 Float
  estado                InvoiceStatus       @default(PENDIENTE)
  metodoPago            String?
  fechaPago             DateTime?
  stripeInvoiceId       String?             @unique
  stripePaymentIntentId String?
  stripePdfUrl          String?
  conceptos             Json
  notas                 String?
  terminosPago          String?             @default("30 días")
  recordatoriosEnviados Int                 @default(0)
  ultimoRecordatorio    DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime
  company               company             @relation(fields: [companyId], references: [id])
  subscription_plans    subscription_plans? @relation(fields: [subscriptionPlanId], references: [id])

  @@index([companyId])
  @@index([estado])
  @@index([fechaEmision])
}

model B2BPaymentHistory {
  id              String   @id
  companyId       String
  invoiceId       String?
  monto           Float
  metodoPago      String
  fechaPago       DateTime @default(now())
  referencia      String?
  stripePaymentId String?  @unique
  stripeChargeId  String?
  stripeFee       Float?
  stripeNetAmount Float?
  estado          String
  notas           String?
  createdAt       DateTime @default(now())
  company         company  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([fechaPago])
  @@index([invoiceId])
}

model B2BSubscriptionHistory {
  id             String   @id
  companyId      String
  accion         String
  planAnteriorId String?
  planNuevoId    String?
  fechaCambio    DateTime @default(now())
  razon          String?
  costoAdicional Float?
  realizadoPor   String?
  createdAt      DateTime @default(now())
  company        company  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([fechaCambio])
}

model BankConsent {
  id               String           @id
  connectionId     String
  consentId        String           @unique
  status           String
  scaRedirectUrl   String?
  validUntil       String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  bank_connections bank_connections @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId])
  @@index([status])
}

model BankPayment {
  id               String           @id
  connectionId     String
  paymentId        String           @unique
  amount           String
  currency         String
  debtorIban       String
  creditorIban     String
  creditorName     String
  description      String?
  status           String
  scaRedirectUrl   String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  bank_connections bank_connections @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId])
  @@index([status])
}

model ColivingActivityPost {
  id              String          @id
  companyId       String
  buildingId      String?
  profileId       String
  tipo            String
  contenido       String
  imagenes        Json?
  hashtags        Json?
  likes           Json            @default("[]")
  comentarios     Json            @default("[]")
  visibilidad     String          @default("comunidad")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  buildings       buildings?      @relation(fields: [buildingId], references: [id])
  company         company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingProfile ColivingProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([companyId])
  @@index([profileId])
}

model ColivingCheckInOut {
  id                    String    @id
  tenantId              String
  companyId             String
  unitId                String
  roomId                String?
  tipo                  String
  metodo                String
  fechaProgramada       DateTime
  fechaReal             DateTime?
  estado                String    @default("pendiente")
  documentosVerificados Boolean   @default(false)
  firmaDigital          String?
  codigoAcceso          String?
  inventarioEntrada     Json?
  inventarioSalida      Json?
  fotosEntrada          Json?
  fotosSalida           Json?
  llaveDigitalEnviada   Boolean   @default(false)
  llaveDigitalActiva    Boolean   @default(false)
  notas                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  company               company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  rooms                 rooms?    @relation(fields: [roomId], references: [id])
  tenants               tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  units                 units     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([roomId])
  @@index([tenantId])
  @@index([unitId])
}

model ColivingEvent {
  id                      String                    @id
  companyId               String
  buildingId              String?
  groupId                 String?
  titulo                  String
  descripcion             String
  tipo                    String
  fecha                   DateTime
  duracion                Int
  ubicacion               String
  capacidad               Int?
  requiereInscripcion     Boolean                   @default(false)
  costo                   Float?                    @default(0)
  organizador             String
  imagen                  String?
  etiquetas               Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  buildings               buildings?                @relation(fields: [buildingId], references: [id])
  company                 company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingGroup           ColivingGroup?            @relation(fields: [groupId], references: [id])
  ColivingEventAttendance ColivingEventAttendance[]

  @@index([buildingId])
  @@index([companyId])
  @@index([groupId])
}

model ColivingEventAttendance {
  id              String          @id
  eventId         String
  profileId       String
  estado          String          @default("confirmado")
  notas           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  ColivingEvent   ColivingEvent   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  ColivingProfile ColivingProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([eventId, profileId])
  @@index([eventId])
  @@index([profileId])
}

model ColivingGroup {
  id                  String                @id
  companyId           String
  buildingId          String?
  nombre              String
  descripcion         String
  categoria           String
  icono               String?
  imagen              String?
  esPublico           Boolean               @default(true)
  maxMiembros         Int?
  reglas              String?
  adminId             String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  ColivingEvent       ColivingEvent[]
  buildings           buildings?            @relation(fields: [buildingId], references: [id])
  company             company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingGroupMember ColivingGroupMember[]

  @@index([buildingId])
  @@index([companyId])
}

model ColivingGroupMember {
  id              String          @id
  groupId         String
  profileId       String
  rol             String          @default("miembro")
  fechaUnion      DateTime        @default(now())
  activo          Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  ColivingGroup   ColivingGroup   @relation(fields: [groupId], references: [id], onDelete: Cascade)
  ColivingProfile ColivingProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([groupId, profileId])
  @@index([groupId])
  @@index([profileId])
}

model ColivingMatch {
  id                  String          @id
  profile1Id          String
  profile2Id          String
  companyId           String
  scoreCompatibilidad Int
  interesesComunes    Json
  estado              String          @default("sugerido")
  mensajeIntroduccion String?
  fechaMatch          DateTime        @default(now())
  fechaAceptacion     DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  company             company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingProfile     ColivingProfile @relation(fields: [profile1Id], references: [id], onDelete: Cascade)

  @@unique([profile1Id, profile2Id])
  @@index([companyId])
  @@index([profile1Id])
}

model ColivingPackage {
  id                    String    @id
  companyId             String
  tenantId              String
  buildingId            String
  numeroSeguimiento     String?
  remitente             String
  empresa               String?
  fechaLlegada          DateTime  @default(now())
  fechaRecogida         DateTime?
  estado                String    @default("pendiente")
  ubicacionAlmacen      String?
  tamano                String?
  requiereRefrigeracion Boolean   @default(false)
  requiereFirma         Boolean   @default(false)
  fotoComprobante       String?
  notificado            Boolean   @default(false)
  notas                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  buildings             buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company               company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants               tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([tenantId])
}

model ColivingProfile {
  id                      String                    @id
  tenantId                String                    @unique
  companyId               String
  bio                     String?
  intereses               Json
  profesion               String?
  idiomas                 Json
  redesSociales           Json?
  buscoCompa_eros         Boolean                   @default(true) @map("buscoCompañeros")
  interesCompartir        Json
  disponibilidad          Json
  puntosReputacion        Int                       @default(0)
  nivel                   String                    @default("bronce")
  badges                  Json                      @default("[]")
  perfilPublico           Boolean                   @default(true)
  mostrarContacto         Boolean                   @default(false)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  ColivingActivityPost    ColivingActivityPost[]
  ColivingEventAttendance ColivingEventAttendance[]
  ColivingGroupMember     ColivingGroupMember[]
  ColivingMatch           ColivingMatch[]
  company                 company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants                 tenants                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([tenantId])
}

model ColivingService {
  id                     String                   @id
  companyId              String
  nombre                 String
  descripcion            String
  categoria              String
  icono                  String?
  precioBase             Float
  unidad                 String
  duracion               Int?
  disponible             Boolean                  @default(true)
  proveedorExterno       String?
  contactoProveedor      String?
  imagenes               Json?
  requisitos             String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  company                company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingServiceBooking ColivingServiceBooking[]

  @@index([categoria])
  @@index([companyId])
}

model ColivingServiceBooking {
  id                      String          @id
  serviceId               String
  tenantId                String
  companyId               String
  fechaServicio           DateTime
  horaInicio              String
  duracion                Int
  ubicacion               String
  estado                  String          @default("pendiente")
  precioTotal             Float
  notas                   String?
  instruccionesEspeciales String?
  valoracion              Int?
  comentario              String?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime
  company                 company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ColivingService         ColivingService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  tenants                 tenants         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fechaServicio])
  @@index([serviceId])
  @@index([tenantId])
}

model Commission {
  id              String           @id
  partnerId       String
  companyId       String
  periodo         String
  montoBruto      Float
  porcentaje      Float
  montoComision   Float
  planId          String?
  planNombre      String?
  estado          CommissionStatus @default(PENDING)
  fechaAprobacion DateTime?
  fechaPago       DateTime?
  referenciaPago  String?
  clientesActivos Int
  notas           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  company         company          @relation(fields: [companyId], references: [id])
  Partner         Partner          @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, companyId, periodo])
  @@index([companyId])
  @@index([estado])
  @@index([partnerId])
  @@index([periodo])
}

model MarketingMaterial {
  id               String             @id
  tipo             String
  titulo           String
  descripcion      String
  url              String?
  contenido        String?
  tags             String[]
  activo           Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  MaterialDownload MaterialDownload[]

  @@index([activo])
  @@index([tipo])
}

model MaterialDownload {
  id                  String              @id
  salesRepId          String
  materialId          String
  fechaDescarga       DateTime            @default(now())
  MarketingMaterial   MarketingMaterial   @relation(fields: [materialId], references: [id], onDelete: Cascade)
  SalesRepresentative SalesRepresentative @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@index([materialId])
  @@index([salesRepId])
}

model OnboardingProgress {
  id             String    @id
  userId         String
  companyId      String
  vertical       String    @default("residencial")
  currentStep    Int       @default(0)
  totalSteps     Int       @default(0)
  completedSteps Json      @default("[]")
  startedAt      DateTime  @default(now())
  lastActivityAt DateTime  @default(now())
  completedAt    DateTime?
  company        company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users          users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([userId])
}

model Partner {
  id                   String              @id
  nombre               String
  razonSocial          String
  cif                  String              @unique
  tipo                 PartnerType         @default(BANCO)
  contactoNombre       String
  contactoEmail        String              @unique
  contactoTelefono     String?
  email                String              @unique
  password             String
  logo                 String?
  coloresPrimarios     Json?
  dominioPersonalizado String?             @unique
  comisionPorcentaje   Float               @default(20.0)
  umbralComision       Int                 @default(1)
  estado               PartnerStatus       @default(PENDING)
  activo               Boolean             @default(true)
  fechaActivacion      DateTime?
  config               Json                @default("{}")
  notas                String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  Commission           Commission[]
  PartnerClient        PartnerClient[]
  PartnerInvitation    PartnerInvitation[]

  @@index([email])
  @@index([estado])
  @@index([tipo])
}

model PartnerCertification {
  id                          String                        @id
  nombre                      String
  descripcion                 String
  nivel                       String
  requisitos                  String[]
  beneficios                  String[]
  activo                      Boolean                       @default(true)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  PartnerCertificationAwarded PartnerCertificationAwarded[]

  @@index([activo])
  @@index([nivel])
}

model PartnerCertificationAwarded {
  id                   String               @id
  salesRepId           String
  certificationId      String
  fechaObtencion       DateTime             @default(now())
  certificadoNumero    String               @unique
  PartnerCertification PartnerCertification @relation(fields: [certificationId], references: [id], onDelete: Cascade)
  SalesRepresentative  SalesRepresentative  @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@index([certificationId])
  @@index([salesRepId])
}

model PartnerClient {
  id                    String    @id
  partnerId             String
  companyId             String
  estado                String    @default("activo")
  fechaActivacion       DateTime  @default(now())
  fechaCancelacion      DateTime?
  origenInvitacion      String?
  codigoReferido        String?
  totalComisionGenerada Float     @default(0)
  ultimaComisionFecha   DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  company               company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Partner               Partner   @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, companyId])
  @@index([companyId])
  @@index([estado])
  @@index([partnerId])
}

model PartnerInvitation {
  id            String                  @id
  partnerId     String
  email         String
  nombre        String?
  telefono      String?
  token         String                  @unique
  mensaje       String?
  estado        PartnerInvitationStatus @default(PENDING)
  enviadoFecha  DateTime                @default(now())
  aceptadoFecha DateTime?
  expiraFecha   DateTime
  companyId     String?
  metadata      Json                    @default("{}")
  createdAt     DateTime                @default(now())
  updatedAt     DateTime
  Partner       Partner                 @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([estado])
  @@index([partnerId])
  @@index([token])
}

model PasswordResetToken {
  id        String    @id
  tenantId  String
  token     String    @unique
  expiresAt DateTime
  used      Boolean   @default(false)
  createdAt DateTime  @default(now())
  usedAt    DateTime?
  tenants   tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([tenantId])
  @@index([token])
}

model SalesCommission {
  id                  String                @id
  salesRepId          String
  leadId              String?
  companyId           String?
  tipo                SalesCommissionType
  descripcion         String
  periodo             String?
  montoBase           Float
  porcentaje          Float?
  montoComision       Float
  retencionIRPF       Float                 @default(0)
  montoNeto           Float
  estado              SalesCommissionStatus @default(PENDIENTE)
  fechaGeneracion     DateTime              @default(now())
  fechaAprobacion     DateTime?
  fechaPago           DateTime?
  aprobadoPor         String?
  notaAprobacion      String?
  referenciaPago      String?
  metodoPago          String?
  comprobantePago     String?
  metadata            Json                  @default("{}")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  SalesLead           SalesLead?            @relation(fields: [leadId], references: [id])
  SalesRepresentative SalesRepresentative   @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([fechaGeneracion])
  @@index([leadId])
  @@index([periodo])
  @@index([salesRepId])
}

model SalesLead {
  id                   String              @id
  salesRepId           String
  nombreContacto       String
  emailContacto        String
  telefonoContacto     String?
  nombreEmpresa        String
  sector               String?
  tipoCliente          String?
  propiedadesEstimadas Int?
  presupuestoMensual   Float?
  estado               LeadStatus          @default(NUEVO)
  prioridad            String              @default("media")
  probabilidadCierre   Int                 @default(50)
  fechaCaptura         DateTime            @default(now())
  fechaPrimerContacto  DateTime?
  fechaUltimoContacto  DateTime?
  proximoSeguimiento   DateTime?
  origenCaptura        String?
  codigoRastreo        String?
  numeroLlamadas       Int                 @default(0)
  numeroEmails         Int                 @default(0)
  numeroReuniones      Int                 @default(0)
  convertido           Boolean             @default(false)
  fechaConversion      DateTime?
  companyId            String?
  planSuscrito         String?
  valorMensual         Float?
  notas                String?
  motivoRechazo        String?
  metadata             Json                @default("{}")
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  SalesCommission      SalesCommission[]
  company              company?            @relation(fields: [companyId], references: [id])
  SalesRepresentative  SalesRepresentative @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([convertido])
  @@index([estado])
  @@index([fechaCaptura])
  @@index([salesRepId])
}

model SalesRepresentative {
  id                          String                        @id
  nombre                      String
  apellidos                   String
  nombreCompleto              String
  dni                         String                        @unique
  email                       String                        @unique
  telefono                    String
  telefonoSecundario          String?
  numeroAutonomo              String?
  iban                        String?
  direccion                   String?
  ciudad                      String?
  codigoPostal                String?
  pais                        String                        @default("España")
  codigoReferido              String                        @unique
  comisionCaptacion           Float                         @default(150.0)
  comisionRecurrente          Float                         @default(10.0)
  bonificacionObjetivo        Float                         @default(500.0)
  objetivoLeadsMes            Int                           @default(10)
  objetivoConversionesMes     Int                           @default(2)
  password                    String
  ultimoAcceso                DateTime?
  estado                      SalesRepStatus                @default(ACTIVO)
  activo                      Boolean                       @default(true)
  fechaAlta                   DateTime                      @default(now())
  fechaBaja                   DateTime?
  motivoBaja                  String?
  totalLeadsGenerados         Int                           @default(0)
  totalConversiones           Int                           @default(0)
  totalComisionGenerada       Float                         @default(0)
  tasaConversion              Float                         @default(0)
  notas                       String?
  documentacion               String?
  apiKey                      String?                       @unique
  apiSecret                   String?
  apiEnabled                  Boolean                       @default(false)
  whiteLabelEnabled           Boolean                       @default(false)
  whiteLabelConfig            Json?
  nivel                       Int                           @default(1)
  parentSalesRepId            String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  companyId                   String                        @default("global")
  MaterialDownload            MaterialDownload[]
  PartnerCertificationAwarded PartnerCertificationAwarded[]
  SalesCommission             SalesCommission[]
  SalesLead                   SalesLead[]
  SalesRepresentative         SalesRepresentative?          @relation("SalesRepresentativeToSalesRepresentative", fields: [parentSalesRepId], references: [id])
  other_SalesRepresentative   SalesRepresentative[]         @relation("SalesRepresentativeToSalesRepresentative")
  SalesTarget                 SalesTarget[]

  @@index([activo])
  @@index([apiKey])
  @@index([codigoReferido])
  @@index([email])
  @@index([estado])
  @@index([parentSalesRepId])
}

model SalesTarget {
  id                     String              @id
  salesRepId             String
  periodo                String
  tipoObjetivo           String
  objetivoLeads          Int
  objetivoConversiones   Int
  objetivoMRR            Float
  leadsGenerados         Int                 @default(0)
  conversionesLogradas   Int                 @default(0)
  mrrGenerado            Float               @default(0)
  porcentajeLeads        Float               @default(0)
  porcentajeConversiones Float               @default(0)
  porcentajeMRR          Float               @default(0)
  cumplido               Boolean             @default(false)
  bonificacionPagada     Boolean             @default(false)
  montoBonificacion      Float?
  fechaInicio            DateTime
  fechaFin               DateTime
  createdAt              DateTime            @default(now())
  updatedAt              DateTime
  SalesRepresentative    SalesRepresentative @relation(fields: [salesRepId], references: [id], onDelete: Cascade)

  @@unique([salesRepId, periodo])
  @@index([cumplido])
  @@index([periodo])
  @@index([salesRepId])
}

model ServiceRating {
  id             String            @id
  companyId      String
  tenantId       String
  tipo           ServiceRatingType
  puntuacion     Int
  comentario     String?
  visible        Boolean           @default(true)
  respuestaAdmin String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  company        company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants        tenants           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([puntuacion])
  @@index([tenantId])
  @@index([tipo])
}

model SmartLock {
  id                String            @id
  companyId         String
  buildingId        String
  unitId            String?
  roomId            String?
  nombre            String
  ubicacion         String
  marca             String
  modelo            String
  numeroSerie       String            @unique
  apiEndpoint       String?
  apiKey            String?
  estado            String            @default("activo")
  bateria           Int?
  conectado         Boolean           @default(true)
  ultimaConexion    DateTime?
  modoAcceso        String            @default("codigo")
  autoBloqueo       Boolean           @default(true)
  tiempoAutoBloqueo Int               @default(30)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  buildings         buildings         @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company           company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  rooms             rooms?            @relation(fields: [roomId], references: [id])
  units             units?            @relation(fields: [unitId], references: [id])
  SmartLockAccess   SmartLockAccess[]

  @@index([buildingId])
  @@index([companyId])
  @@index([roomId])
  @@index([unitId])
}

model SmartLockAccess {
  id               String    @id
  lockId           String
  tenantId         String
  tipoAcceso       String
  codigoAcceso     String?
  fechaInicio      DateTime
  fechaFin         DateTime?
  activo           Boolean   @default(true)
  usosPermitidos   Int?
  usosRealizados   Int       @default(0)
  ultimoAcceso     DateTime?
  historialAccesos Json      @default("[]")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  SmartLock        SmartLock @relation(fields: [lockId], references: [id], onDelete: Cascade)
  tenants          tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([lockId])
  @@index([tenantId])
}

model SupportTicket {
  id            String          @id
  userId        String
  companyId     String
  category      String
  priority      String
  status        String          @default("open")
  subject       String
  description   String
  tags          Json            @default("[]")
  autoResolved  Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  resolvedAt    DateTime?
  company       company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users         users           @relation(fields: [userId], references: [id], onDelete: Cascade)
  TicketMessage TicketMessage[]

  @@index([category])
  @@index([companyId])
  @@index([priority])
  @@index([status])
  @@index([userId])
}

model TenantInvitation {
  id             String           @id
  companyId      String
  tenantId       String           @unique
  email          String
  invitationCode String           @unique
  status         InvitationStatus @default(pendiente)
  expiresAt      DateTime
  createdBy      String
  createdAt      DateTime         @default(now())
  acceptedAt     DateTime?
  company        company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users          users            @relation(fields: [createdBy], references: [id])
  tenants        tenants          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([email])
  @@index([invitationCode])
  @@index([status])
  @@index([tenantId])
}

model TenantOnboarding {
  id          String    @id
  tenantId    String    @unique
  completed   Boolean   @default(false)
  currentStep Int       @default(0)
  totalSteps  Int       @default(5)
  steps       Json
  createdAt   DateTime  @default(now())
  completedAt DateTime?
  tenants     tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([completed])
  @@index([tenantId])
}

model TicketMessage {
  id            String        @id
  ticketId      String
  sender        String
  message       String
  isAutomatic   Boolean       @default(false)
  createdAt     DateTime      @default(now())
  SupportTicket SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
}

model accounting_transactions {
  id            String             @id
  companyId     String
  buildingId    String?
  unitId        String?
  tipo          TransactionType
  categoria     AccountingCategory
  concepto      String
  monto         Float
  fecha         DateTime
  referencia    String?
  paymentId     String?
  expenseId     String?
  documentoPath String?
  notas         String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime

  @@index([buildingId])
  @@index([categoria])
  @@index([companyId])
  @@index([fecha])
  @@index([tipo])
}

model ai_commands {
  id               String           @id
  conversationId   String
  comando          String
  parametros       Json?
  funcion          String
  resultado        Json?
  exitoso          Boolean          @default(false)
  error            String?
  ejecutadoPor     String?
  createdAt        DateTime         @default(now())
  ai_conversations ai_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
}

model ai_conversations {
  id           String        @id
  companyId    String
  userId       String?
  tenantId     String?
  canal        String        @default("web")
  idioma       String        @default("es")
  contexto     Json?
  memoria      Json?
  estado       String        @default("activa")
  sentimiento  String?
  satisfaccion Int?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  ai_commands  ai_commands[]
  company      company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants      tenants?      @relation(fields: [tenantId], references: [id])
  users        users?        @relation(fields: [userId], references: [id])
  ai_messages  ai_messages[]

  @@index([companyId, estado])
}

model ai_messages {
  id               String           @id
  conversationId   String
  rol              String
  contenido        String
  tokenUsados      Int?
  modelo           String?          @default("gpt-4-turbo")
  funciones        Json?
  timestamp        DateTime         @default(now())
  ai_conversations ai_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
}

model ambassadors {
  id                  String     @id
  companyId           String
  tenantId            String     @unique
  buildingId          String?
  fechaNombramiento   DateTime   @default(now())
  referidos           Int        @default(0)
  referidosActivos    Int        @default(0)
  comisionGanada      Float      @default(0)
  comisionPorReferido Float      @default(50)
  estado              String     @default("activo")
  capacitaciones      Json?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  buildings           buildings? @relation(fields: [buildingId], references: [id])
  company             company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants             tenants    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
}

model analytics_snapshots {
  id                     String   @id
  companyId              String
  fecha                  DateTime @default(now())
  periodo                String
  totalUnidades          Int
  unidadesOcupadas       Int
  unidadesVacantes       Int
  tasaOcupacion          Float
  ingresosMensuales      Float
  gastosMensuales        Float
  ingresoNeto            Float
  morosidad              Float
  tasaMorosidad          Float
  contratosPorVencer     Int
  mantenimientoPendiente Int
  ticketPromedio         Float
  createdAt              DateTime @default(now())

  @@index([companyId])
  @@index([fecha])
  @@index([periodo])
}

model announcement_confirmations {
  id                String    @id
  announcementId    String
  tenantId          String?
  userId            String?
  leido             Boolean   @default(false)
  fechaLectura      DateTime?
  confirmado        Boolean   @default(false)
  fechaConfirmacion DateTime?
  createdAt         DateTime  @default(now())
  tenants           tenants?  @relation(fields: [tenantId], references: [id])

  @@unique([announcementId, tenantId])
  @@unique([announcementId, userId])
  @@index([announcementId])
}

model approvals {
  id                   String                @id
  tipo                 ApprovalType
  entityId             String
  expenseId            String?
  maintenanceId        String?
  solicitadoPor        String
  revisadoPor          String?
  estado               ApprovalStatus        @default(pendiente)
  monto                Float?
  motivo               String?
  comentarioRechazo    String?
  fechaSolicitud       DateTime              @default(now())
  fechaRevision        DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  expenses             expenses?             @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  maintenance_requests maintenance_requests? @relation(fields: [maintenanceId], references: [id], onDelete: Cascade)
}

model ar_visualizations {
  id             String   @id
  companyId      String
  unitId         String
  nombre         String
  descripcion    String?
  tipo           String
  escenaBefore   Json?
  escenaAfter    Json
  elementos      Json?
  costoEstimado  Float?
  tiempoEstimado Int?
  estado         String   @default("borrador")
  compartidaCon  Json?
  creadoPor      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  company        company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units          units    @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model audit_logs {
  id         String      @id
  companyId  String
  userId     String
  action     AuditAction
  entityType String
  entityId   String?
  entityName String?
  changes    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime    @default(now())
  company    company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users      users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId, createdAt])
  @@index([entityType, entityId])
  @@index([userId, createdAt])
}

model audit_reports {
  id                String   @id
  companyId         String
  titulo            String
  descripcion       String?
  tipoReporte       String
  fechaInicio       DateTime
  fechaFin          DateTime
  filtros           Json?
  totalEventos      Int      @default(0)
  eventosError      Int      @default(0)
  eventosCriticos   Int      @default(0)
  usuariosAfectados Int      @default(0)
  generadoPor       String
  reportPath        String?
  createdAt         DateTime @default(now())

  @@index([companyId])
  @@index([createdAt])
  @@index([tipoReporte])
}

model automatic_reminders {
  id               String            @id
  companyId        String
  nombre           String
  descripcion      String?
  tipo             ReminderType
  channel          ReminderChannel   @default(email)
  frequency        ReminderFrequency @default(once)
  diasAnticipacion Int               @default(7)
  horaEnvio        String            @default("09:00")
  enviarA          String[]
  conditions       Json?
  entityType       String?
  tituloPlantilla  String
  mensajePlantilla String
  variables        String[]          @default([])
  activo           Boolean           @default(true)
  ultimoEnvio      DateTime?
  proximoEnvio     DateTime?
  totalEnviados    Int               @default(0)
  creadoPor        String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  company          company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([activo])
  @@index([companyId])
  @@index([proximoEnvio])
  @@index([tipo])
}

model automation_executions {
  id           String      @id
  automationId String
  companyId    String
  estado       String
  mensaje      String?
  detalles     Json?
  duracion     Int?
  contexto     Json?
  ejecutadaEn  DateTime    @default(now())
  automations  automations @relation(fields: [automationId], references: [id], onDelete: Cascade)
  company      company     @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([automationId])
  @@index([companyId, ejecutadaEn])
  @@index([estado])
}

model automation_templates {
  id          String   @id
  nombre      String
  descripcion String
  categoria   String
  icono       String?
  plantilla   Json
  parametros  Json?
  vertical    String?
  nivelAcceso String   @default("todos")
  popular     Boolean  @default(false)
  vecesUsada  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([categoria])
  @@index([popular])
  @@index([vertical])
}

model automations {
  id                    String                  @id
  companyId             String
  userId                String?
  nombre                String
  descripcion           String?
  tipo                  String
  plantillaId           String?
  triggerType           String
  triggerConfig         Json
  condiciones           Json?
  acciones              Json
  activa                Boolean                 @default(true)
  prioridad             String                  @default("media")
  notificarEjecucion    Boolean                 @default(false)
  vecesEjecutada        Int                     @default(0)
  ultimaEjecucion       DateTime?
  proximaEjecucion      DateTime?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  automation_executions automation_executions[]
  company               company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users                 users?                  @relation(fields: [userId], references: [id])

  @@index([companyId, activa])
  @@index([proximaEjecucion])
  @@index([tipo])
  @@index([userId])
}

model bad_debt_provisions {
  id                  String    @id
  companyId           String
  paymentId           String    @unique
  montoOriginal       Float
  diasRetraso         Int
  categoriaRiesgo     RiskLevel
  porcentajeProvision Float
  montoProvision      Float
  gestionado          Boolean   @default(false)
  recuperado          Boolean   @default(false)
  montoRecuperado     Float     @default(0)
  fechaRecuperacion   DateTime?
  metodosGestion      Json?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  company             company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  payments            payments  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([companyId, categoriaRiesgo])
  @@index([gestionado, recuperado])
}

model badges {
  id                 String             @id
  reputationId       String
  codigo             String
  nombre             String
  descripcion        String?
  icono              String?
  obtenidoEn         DateTime           @default(now())
  tenant_reputations tenant_reputations @relation(fields: [reputationId], references: [id], onDelete: Cascade)

  @@index([reputationId])
}

model bank_connections {
  id                String               @id
  userId            String?
  companyId         String?
  tenantId          String?
  proveedor         String
  provider          String?
  proveedorItemId   String?              @unique
  accessToken       String?
  refreshToken      String?
  expiresAt         DateTime?
  scope             String?
  consentId         String?              @unique
  consentValidUntil DateTime?
  nombreBanco       String?
  tipoCuenta        String?
  ultimosDigitos    String?
  moneda            String               @default("EUR")
  estado            BankConnectionStatus @default(conectado)
  status            String?
  ultimaSync        DateTime?
  proximaSync       DateTime?
  errorDetalle      String?
  autoReconciliar   Boolean              @default(true)
  notificarErrores  Boolean              @default(true)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  desconectadaEn    DateTime?
  BankConsent       BankConsent[]
  BankPayment       BankPayment[]
  company           company?             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants           tenants?             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users             users?               @relation(fields: [userId], references: [id], onDelete: Cascade)
  bank_transactions bank_transactions[]

  @@index([companyId])
  @@index([consentId])
  @@index([estado])
  @@index([proveedorItemId])
  @@index([tenantId])
  @@index([userId])
}

model bank_transactions {
  id                String            @id
  companyId         String
  connectionId      String
  proveedorTxId     String            @unique
  fecha             DateTime
  fechaContable     DateTime?
  descripcion       String
  monto             Float
  moneda            String            @default("EUR")
  categoria         String?
  subcategoria      String?
  beneficiario      String?
  referencia        String?
  tipoTransaccion   String?
  creditorName      String?
  creditorIban      String?
  debtorName        String?
  debtorIban        String?
  rawData           Json?
  estado            TransactionStatus @default(pendiente_revision)
  paymentId         String?
  expenseId         String?
  matchScore        Float?
  matchSuggestions  Json?
  conciliadoPor     String?
  conciliadoEn      DateTime?
  notasConciliacion String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  bank_connections  bank_connections  @relation(fields: [connectionId], references: [id], onDelete: Cascade)
  expenses          expenses?         @relation(fields: [expenseId], references: [id])
  payments          payments?         @relation(fields: [paymentId], references: [id])

  @@index([companyId])
  @@index([connectionId])
  @@index([estado])
  @@index([fecha])
  @@index([proveedorTxId])
}

model bi_alerts {
  id               String        @id
  companyId        String
  nombre           String
  descripcion      String
  metrica          String
  condicion        String
  umbral           Float
  severidad        AlertSeverity @default(warning)
  activa           Boolean       @default(true)
  ultimaActivacion DateTime?
  vecesActivada    Int           @default(0)
  emailNotificar   Boolean       @default(true)
  destinatarios    String[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime

  @@index([activa])
  @@index([companyId])
  @@index([metrica])
}

model bi_reports {
  id                 String          @id
  companyId          String
  nombre             String
  descripcion        String?
  tipo               String
  frecuencia         ReportFrequency
  filtros            Json
  columnas           Json
  ultimaEjecucion    DateTime?
  proximaEjecucion   DateTime?
  activo             Boolean         @default(true)
  emailDestinatarios String[]
  creadoPor          String
  createdAt          DateTime        @default(now())
  updatedAt          DateTime

  @@index([activo])
  @@index([companyId])
  @@index([proximaEjecucion])
}

model bi_widgets {
  id          String     @id
  companyId   String
  nombre      String
  descripcion String?
  tipo        WidgetType
  dataSource  String
  config      Json
  posicion    Int        @default(0)
  activo      Boolean    @default(true)
  creadoPor   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime

  @@index([activo])
  @@index([companyId])
}

model biometric_verifications {
  id                  String   @id
  companyId           String
  tenantId            String?
  userId              String?
  tipo                String
  resultado           String
  confidence          Float?
  metadata            Json?
  documentoVerificado String?
  proveedor           String?  @default("Veriff")
  ipAddress           String?
  userAgent           String?
  createdAt           DateTime @default(now())
  company             company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants             tenants? @relation(fields: [tenantId], references: [id])
  users               users?   @relation(fields: [userId], references: [id])

  @@index([companyId, tipo])
}

model branding_configs {
  id              String   @id
  companyId       String   @unique
  appName         String   @default("INMOVA")
  appDescription  String?
  tagline         String?
  logoUrl         String?
  logoSmallUrl    String?
  faviconUrl      String?
  ogImageUrl      String?
  primaryColor    String   @default("#000000")
  secondaryColor  String   @default("#FFFFFF")
  accentColor     String?  @default("#6366f1")
  backgroundColor String   @default("#FFFFFF")
  textColor       String   @default("#000000")
  successColor    String   @default("#22c55e")
  warningColor    String   @default("#f59e0b")
  errorColor      String   @default("#ef4444")
  fontFamily      String   @default("Inter, sans-serif")
  headingFont     String?
  borderRadius    String   @default("0.5rem")
  sidebarPosition String   @default("left")
  theme           String   @default("light")
  footerText      String?
  contactEmail    String?
  contactPhone    String?
  websiteUrl      String?
  metaTitle       String?
  metaDescription String?
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  company         company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model building_inspections {
  id                      String    @id
  companyId               String
  buildingId              String
  tipo                    String
  estado                  String
  fechaInspeccion         DateTime
  fechaVencimiento        DateTime
  proximaInspeccion       DateTime?
  resultado               String
  tecnicoNombre           String
  tecnicoColegio          String
  numeroRegistro          String?
  deficienciasEncontradas Json?
  accionesRequeridas      Json?
  certificadoURL          String?
  documentos              Json?
  alertasEnviadas         Boolean   @default(false)
  recordatorios           Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime
  buildings               buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company                 company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([alertasEnviadas])
  @@index([companyId, buildingId])
  @@index([fechaVencimiento, estado])
}

model building_metrics {
  id                     String   @id
  buildingId             String
  fecha                  DateTime @default(now())
  periodo                String
  totalUnidades          Int
  unidadesOcupadas       Int
  tasaOcupacion          Float
  ingresosReales         Float
  ingresosPotenciales    Float
  gastos                 Float
  ingresoNeto            Float
  roi                    Float
  ticketPromedio         Float
  diasPromedioVacancia   Int
  satisfaccionInquilinos Float?
  createdAt              DateTime @default(now())

  @@index([buildingId])
  @@index([fecha])
  @@index([periodo])
}

model buildings {
  id                       String                     @id
  companyId                String
  nombre                   String
  direccion                String
  tipo                     BuildingType
  anoConstructor           Int
  numeroUnidades           Int
  estadoConservacion       String?
  certificadoEnergetico    String?
  ascensor                 Boolean                    @default(false)
  garaje                   Boolean                    @default(false)
  trastero                 Boolean                    @default(false)
  piscina                  Boolean                    @default(false)
  jardin                   Boolean                    @default(false)
  gastosComunidad          Float?
  ibiAnual                 Float?
  latitud                  Float?
  longitud                 Float?
  imagenes                 String[]                   @default([])
  etiquetas                String[]                   @default([])
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  ColivingActivityPost     ColivingActivityPost[]
  ColivingEvent            ColivingEvent[]
  ColivingGroup            ColivingGroup[]
  ColivingPackage          ColivingPackage[]
  SmartLock                SmartLock[]
  ambassadors              ambassadors[]
  building_inspections     building_inspections[]
  company                  company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  calendar_events          calendar_events[]
  carbon_footprints        carbon_footprints[]
  cash_flow_forecasts      cash_flow_forecasts[]
  common_spaces            common_spaces[]
  community_announcements  community_announcements[]
  community_events         community_events[]
  community_fees           community_fees[]
  community_funds          community_funds[]
  community_incidents      community_incidents[]
  community_management     community_management?
  community_meetings       community_meetings[]
  community_minutes        community_minutes[]
  community_votes          community_votes[]
  construction_projects    construction_projects[]
  decarbonization_plans    decarbonization_plans[]
  documents                documents[]
  energy_alerts            energy_alerts[]
  energy_readings          energy_readings[]
  esg_certifications       esg_certifications[]
  expenses                 expenses[]
  financial_alerts         financial_alerts[]
  flipping_projects        flipping_projects[]
  insurance_policies       insurance_policies[]
  insurances               insurances[]
  iot_devices              iot_devices[]
  maintenance_schedules    maintenance_schedules[]
  nft_certificates         nft_certificates[]
  owner_buildings          owner_buildings[]
  property_tokens          property_tokens[]
  provider_work_orders     provider_work_orders[]
  publicaciones_portales   publicaciones_portales[]
  recycling_metrics        recycling_metrics[]
  service_jobs             service_jobs[]
  service_quotes           service_quotes[]
  social_posts             social_posts[]
  units                    units[]
  urban_gardens            urban_gardens[]
  valoraciones_propiedades valoraciones_propiedades[]
  virtual_tours            virtual_tours[]

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([companyId, tipo, anoConstructor])
  @@index([tipo, companyId])
}

model calendar_events {
  id                   String                    @id
  companyId            String
  titulo               String
  descripcion          String?
  tipo                 calendar_event_types
  prioridad            calendar_event_priorities @default(media)
  fechaInicio          DateTime
  fechaFin             DateTime?
  todoElDia            Boolean                   @default(false)
  ubicacion            String?
  buildingId           String?
  unitId               String?
  tenantId             String?
  contractId           String?
  paymentId            String?
  maintenanceRequestId String?
  visitId              String?
  inspectionId         String?
  recordatorioActivo   Boolean                   @default(false)
  recordatorioMinutos  Int?
  recordatorioEnviado  Boolean                   @default(false)
  completado           Boolean                   @default(false)
  cancelado            Boolean                   @default(false)
  motivoCancelacion    String?
  esRecurrente         Boolean                   @default(false)
  patronRecurrencia    String?
  participantes        Json?
  color                String?
  notas                String?
  creadoPor            String
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime
  buildings            buildings?                @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company              company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contracts            contracts?                @relation(fields: [contractId], references: [id])
  inspections          inspections?              @relation(fields: [inspectionId], references: [id])
  maintenance_requests maintenance_requests?     @relation(fields: [maintenanceRequestId], references: [id])
  payments             payments?                 @relation(fields: [paymentId], references: [id])
  tenants              tenants?                  @relation(fields: [tenantId], references: [id])
  units                units?                    @relation(fields: [unitId], references: [id], onDelete: Cascade)
  visits               visits?                   @relation(fields: [visitId], references: [id])

  @@index([buildingId])
  @@index([cancelado])
  @@index([companyId])
  @@index([completado])
  @@index([fechaFin])
  @@index([fechaInicio])
  @@index([tenantId])
  @@index([tipo])
  @@index([unitId])
}

model candidates {
  id                   String                @id
  unitId               String
  nombreCompleto       String
  dni                  String
  email                String
  telefono             String
  fechaNacimiento      DateTime
  situacionLaboral     SituacionLaboral?
  ingresosMensuales    Float?
  scoring              Int                   @default(0)
  estado               CandidateStatus       @default(nuevo)
  documentos           String[]              @default([])
  notas                String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  units                units                 @relation(fields: [unitId], references: [id], onDelete: Cascade)
  screening_candidatos screening_candidatos?
  visits               visits[]
}

model carbon_footprints {
  id                   String     @id
  companyId            String
  buildingId           String?
  periodo              String
  fechaInicio          DateTime
  fechaFin             DateTime
  scope1               Float      @default(0)
  scope2               Float      @default(0)
  scope3               Float      @default(0)
  total                Float
  desglose             Json
  periodoAnterior      Float?
  variacion            Float?
  intensidadPorM2      Float?
  intensidadPorPersona Float?
  metodologia          String
  verificado           Boolean    @default(false)
  verificadoPor        String?
  calculadoPor         String?
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  buildings            buildings? @relation(fields: [buildingId], references: [id])
  company              company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, periodo])
}

model cash_book_entries {
  id                   String               @id
  companyId            String
  communityId          String
  fecha                DateTime             @default(now())
  tipo                 TipoMovimientoCaja
  concepto             String
  descripcion          String?
  importe              Float
  saldoAnterior        Float
  saldoActual          Float
  categoria            String
  subcategoria         String?
  facturaId            String?
  pagoId               String?
  documentoUrl         String?
  registradoPor        String
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  community_management community_management @relation(fields: [communityId], references: [id], onDelete: Cascade)
  company              company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@index([communityId])
  @@index([companyId])
  @@index([fecha])
  @@index([tipo])
}

model cash_flow_forecasts {
  id                  String     @id
  companyId           String
  buildingId          String?
  mes                 String
  ingresosPrevistos   Float      @default(0)
  ingresosRecurrentes Float      @default(0)
  ingresosVariables   Float      @default(0)
  gastosPrevistos     Float      @default(0)
  gastosRecurrentes   Float      @default(0)
  gastosVariables     Float      @default(0)
  saldoFinal          Float      @default(0)
  confianza           Float      @default(0.8)
  escenarioOptimista  Float      @default(0)
  escenarioPesimista  Float      @default(0)
  calculadoEn         DateTime   @default(now())
  basadoEnDatos       Json?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime
  buildings           buildings? @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company             company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, buildingId, mes])
  @@index([companyId, mes])
}

model cash_flow_statements {
  id                  String   @id
  companyId           String
  periodo             String
  fechaInicio         DateTime
  fechaFin            DateTime
  ingresosTotales     Float    @default(0)
  gastosTotales       Float    @default(0)
  flujoNeto           Float    @default(0)
  saldoInicial        Float    @default(0)
  saldoFinal          Float    @default(0)
  ingresosRenta       Float    @default(0)
  ingresosDeposito    Float    @default(0)
  ingresosOtros       Float    @default(0)
  gastosMantenimiento Float    @default(0)
  gastosImpuestos     Float    @default(0)
  gastosSeguros       Float    @default(0)
  gastosServicios     Float    @default(0)
  gastosOtros         Float    @default(0)
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  @@index([companyId])
  @@index([periodo])
}

model chat_conversations {
  id                 String          @id
  companyId          String
  tenantId           String?
  userId             String?
  asunto             String
  estado             ChatStatus      @default(activa)
  ultimoMensaje      String?
  ultimoMensajeFecha DateTime?
  cerradoPor         String?
  fechaCierre        DateTime?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime
  chat_messages      chat_messages[]

  @@index([companyId, estado])
  @@index([tenantId])
  @@index([userId])
}

model chat_messages {
  id                 String             @id
  conversationId     String
  senderType         String
  senderId           String
  mensaje            String
  leido              Boolean            @default(false)
  estado             ChatMessageStatus  @default(enviado)
  adjuntos           String[]           @default([])
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  chat_conversations chat_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
}

model chatbot_actions {
  id           String   @id
  companyId    String
  sessionId    String
  tenantId     String?
  accion       String
  parametros   Json?
  resultado    String?
  errorDetalle String?
  createdAt    DateTime @default(now())

  @@index([accion])
  @@index([companyId])
  @@index([sessionId])
  @@index([tenantId])
}

model chatbot_conversations {
  id               String                    @id
  companyId        String
  tenantId         String?
  userId           String?
  sessionId        String                    @unique
  idioma           String                    @default("es")
  estado           ChatbotConversationStatus @default(activa)
  tema             String?
  satisfaccion     Int?
  comentarios      String?
  escaladoMotivo   String?
  contexto         Json?
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime
  cerradaEn        DateTime?
  tenants          tenants?                  @relation(fields: [tenantId], references: [id])
  users            users?                    @relation(fields: [userId], references: [id])
  chatbot_messages chatbot_messages[]

  @@index([companyId])
  @@index([createdAt])
  @@index([estado])
  @@index([sessionId])
  @@index([tenantId])
}

model chatbot_interactions {
  id               String   @id
  userId           String
  companyId        String
  message          String
  response         String
  context          Json?
  suggestedActions Json?
  escalated        Boolean  @default(false)
  createdAt        DateTime @default(now())
  company          company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([escalated])
  @@index([userId])
}

model chatbot_messages {
  id                    String                @id
  conversationId        String
  senderType            String
  mensaje               String
  metadata              Json?
  confidence            Float?
  tokens                Int?
  createdAt             DateTime              @default(now())
  chatbot_conversations chatbot_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
  @@index([senderType])
}

model circular_items {
  id                    String                @id
  marketplaceId         String
  tenantId              String?
  nombre                String
  descripcion           String?
  categoria             String
  estado                String                @default("disponible")
  condicion             String?
  tipo                  String                @default("intercambio")
  precioMoneda          Float?
  precioPuntos          Int?
  fotos                 String[]
  ubicacion             String?
  interesados           String[]
  reservadoPor          String?
  fechaReserva          DateTime?
  transaccionCompletada Boolean               @default(false)
  fechaTransaccion      DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  circular_marketplaces circular_marketplaces @relation(fields: [marketplaceId], references: [id], onDelete: Cascade)
  tenants               tenants?              @relation(fields: [tenantId], references: [id])

  @@index([marketplaceId, estado])
}

model circular_marketplaces {
  id             String           @id
  companyId      String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  circular_items circular_items[]
  company        company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model coliving_analytics {
  id                                      String           @id
  companyId                               String
  periodo                                 DateTime
  mes                                     Int
  anio                                    Int
  totalColivers                           Int
  coliversSalieron                        Int
  churnRate                               Float
  promedioEstanciaMeses                   Float?
  ltvPromedio                             Float
  ltvMinimo                               Float
  ltvMaximo                               Float
  totalEncuestas                          Int              @default(0)
  promotores                              Int              @default(0)
  pasivos                                 Int              @default(0)
  detractores                             Int              @default(0)
  npsScore                                Float?
  perfilIdealEdadMin                      Int?
  perfilIdealEdadMax                      Int?
  perfilIdealOcupacion                    String?
  perfilIdealIngresoMin                   Float?
  perfilIdealEstanciaMeses                Int?
  prediccionOcupacionProximoMes           Float?
  prediccionDisponibilidadRoomsProximoMes Int?
  nivelConfianzaPrediccion                PredictionStatus @default(neutro)
  createdAt                               DateTime         @default(now())
  updatedAt                               DateTime
  company                                 company          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, periodo])
  @@index([companyId])
  @@index([periodo])
}

model common_spaces {
  id                            String                          @id
  companyId                     String
  buildingId                    String
  nombre                        String
  descripcion                   String?
  tipo                          common_space_types
  capacidadMaxima               Int?
  requierePago                  Boolean                         @default(false)
  costoPorHora                  Float?
  horaApertura                  String?
  horaCierre                    String?
  duracionMaximaHoras           Int                             @default(4)
  anticipacionDias              Int                             @default(30)
  reglas                        String?
  activo                        Boolean                         @default(true)
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime
  buildings                     buildings                       @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company                       company                         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  space_maintenance_predictions space_maintenance_predictions[]
  space_ratings                 space_ratings[]
  space_reservations            space_reservations[]
  space_waitlist                space_waitlist[]

  @@index([activo])
  @@index([buildingId])
  @@index([companyId])
  @@index([tipo])
}

model community_announcements {
  id                 String    @id
  companyId          String
  buildingId         String
  titulo             String
  contenido          String
  tipo               String
  importante         Boolean   @default(false)
  enviarNotificacion Boolean   @default(false)
  fechaPublicacion   DateTime  @default(now())
  fechaExpiracion    DateTime?
  adjuntos           String[]
  activo             Boolean   @default(true)
  publicadoPor       String
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  buildings          buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company            company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([activo])
  @@index([buildingId])
  @@index([companyId])
  @@index([fechaPublicacion])
}

model community_engagement_metrics {
  id                       String   @id
  companyId                String
  buildingId               String?
  colivingId               String?
  periodo                  DateTime @default(now())
  tipoPerido               String   @default("diario")
  eventosCreados           Int      @default(0)
  eventosRealizados        Int      @default(0)
  asistenciaTotalEventos   Int      @default(0)
  tasaAsistenciaPromedio   Float    @default(0)
  postsCreados             Int      @default(0)
  totalLikes               Int      @default(0)
  totalComentarios         Int      @default(0)
  totalCompartidos         Int      @default(0)
  vistasTotales            Int      @default(0)
  anunciosPublicados       Int      @default(0)
  tasaLecturaAnuncios      Float    @default(0)
  tasaConfirmacionAnuncios Float    @default(0)
  usuariosActivos          Int      @default(0)
  nuevosParticipantes      Int      @default(0)
  interaccionesTotal       Int      @default(0)
  sentimientoPromedio      Float    @default(0)
  createdAt                DateTime @default(now())
  updatedAt                DateTime
  company                  company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([colivingId])
  @@index([companyId])
  @@index([periodo])
}

model community_events {
  id                    String     @id
  companyId             String
  buildingId            String?
  titulo                String
  descripcion           String?
  categoria             String
  fecha                 DateTime
  horaInicio            String
  horaFin               String?
  ubicacion             String
  capacidadMaxima       Int?
  asistentesConfirmados String[]
  asistentesLista       Int        @default(0)
  precio                Float?
  requierePago          Boolean    @default(false)
  fotos                 String[]
  estado                String     @default("programado")
  organizadoPor         String?
  valoraciones          Json?
  ratingPromedio        Float?
  createdAt             DateTime   @default(now())
  updatedAt             DateTime
  buildings             buildings? @relation(fields: [buildingId], references: [id])
  company               company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
}

model community_fees {
  id               String        @id
  companyId        String
  buildingId       String
  unitId           String?
  tipo             CuotaTipo
  periodo          String
  concepto         String
  importeBase      Float
  coeficiente      Float         @default(1.0)
  importeTotal     Float
  fechaVencimiento DateTime
  fechaPago        DateTime?
  estado           PaymentStatus @default(pendiente)
  metodoPago       String?
  referenciaPago   String?
  gastosCorrientes Float         @default(0)
  fondoReserva     Float         @default(0)
  seguros          Float         @default(0)
  mantenimiento    Float         @default(0)
  otros            Float         @default(0)
  notas            String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  buildings        buildings     @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company          company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units            units?        @relation(fields: [unitId], references: [id])

  @@index([companyId, buildingId])
  @@index([periodo, estado])
  @@index([unitId])
}

model community_funds {
  id                String    @id
  companyId         String
  buildingId        String
  tipo              FondoTipo
  nombre            String
  descripcion       String?
  saldoActual       Float     @default(0)
  saldoObjetivo     Float?
  aportacionMensual Float     @default(0)
  totalAportaciones Float     @default(0)
  totalGastos       Float     @default(0)
  movimientos       Json
  fechaCreacion     DateTime  @default(now())
  activo            Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  buildings         buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company           company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, buildingId])
  @@index([tipo, activo])
}

model community_incidents {
  id              String           @id
  companyId       String
  buildingId      String
  reportedBy      String
  reporterType    String
  titulo          String
  descripcion     String
  tipo            IncidentType
  estado          IncidentStatus   @default(abierta)
  prioridad       IncidentPriority @default(media)
  ubicacion       String?
  unitId          String?
  fotos           String[]
  asignadoA       String?
  fechaReporte    DateTime         @default(now())
  fechaResolucion DateTime?
  solucion        String?
  costoEstimado   Float?
  costoFinal      Float?
  visible         Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  buildings       buildings        @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company         company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units           units?           @relation(fields: [unitId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([prioridad])
  @@index([tipo])
}

model community_invoices {
  id                   String                 @id
  companyId            String
  communityId          String
  numeroFactura        String                 @unique
  fechaEmision         DateTime               @default(now())
  fechaVencimiento     DateTime
  periodo              String
  honorarios           Float                  @default(0)
  gastosGestion        Float                  @default(0)
  otrosConceptos       Json?
  baseImponible        Float
  iva                  Float
  totalFactura         Float
  estado               EstadoFacturaComunidad @default(borrador)
  fechaPago            DateTime?
  metodoPago           String?
  documentoUrl         String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  community_management community_management   @relation(fields: [communityId], references: [id], onDelete: Cascade)
  company              company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([communityId])
  @@index([companyId])
  @@index([estado])
  @@index([numeroFactura])
}

model community_management {
  id                   String               @id
  companyId            String
  buildingId           String               @unique
  nombreComunidad      String
  cif                  String?
  direccion            String
  codigoPostal         String?
  ciudad               String?
  provincia            String?
  honorariosFijos      Float?
  honorariosPorcentaje Float?
  activa               Boolean              @default(true)
  fechaInicio          DateTime             @default(now())
  fechaFin             DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  cash_book_entries    cash_book_entries[]
  community_invoices   community_invoices[]
  buildings            buildings            @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company              company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  community_reports    community_reports[]

  @@index([buildingId])
  @@index([companyId])
}

model community_meetings {
  id            String    @id
  companyId     String
  buildingId    String
  titulo        String
  tipo          String
  fechaReunion  DateTime
  ubicacion     String?
  ordenDel      String
  acta          String?
  acuerdos      Json?
  asistentes    Json?
  estado        String    @default("programada")
  convocatoria  String?
  actaFirmada   String?
  organizadoPor String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  buildings     buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company       company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaReunion])
}

model community_minutes {
  id              String     @id
  companyId       String
  buildingId      String
  numeroActa      Int
  fecha           DateTime
  convocatoria    String
  asistentes      Json
  ordenDia        Json
  acuerdos        Json
  estado          ActaEstado @default(borrador)
  documentos      Json?
  firmasDigitales Json?
  creadoPor       String
  aprobadoPor     String?
  fechaAprobacion DateTime?
  observaciones   String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  buildings       buildings  @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company         company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, buildingId, numeroActa])
  @@index([companyId, buildingId])
  @@index([fecha])
}

model community_reports {
  id                   String               @id
  companyId            String
  communityId          String
  tipo                 TipoInformeComunidad
  periodo              String
  fechaInicio          DateTime
  fechaFin             DateTime
  totalIngresos        Float                @default(0)
  totalGastos          Float                @default(0)
  saldoInicial         Float                @default(0)
  saldoFinal           Float                @default(0)
  detalleIngresos      Json?
  detalleGastos        Json?
  morosos              Json?
  fondosReserva        Float                @default(0)
  observaciones        String?
  documentoUrl         String?
  generadoEn           DateTime             @default(now())
  generadoPor          String
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  community_management community_management @relation(fields: [communityId], references: [id], onDelete: Cascade)
  company              company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([communityId])
  @@index([companyId])
  @@index([periodo])
  @@index([tipo])
}

model community_votes {
  id              String         @id
  companyId       String
  buildingId      String
  titulo          String
  descripcion     String
  tipo            VoteType
  estado          VoteStatus     @default(activa)
  opciones        Json
  requiereQuorum  Boolean        @default(true)
  quorumRequerido Float          @default(50)
  fechaInicio     DateTime       @default(now())
  fechaCierre     DateTime
  totalVotos      Int            @default(0)
  totalElegibles  Int            @default(0)
  opcionGanadora  String?
  creadoPor       String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  buildings       buildings      @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company         company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  vote_records    vote_records[]

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaCierre])
}

model company {
  id                            String                          @id
  nombre                        String                          @default("INMOVA")
  cif                           String?
  direccion                     String?
  telefono                      String?
  email                         String?
  logoUrl                       String?
  codigoPostal                  String?
  ciudad                        String?
  pais                          String                          @default("España")
  iban                          String?
  colorPrimario                 String?                         @default("#000000")
  colorSecundario               String?                         @default("#FFFFFF")
  pieDocumento                  String?
  activo                        Boolean                         @default(true)
  dominioPersonalizado          String?                         @unique
  estadoCliente                 String?                         @default("activo")
  contactoPrincipal             String?
  emailContacto                 String?
  telefonoContacto              String?
  notasAdmin                    String?
  parentCompanyId               String?
  maxUsuarios                   Int?                            @default(5)
  maxPropiedades                Int?                            @default(10)
  maxEdificios                  Int?                            @default(5)
  subscriptionPlanId            String?
  tags                          String[]                        @default([])
  category                      CompanyCategory?                @default(standard)
  stripeCustomerId              String?                         @unique
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime
  B2BInvoice                    B2BInvoice[]
  B2BPaymentHistory             B2BPaymentHistory[]
  B2BSubscriptionHistory        B2BSubscriptionHistory[]
  ColivingActivityPost          ColivingActivityPost[]
  ColivingCheckInOut            ColivingCheckInOut[]
  ColivingEvent                 ColivingEvent[]
  ColivingGroup                 ColivingGroup[]
  ColivingMatch                 ColivingMatch[]
  ColivingPackage               ColivingPackage[]
  ColivingProfile               ColivingProfile[]
  ColivingService               ColivingService[]
  ColivingServiceBooking        ColivingServiceBooking[]
  Commission                    Commission[]
  OnboardingProgress            OnboardingProgress[]
  PartnerClient                 PartnerClient[]
  SalesLead                     SalesLead[]
  ServiceRating                 ServiceRating[]
  SmartLock                     SmartLock[]
  SupportTicket                 SupportTicket[]
  TenantInvitation              TenantInvitation[]
  ai_conversations              ai_conversations[]
  ambassadors                   ambassadors[]
  ar_visualizations             ar_visualizations[]
  audit_logs                    audit_logs[]
  automatic_reminders           automatic_reminders[]
  automation_executions         automation_executions[]
  automations                   automations[]
  bad_debt_provisions           bad_debt_provisions[]
  bank_connections              bank_connections[]
  biometric_verifications       biometric_verifications[]
  branding_configs              branding_configs?
  building_inspections          building_inspections[]
  buildings                     buildings[]
  calendar_events               calendar_events[]
  carbon_footprints             carbon_footprints[]
  cash_book_entries             cash_book_entries[]
  cash_flow_forecasts           cash_flow_forecasts[]
  chatbot_interactions          chatbot_interactions[]
  circular_marketplaces         circular_marketplaces[]
  coliving_analytics            coliving_analytics[]
  common_spaces                 common_spaces[]
  community_announcements       community_announcements[]
  community_engagement_metrics  community_engagement_metrics[]
  community_events              community_events[]
  community_fees                community_fees[]
  community_funds               community_funds[]
  community_incidents           community_incidents[]
  community_invoices            community_invoices[]
  community_management          community_management[]
  community_meetings            community_meetings[]
  community_minutes             community_minutes[]
  community_reports             community_reports[]
  community_votes               community_votes[]
  company                       company?                        @relation("companyTocompany", fields: [parentCompanyId], references: [id])
  other_company                 company[]                       @relation("companyTocompany")
  subscription_plans            subscription_plans?             @relation(fields: [subscriptionPlanId], references: [id])
  company_business_models       company_business_models[]
  company_modules               company_modules[]
  construction_projects         construction_projects[]
  decarbonization_plans         decarbonization_plans[]
  deposit_management            deposit_management[]
  discount_coupons              discount_coupons[]
  documentos_firma              documentos_firma[]
  email_logs                    email_logs[]
  energy_certificates           energy_certificates[]
  esg_certifications            esg_certifications[]
  esg_reports                   esg_reports[]
  ewoorker_obra                 ewoorker_obra[]
  ewoorker_perfil_empresa       ewoorker_perfil_empresa?
  financial_alerts              financial_alerts[]
  flipping_projects             flipping_projects[]
  fraud_alerts                  fraud_alerts[]
  gdpr_consents                 gdpr_consents[]
  green_providers               green_providers[]
  habitability_certificates     habitability_certificates[]
  in_app_notifications          in_app_notifications[]
  insurances                    insurances[]
  integration_configs           integration_configs[]
  integration_logs              integration_logs[]
  iot_alerts                    iot_alerts[]
  iot_automations               iot_automations[]
  iot_devices                   iot_devices[]
  leads                         leads[]
  market_data                   market_data[]
  marketplace_bookings          marketplace_bookings[]
  marketplace_loyalty           marketplace_loyalty[]
  marketplace_services          marketplace_services[]
  modelo_180_records            modelo_180_records[]
  modelo_347_records            modelo_347_records[]
  module_usage_stats            module_usage_stats[]
  nft_certificates              nft_certificates[]
  notification_logs             notification_logs[]
  notification_rules            notification_rules[]
  notification_templates        notification_templates[]
  notifications                 notifications[]
  nps_surveys                   nps_surveys[]
  onboarding_tasks              onboarding_tasks[]
  owner_alerts                  owner_alerts[]
  owner_buildings               owner_buildings[]
  owner_notifications           owner_notifications[]
  owners                        owners[]
  p2p_services                  p2p_services[]
  performance_metrics           performance_metrics[]
  pomelli_configs               pomelli_configs?
  pomelli_social_posts          pomelli_social_posts[]
  pricing_analysis              pricing_analysis[]
  pricing_strategies            pricing_strategies[]
  professional_projects         professional_projects[]
  property_galleries            property_galleries[]
  property_tokens               property_tokens[]
  provider_availability         provider_availability[]
  provider_chat_conversations   provider_chat_conversations[]
  provider_chat_messages        provider_chat_messages[]
  provider_invoice_payments     provider_invoice_payments[]
  provider_invoices             provider_invoices[]
  provider_quotes               provider_quotes[]
  provider_reviews              provider_reviews[]
  provider_work_orders          provider_work_orders[]
  providers                     providers[]
  publicaciones_portales        publicaciones_portales[]
  recycling_metrics             recycling_metrics[]
  reviews                       reviews[]
  room_contracts                room_contracts[]
  room_payments                 room_payments[]
  room_shared_spaces            room_shared_spaces[]
  rooms                         rooms[]
  saved_searches                saved_searches[]
  screening_candidatos          screening_candidatos[]
  search_history                search_history[]
  security_audits               security_audits[]
  security_incidents            security_incidents[]
  smart_contracts               smart_contracts[]
  sms_logs                      sms_logs[]
  sms_templates                 sms_templates[]
  social_analytics              social_analytics[]
  social_media_accounts         social_media_accounts[]
  social_media_posts            social_media_posts[]
  social_posts                  social_posts[]
  social_profiles               social_profiles[]
  space_maintenance_predictions space_maintenance_predictions[]
  space_ratings                 space_ratings[]
  space_reservations            space_reservations[]
  space_waitlist                space_waitlist[]
  str_bookings                  str_bookings[]
  str_channel_sync              str_channel_sync[]
  str_housekeeping_checklists   str_housekeeping_checklists[]
  str_housekeeping_inventory    str_housekeeping_inventory[]
  str_housekeeping_staff        str_housekeeping_staff[]
  str_housekeeping_tasks        str_housekeeping_tasks[]
  str_listings                  str_listings[]
  suggestions                   suggestions[]
  system_backups                system_backups[]
  tasks                         tasks[]
  tenants                       tenants[]
  urban_gardens                 urban_gardens[]
  user_celebrations             user_celebrations[]
  user_company_access           user_company_access[]
  users                         users[]
  valoraciones_propiedades      valoraciones_propiedades[]
  virtual_tours                 virtual_tours[]
  voice_interactions            voice_interactions[]
  webhook_events                webhook_events[]
  workflows                     workflows[]
}

model company_business_models {
  id            String        @id
  companyId     String
  businessModel BusinessModel
  activo        Boolean       @default(true)
  configuracion Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  company       company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, businessModel])
}

model company_modules {
  id            String   @id
  companyId     String
  moduloCodigo  String
  activo        Boolean  @default(true)
  configuracion Json?
  limiteUso     Int?
  activadoPor   String?
  activadoEn    DateTime @default(now())
  updatedAt     DateTime
  company       company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, moduloCodigo])
  @@index([companyId])
  @@index([moduloCodigo])
}

model compliance_alerts {
  id              String    @id
  companyId       String
  tipo            String
  titulo          String
  descripcion     String
  fechaLimite     DateTime
  estado          String    @default("pendiente")
  prioridad       String    @default("media")
  entityId        String?
  entityType      String?
  accionRequerida String?
  completada      Boolean   @default(false)
  fechaCompletada DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([companyId])
  @@index([estado])
  @@index([fechaLimite])
}

model conciliaciones_manuales {
  id               String    @id
  companyId        String
  transactionId    String    @unique
  paymentId        String?
  expenseId        String?
  diferenciaMonto  Float?
  motivoDiferencia String?
  notas            String?
  conciliadoPor    String
  createdAt        DateTime  @default(now())
  expenses         expenses? @relation(fields: [expenseId], references: [id])
  payments         payments? @relation(fields: [paymentId], references: [id])

  @@index([companyId])
  @@index([transactionId])
}

model construction_inspections {
  id                    String                @id
  projectId             String
  fase                  ConstructionPhase
  tipo                  String
  inspector             String
  fecha                 DateTime
  resultado             String
  observaciones         String?
  defectosEncontrados   Int                   @default(0)
  defectosCorregidos    Int                   @default(0)
  documentacion         String[]              @default([])
  fotos                 String[]              @default([])
  createdAt             DateTime              @default(now())
  construction_projects construction_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model construction_projects {
  id                       String                     @id
  companyId                String
  buildingId               String?
  nombre                   String
  descripcion              String
  tipoProyecto             String
  direccion                String
  parcela                  String?
  referenciaCatastral      String?
  numViviendas             Int?
  metrosConstruidos        Float?
  numPlantas               Int?
  presupuestoTotal         Float
  gastosReales             Float                      @default(0)
  desviacionPresupuesto    Float?
  fechaInicio              DateTime
  fechaFinPrevista         DateTime
  fechaFinReal             DateTime?
  duracionMeses            Int
  faseActual               ConstructionPhase          @default(PLANIFICACION)
  porcentajeAvance         Int                        @default(0)
  licenciaObra             Boolean                    @default(false)
  certificadoFinal         Boolean                    @default(false)
  habitabilidad            Boolean                    @default(false)
  planos                   String[]                   @default([])
  permisos                 String[]                   @default([])
  certificaciones          String[]                   @default([])
  fotosProgreso            String[]                   @default([])
  arquitecto               String?
  aparejador               String?
  constructor              String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  construction_inspections construction_inspections[]
  buildings                buildings?                 @relation(fields: [buildingId], references: [id])
  company                  company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  construction_suppliers   construction_suppliers[]
  construction_work_orders construction_work_orders[]
}

model construction_suppliers {
  id                    String                @id
  projectId             String
  nombre                String
  tipoSuministro        String
  contacto              String?
  telefono              String?
  email                 String?
  descripcion           String
  presupuesto           Float
  fechaEntrega          DateTime
  entregado             Boolean               @default(false)
  factura               String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  construction_projects construction_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model construction_work_orders {
  id                    String                @id
  projectId             String
  fase                  ConstructionPhase
  titulo                String
  descripcion           String
  subcontratista        String
  telefono              String?
  email                 String?
  presupuesto           Float
  costoReal             Float?
  fechaInicio           DateTime
  fechaFin              DateTime
  estado                String                @default("pendiente")
  porcentajeAvance      Int                   @default(0)
  certificadoCalidad    Boolean               @default(false)
  inspeccionada         Boolean               @default(false)
  documentos            String[]              @default([])
  fotosEvidencia        String[]              @default([])
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  construction_projects construction_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model contracts {
  id                     String                   @id
  unitId                 String
  tenantId               String
  fechaInicio            DateTime
  fechaFin               DateTime
  rentaMensual           Float
  diaPago                Int                      @default(1)
  deposito               Float
  mesesFianza            Int                      @default(1)
  renovacionAutomatica   Boolean                  @default(false)
  incrementoType         IncrementoType           @default(ipc)
  incrementoValor        Float?
  gastosIncluidos        String[]                 @default([])
  gastosExcluidos        String[]                 @default([])
  clausulasAdicionales   String?
  estado                 ContractStatus           @default(activo)
  tipo                   ContractType             @default(residencial)
  contractPdfPath        String?
  legalTemplateId        String?
  contasimpleInvoiceId   String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  calendar_events        calendar_events[]
  legal_templates        legal_templates?         @relation(fields: [legalTemplateId], references: [id])
  tenants                tenants                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  units                  units                    @relation(fields: [unitId], references: [id], onDelete: Cascade)
  deposit_management     deposit_management?
  documentos_firma       documentos_firma[]
  documents              documents[]
  morosidad_predicciones morosidad_predicciones[]
  payments               payments[]
  stripe_subscriptions   stripe_subscriptions?

  @@index([estado, fechaFin])
  @@index([estado])
  @@index([fechaInicio, fechaFin])
  @@index([tenantId, estado])
  @@index([tenantId, fechaInicio])
  @@index([unitId, estado])
  @@index([unitId, fechaInicio, fechaFin])
}

model coupon_usages {
  id               String           @id
  couponId         String
  userId           String?
  tenantId         String?
  contractId       String?
  paymentId        String?
  montoOriginal    Float
  montoDescuento   Float
  montoFinal       Float
  aplicadoEn       DateTime         @default(now())
  discount_coupons discount_coupons @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([tenantId])
  @@index([userId])
}

model crm_activities {
  id            String          @id
  leadId        String
  tipo          CrmActivityType
  asunto        String
  descripcion   String?
  fecha         DateTime
  duracion      Int?
  resultado     String?
  proximaAccion String?
  completada    Boolean         @default(false)
  creadoPor     String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  crm_leads     crm_leads       @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([fecha])
  @@index([leadId])
  @@index([tipo])
}

model crm_leads {
  id                 String           @id
  companyId          String
  nombreCompleto     String
  email              String
  telefono           String
  unitId             String?
  estado             CrmLeadStatus    @default(nuevo)
  fuente             CrmLeadSource    @default(web)
  scoring            Int              @default(0)
  presupuesto        Float?
  fechaMudanza       DateTime?
  necesidades        String?
  notas              String?
  asignadoA          String?
  ultimoContacto     DateTime?
  proximoSeguimiento DateTime?
  probabilidadCierre Float            @default(0)
  valorEstimado      Float?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  crm_activities     crm_activities[]

  @@index([asignadoA])
  @@index([companyId])
  @@index([estado])
  @@index([scoring])
}

model dashboard_widgets {
  id                         String                     @id
  userId                     String
  preferenceId               String
  widgetType                 String
  title                      String
  size                       WidgetSize                 @default(medium)
  refreshRate                WidgetRefreshRate          @default(every_15min)
  dataSource                 String?
  filters                    Json?
  chartType                  String?
  columns                    String[]                   @default([])
  position                   Json?
  color                      String?
  icon                       String?
  enabled                    Boolean                    @default(true)
  lastRefresh                DateTime?
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime
  user_dashboard_preferences user_dashboard_preferences @relation(fields: [preferenceId], references: [id], onDelete: Cascade)
  users                      users                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([preferenceId])
  @@index([userId])
}

model decarbonization_plans {
  id                      String     @id
  companyId               String
  buildingId              String?
  nombre                  String
  descripcion             String?
  emisionesActuales       Float
  objetivoReduccion       Float
  emisionesObjetivo       Float
  a_oObjetivo             Int        @map("añoObjetivo")
  actuaciones             Json
  presupuestoTotal        Float
  estado                  String     @default("planificado")
  avance                  Float      @default(0)
  ahorroAnualEstimado     Float?
  periodoRetorno          Int?
  subvencionesDisponibles Json?
  subvencionesObtenidas   Float      @default(0)
  creadoPor               String?
  aprobadoPor             String?
  fechaAprobacion         DateTime?
  createdAt               DateTime   @default(now())
  updatedAt               DateTime
  buildings               buildings? @relation(fields: [buildingId], references: [id])
  company                 company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
}

model deposit_management {
  id                     String    @id
  companyId              String
  contractId             String    @unique
  importeFianza          Float
  tipoFianza             String
  depositadoOficialmente Boolean   @default(false)
  entidadDeposito        String?
  numeroDeposito         String?
  fechaDeposito          DateTime?
  devuelto               Boolean   @default(false)
  importeDevuelto        Float?
  deducciones            Float     @default(0)
  motivoDeducciones      String?
  fechaDevolucion        DateTime?
  documentos             Json?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime
  company                company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contracts              contracts @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([depositadoOficialmente, devuelto])
}

model discount_coupons {
  id                 String          @id
  companyId          String
  codigo             String
  tipo               CouponType
  valor              Float
  descripcion        String?
  usosMaximos        Int?
  usosActuales       Int             @default(0)
  usosPorUsuario     Int             @default(1)
  montoMinimo        Float?
  fechaInicio        DateTime
  fechaExpiracion    DateTime
  aplicaATodos       Boolean         @default(true)
  unidadesPermitidas String[]        @default([])
  planesPermitidos   String[]        @default([])
  estado             CouponStatus    @default(activo)
  activo             Boolean         @default(true)
  creadoPor          String
  createdAt          DateTime        @default(now())
  updatedAt          DateTime
  coupon_usages      coupon_usages[]
  company            company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, codigo])
  @@index([codigo])
  @@index([companyId])
  @@index([estado])
}

model document_folders {
  id                     String             @id
  companyId              String
  nombre                 String
  descripcion            String?
  parentFolderId         String?
  color                  String?            @default("#000000")
  icono                  String?            @default("Folder")
  createdAt              DateTime           @default(now())
  updatedAt              DateTime
  document_folders       document_folders?  @relation("document_foldersTodocument_folders", fields: [parentFolderId], references: [id], onDelete: Cascade)
  other_document_folders document_folders[] @relation("document_foldersTodocument_folders")
  documents              documents[]

  @@index([companyId])
  @@index([parentFolderId])
}

model document_shares {
  id             String    @id
  documentId     String
  tenantId       String
  compartidoPor  String
  puedeDescargar Boolean   @default(true)
  puedeEditar    Boolean   @default(false)
  notificado     Boolean   @default(false)
  visto          Boolean   @default(false)
  fechaVisto     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  documents      documents @relation(fields: [documentId], references: [id], onDelete: Cascade)
  tenants        tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([tenantId])
}

model document_tags {
  id         String   @id
  companyId  String
  nombre     String
  color      String   @default("#000000")
  documentos String[] @default([])
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([companyId])
}

model document_templates {
  id          String   @id
  companyId   String
  nombre      String
  descripcion String?
  tipo        String
  contenido   String
  variables   String[] @default([])
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([companyId])
}

model document_versions {
  id                 String    @id
  documentId         String
  versionNumero      Int
  cloud_storage_path String
  tamano             Int
  uploadedBy         String
  comentario         String?
  createdAt          DateTime  @default(now())
  documents          documents @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
}

model documentos_firma {
  id                String          @id
  companyId         String
  titulo            String
  descripcion       String?
  tipoDocumento     String
  contractId        String?
  tenantId          String?
  signaturitId      String?         @unique
  estado            SignatureStatus @default(pendiente)
  urlDocumento      String?
  urlFirmado        String?
  requiereOrden     Boolean         @default(false)
  diasExpiracion    Int             @default(30)
  fechaExpiracion   DateTime
  recordatorios     Boolean         @default(true)
  diasRecordatorio  Int             @default(3)
  creadoPor         String
  createdAt         DateTime        @default(now())
  enviadoEn         DateTime?
  completadoEn      DateTime?
  canceladoEn       DateTime?
  canceladoPor      String?
  motivoCancelacion String?
  metadata          Json?
  certificado       String?
  company           company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contracts         contracts?      @relation(fields: [contractId], references: [id])
  users             users           @relation(fields: [creadoPor], references: [id], onDelete: SetNull)
  tenants           tenants?        @relation(fields: [tenantId], references: [id])
  firmantes         firmantes[]

  @@index([companyId])
  @@index([contractId])
  @@index([estado])
  @@index([fechaExpiracion])
  @@index([signaturitId])
  @@index([tenantId])
}

model documents {
  id                String              @id
  nombre            String
  tipo              DocumentType
  cloudStoragePath  String
  tenantId          String?
  unitId            String?
  buildingId        String?
  contractId        String?
  folderId          String?
  versionActual     Int                 @default(1)
  tags              String[]            @default([])
  descripcion       String?
  fechaSubida       DateTime            @default(now())
  fechaVencimiento  DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  document_shares   document_shares[]
  document_versions document_versions[]
  buildings         buildings?          @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  contracts         contracts?          @relation(fields: [contractId], references: [id], onDelete: Cascade)
  document_folders  document_folders?   @relation(fields: [folderId], references: [id])
  tenants           tenants?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  units             units?              @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([contractId])
  @@index([createdAt])
  @@index([fechaVencimiento])
  @@index([folderId])
  @@index([tenantId])
  @@index([tipo])
  @@index([unitId])
}

model email_campaigns {
  id               String              @id
  companyId        String
  nombre           String
  asunto           String
  contenido        String
  plantillaId      String?
  estado           EmailCampaignStatus @default(borrador)
  programadaPara   DateTime?
  enviadaEn        DateTime?
  creadoPor        String
  segmento         String?
  filtros          String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  email_recipients email_recipients[]
}

model email_logs {
  id        String    @id
  userId    String
  companyId String
  template  String
  subject   String
  to        String
  status    String    @default("pending")
  sentAt    DateTime?
  error     String?
  metadata  Json?
  createdAt DateTime  @default(now())
  company   company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([sentAt])
  @@index([status])
  @@index([template])
  @@index([userId])
}

model email_recipients {
  id              String          @id
  campaignId      String
  email           String
  nombre          String
  tenantId        String?
  enviado         Boolean         @default(false)
  entregado       Boolean         @default(false)
  abierto         Boolean         @default(false)
  clicado         Boolean         @default(false)
  rebotado        Boolean         @default(false)
  fechaEnvio      DateTime?
  fechaApertura   DateTime?
  fechaClic       DateTime?
  errorEnvio      String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  email_campaigns email_campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
}

model energy_alerts {
  id                   String     @id
  companyId            String
  buildingId           String?
  unitId               String?
  tipo                 EnergyType
  tipoAlerta           AlertType
  titulo               String
  descripcion          String
  consumoActual        Float
  consumoPromedio      Float?
  desviacionPorcentaje Float?
  severidad            String     @default("media")
  fechaDeteccion       DateTime   @default(now())
  resuelta             Boolean    @default(false)
  fechaResolucion      DateTime?
  accionTomada         String?
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  buildings            buildings? @relation(fields: [buildingId], references: [id])
  units                units?     @relation(fields: [unitId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([resuelta])
  @@index([tipo])
  @@index([unitId])
}

model energy_certificates {
  id                     String         @id
  companyId              String
  unitId                 String
  numeroCertificado      String?
  calificacion           energy_ratings
  consumoEnergetico      Float?
  emisionesCO2           Float?
  nombreTecnico          String
  numeroColegiadoTecnico String?
  empresaCertificadora   String?
  fechaEmision           DateTime
  fechaVencimiento       DateTime
  vigente                Boolean        @default(true)
  recomendaciones        String?
  ahorroEstimado         Float?
  urlCertificado         String?
  notas                  String?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime
  company                company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                  units          @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([calificacion])
  @@index([companyId])
  @@index([fechaVencimiento])
  @@index([unitId])
  @@index([vigente])
}

model energy_readings {
  id              String     @id
  companyId       String
  buildingId      String?
  unitId          String?
  tipo            EnergyType
  lecturaAnterior Float?
  lecturaActual   Float
  consumo         Float
  fechaLectura    DateTime
  periodo         String
  costo           Float?
  registradoPor   String
  notas           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  buildings       buildings? @relation(fields: [buildingId], references: [id])
  units           units?     @relation(fields: [unitId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([fechaLectura])
  @@index([periodo])
  @@index([tipo])
  @@index([unitId])
}

model esg_certifications {
  id                 String     @id
  companyId          String
  buildingId         String?
  nombre             String
  tipo               String
  nivel              String?
  estado             String     @default("en_proceso")
  progreso           Int        @default(0)
  fechaSolicitud     DateTime?
  fechaObtencion     DateTime?
  fechaExpiracion    DateTime?
  fechaRenovacion    DateTime?
  requisitos         Json
  puntajeObtenido    Int?
  puntajeMaximo      Int?
  documentos         Json?
  certificado        String?
  costoSolicitud     Float?
  costoMantenimiento Float?
  auditor            String?
  proximaAuditoria   DateTime?
  creadoPor          String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime
  buildings          buildings? @relation(fields: [buildingId], references: [id])
  company            company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, tipo, estado])
}

model esg_reports {
  id                 String    @id
  companyId          String
  periodo            String
  a_oFiscal          Int       @map("añoFiscal")
  trimestre          Int?
  datosAmbientales   Json
  datosSociales      Json
  datosGobernanza    Json
  emisionesTotales   Float
  consumoEnergia     Float
  energiaRenovable   Float
  aguaConsumida      Float
  residuosGenerados  Float
  residuosReciclados Float
  normativa          String?
  cumple             Boolean   @default(false)
  formato            String    @default("GRI")
  idioma             String    @default("es")
  estado             String    @default("borrador")
  archivoUrl         String?
  generadoPor        String?
  revisadoPor        String?
  aprobadoPor        String?
  fechaPublicacion   DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  company            company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, periodo])
}

model event_attendees {
  id               String   @id
  eventId          String
  tenantId         String?
  nombreExterno    String?
  emailExterno     String?
  confirmado       Boolean  @default(false)
  enListaEspera    Boolean  @default(false)
  fechaInscripcion DateTime @default(now())
  asistio          Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  tenants          tenants? @relation(fields: [tenantId], references: [id])

  @@unique([eventId, tenantId])
  @@index([eventId])
  @@index([tenantId])
}

model event_comments {
  id          String   @id
  eventId     String
  tenantId    String?
  autorNombre String?
  contenido   String
  moderado    Boolean  @default(false)
  visible     Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  tenants     tenants? @relation(fields: [tenantId], references: [id])

  @@index([eventId])
  @@index([tenantId])
}

model ewoorker_asiento_subcontratacion {
  id                             String                         @id
  libroId                        String
  numeroAsiento                  Int
  fechaRegistro                  DateTime                       @default(now())
  subcontratistaId               String
  subcontratistaNombre           String
  subcontratistaCIF              String
  objetoContrato                 String
  importeContrato                Float
  fechaInicio                    DateTime
  fechaFinPrevista               DateTime
  fechaFinReal                   DateTime?
  nivelSubcontratacion           Int
  empresaContratante             String
  cifContratante                 String
  numeroTrabajadores             Int
  listaTrabajadores              Json
  numeroREA                      String?
  fechaCaducidadREA              DateTime?
  numeroSeguroRC                 String?
  cobertura                      Float?
  observaciones                  String?
  autorizacionEspecial           String?
  vigente                        Boolean                        @default(true)
  motivoBaja                     String?
  fechaBaja                      DateTime?
  createdAt                      DateTime                       @default(now())
  updatedAt                      DateTime
  ewoorker_libro_subcontratacion ewoorker_libro_subcontratacion @relation(fields: [libroId], references: [id], onDelete: Cascade)

  @@unique([libroId, numeroAsiento])
  @@index([libroId])
  @@index([nivelSubcontratacion])
  @@index([subcontratistaId])
}

model ewoorker_certificacion {
  id                      String                  @id
  contratoId              String
  perfilSubcontratistaId  String
  mes                     Int
  ano                     Int
  numeroCertificacion     Int
  subtotal                Float
  iva                     Float
  total                   Float
  partesIncluidos         String[]
  unidadesCertificadas    Json
  estado                  String                  @default("PROFORMA")
  fechaAprobacion         DateTime?
  fechaPago               DateTime?
  pdfUrl                  String?
  observaciones           String?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  ewoorker_contrato       ewoorker_contrato       @relation(fields: [contratoId], references: [id], onDelete: Cascade)
  ewoorker_perfil_empresa ewoorker_perfil_empresa @relation(fields: [perfilSubcontratistaId], references: [id])

  @@unique([contratoId, mes, ano])
  @@index([contratoId])
  @@index([estado])
  @@index([perfilSubcontratistaId])
}

model ewoorker_change_order {
  id                    String            @id
  contratoId            String
  numero                Int
  titulo                String
  descripcion           String
  justificacion         String
  solicitadoPor         String
  solicitanteNombre     String
  fechaSolicitud        DateTime          @default(now())
  impactoPresupuesto    Float
  nuevoPresupuestoTotal Float?
  impactoPlazo          Int
  nuevaFechaFin         DateTime?
  estado                String            @default("PENDIENTE")
  fechaRespuesta        DateTime?
  respondidoPor         String?
  motivoRechazo         String?
  planos                String[]          @default([])
  presupuestoDetallado  String?
  documentosAdjuntos    String[]          @default([])
  aprobado              Boolean           @default(false)
  fechaAprobacion       DateTime?
  firmaAprobacion       String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  ewoorker_contrato     ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@unique([contratoId, numero])
  @@index([contratoId])
  @@index([estado])
}

model ewoorker_contrato {
  id                                                                                  String                   @id
  obraId                                                                              String                   @unique
  ofertaId                                                                            String                   @unique
  constructorId                                                                       String
  subcontratistaId                                                                    String
  presupuestoTotal                                                                    Float
  formaPago                                                                           String
  certificaciones                                                                     Json
  garantiaMeses                                                                       Int
  fechaInicio                                                                         DateTime
  fechaFinEstimada                                                                    DateTime
  plazoEjecucionDias                                                                  Int
  fechaFinReal                                                                        DateTime?
  estado                                                                              EwoorkerEstadoContrato   @default(BORRADOR)
  progreso                                                                            Int                      @default(0)
  firmaConstructor                                                                    String?
  firmaSubcontratista                                                                 String?
  fechaFirmaConstructor                                                               DateTime?
  fechaFirmaSubcontratista                                                            DateTime?
  ipFirmaConstructor                                                                  String?
  ipFirmaSubcontratista                                                               String?
  usaEscrow                                                                           Boolean                  @default(false)
  comisionEscrow                                                                      Float                    @default(2.5)
  numeroContrato                                                                      String                   @unique
  condicionesEspeciales                                                               String?
  clausulasPenalizacion                                                               String?
  fechaFinalizacion                                                                   DateTime?
  motivoCancelacion                                                                   String?
  createdAt                                                                           DateTime                 @default(now())
  updatedAt                                                                           DateTime
  ewoorker_certificacion                                                              ewoorker_certificacion[]
  ewoorker_change_order                                                               ewoorker_change_order[]
  ewoorker_perfil_empresa_ewoorker_contrato_constructorIdToewoorker_perfil_empresa    ewoorker_perfil_empresa  @relation("ewoorker_contrato_constructorIdToewoorker_perfil_empresa", fields: [constructorId], references: [id])
  ewoorker_obra                                                                       ewoorker_obra            @relation(fields: [obraId], references: [id], onDelete: Cascade)
  ewoorker_oferta                                                                     ewoorker_oferta          @relation(fields: [ofertaId], references: [id])
  ewoorker_perfil_empresa_ewoorker_contrato_subcontratistaIdToewoorker_perfil_empresa ewoorker_perfil_empresa  @relation("ewoorker_contrato_subcontratistaIdToewoorker_perfil_empresa", fields: [subcontratistaId], references: [id])
  ewoorker_fichaje                                                                    ewoorker_fichaje[]
  ewoorker_hito_contrato                                                              ewoorker_hito_contrato[]
  ewoorker_incidencia                                                                 ewoorker_incidencia[]
  ewoorker_mensaje_obra                                                               ewoorker_mensaje_obra[]
  ewoorker_pago                                                                       ewoorker_pago[]
  ewoorker_parte_trabajo                                                              ewoorker_parte_trabajo[]
  ewoorker_review                                                                     ewoorker_review[]

  @@index([constructorId])
  @@index([estado])
  @@index([fechaInicio])
  @@index([obraId])
  @@index([subcontratistaId])
}

model ewoorker_documento {
  id                      String                  @id
  perfilId                String
  tipo                    String
  categoria               String
  nombreArchivo           String
  urlArchivo              String
  tamanoBytes             Int
  mimeType                String
  datosExtraidos          Json?
  numeroDocumento         String?
  fechaEmision            DateTime?
  fechaCaducidad          DateTime?
  estado                  EwoorkerEstadoDocumento @default(PENDIENTE_VALIDACION)
  validadoPor             String?
  fechaValidacion         DateTime?
  confianzaOCR            Float?
  requiereRevisionManual  Boolean                 @default(false)
  alertaCaducidad30dias   Boolean                 @default(false)
  alertaCaducidad15dias   Boolean                 @default(false)
  alertaCaducidad7dias    Boolean                 @default(false)
  fechaUltimaAlerta       DateTime?
  observaciones           String?
  version                 Int                     @default(1)
  documentoAnteriorId     String?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  ewoorker_perfil_empresa ewoorker_perfil_empresa @relation(fields: [perfilId], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([fechaCaducidad])
  @@index([perfilId])
  @@index([tipo])
}

model ewoorker_fichaje {
  id                  String            @id
  contratoId          String
  nombreTrabajador    String
  dniTrabajador       String
  empresaId           String
  tipo                String
  timestamp           DateTime          @default(now())
  fecha               DateTime
  hora                String
  latitud             Float
  longitud            Float
  precisi_n           Float?            @map("precisión")
  dentroPerimetro     Boolean           @default(true)
  distanciaObraMetros Float?
  fotoSelfie          String?
  dispositivoId       String?
  ipAddress           String?
  documentosValidados Boolean           @default(true)
  alertasDocumentales Json?
  observaciones       String?
  createdAt           DateTime          @default(now())
  ewoorker_contrato   ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([dniTrabajador])
  @@index([fecha])
  @@index([tipo])
}

model ewoorker_hito_contrato {
  id                       String            @id
  contratoId               String
  numero                   Int
  nombre                   String
  descripcion              String
  fechaPrevista            DateTime
  fechaReal                DateTime?
  estado                   String            @default("PENDIENTE")
  porcentajePeso           Float
  aprobadoConstructor      Boolean           @default(false)
  fechaAprobacion          DateTime?
  observacionesConstructor String?
  fotosEvidencia           String[]          @default([])
  documentosAdjuntos       String[]          @default([])
  pagaAsociado             Boolean           @default(false)
  montoPago                Float?
  createdAt                DateTime          @default(now())
  updatedAt                DateTime
  ewoorker_contrato        ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([estado])
  @@index([fechaPrevista])
}

model ewoorker_incidencia {
  id                    String            @id
  contratoId            String
  titulo                String
  descripcion           String
  tipo                  String
  gravedad              String
  reportadoPor          String
  reportadorNombre      String
  reportadorEmail       String?
  impactoPlazo          Boolean           @default(false)
  diasRetraso           Int               @default(0)
  impactoPresupuesto    Boolean           @default(false)
  montoAdicional        Float             @default(0)
  solucionPropuesta     String?
  solucionAplicada      String?
  resuelta              Boolean           @default(false)
  fechaResolucion       DateTime?
  resolvidoPor          String?
  fotos                 String[]          @default([])
  documentosAdjuntos    String[]          @default([])
  prioridad             String            @default("MEDIA")
  fechaLimite           DateTime?
  responsableResolucion String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  ewoorker_contrato     ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([gravedad])
  @@index([resuelta])
  @@index([tipo])
}

model ewoorker_libro_subcontratacion {
  id                               String                             @id
  obraId                           String                             @unique
  nombreObra                       String
  ubicacion                        String
  licenciaObra                     String?
  promotor                         String
  habilitadoPor                    String
  numeroHabilitacion               String                             @unique
  provinciaHabilitacion            String
  version                          Int                                @default(1)
  fechaApertura                    DateTime                           @default(now())
  fechaCierre                      DateTime?
  pdfOficialUrl                    String?
  ultimaExportacion                DateTime?
  cerrado                          Boolean                            @default(false)
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime
  ewoorker_asiento_subcontratacion ewoorker_asiento_subcontratacion[]
  ewoorker_obra                    ewoorker_obra                      @relation(fields: [obraId], references: [id], onDelete: Cascade)

  @@index([numeroHabilitacion])
  @@index([obraId])
}

model ewoorker_log_socio {
  id              String   @id
  userId          String?
  userName        String?
  userEmail       String?
  accion          String
  descripcion     String
  modulo          String
  ipAddress       String?
  userAgent       String?
  recursoTipo     String?
  recursoId       String?
  datosAnteriores Json?
  datosNuevos     Json?
  exitoso         Boolean  @default(true)
  error           String?
  createdAt       DateTime @default(now())

  @@index([accion])
  @@index([createdAt])
  @@index([userId])
}

model ewoorker_mensaje_obra {
  id                     String            @id
  contratoId             String
  remitenteId            String
  remitenteNombre        String
  remitenteTipo          String
  remitenteEmpresa       String
  mensaje                String
  tipo                   String            @default("NORMAL")
  adjuntos               String[]          @default([])
  referenciaHitoId       String?
  referenciaParteId      String?
  referenciaIncidenciaId String?
  esNotificacionOficial  Boolean           @default(false)
  requiereAcuseRecibo    Boolean           @default(false)
  acuseRecibo            Boolean           @default(false)
  fechaAcuseRecibo       DateTime?
  firmante               String?
  leido                  Boolean           @default(false)
  fechaLectura           DateTime?
  hashIntegridad         String?
  exportable             Boolean           @default(true)
  createdAt              DateTime          @default(now())
  updatedAt              DateTime
  ewoorker_contrato      ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@index([contratoId])
  @@index([createdAt])
  @@index([leido])
  @@index([remitenteId])
  @@index([tipo])
}

model ewoorker_metrica_socio {
  id                        String   @id
  fecha                     DateTime @default(now())
  mes                       Int
  ano                       Int
  totalEmpresas             Int      @default(0)
  empresasActivas           Int      @default(0)
  nuevasEmpresasMes         Int      @default(0)
  empresasVerificadas       Int      @default(0)
  obrasPublicadas           Int      @default(0)
  ofertasEnviadas           Int      @default(0)
  contratosActivos          Int      @default(0)
  contratosCompletados      Int      @default(0)
  gmvTotal                  Int      @default(0)
  comisionesGeneradas       Int      @default(0)
  beneficioSocio            Int      @default(0)
  beneficioPlataforma       Int      @default(0)
  suscripcionesActivas      Int      @default(0)
  mrrSuscripciones          Int      @default(0)
  usuariosObrero            Int      @default(0)
  usuariosCapataz           Int      @default(0)
  usuariosConstructor       Int      @default(0)
  tasaConversion            Float    @default(0)
  tiempoMedioAdjudicacion   Float    @default(0)
  valoracionMediaPlataforma Float    @default(0)
  comisionSuscripciones     Int      @default(0)
  comisionEscrow            Int      @default(0)
  comisionUrgentes          Int      @default(0)
  comisionOtros             Int      @default(0)
  metadataAdicional         Json?
  createdAt                 DateTime @default(now())

  @@unique([mes, ano])
  @@index([ano])
  @@index([fecha])
  @@index([mes])
}

model ewoorker_obra {
  id                             String                          @id
  companyId                      String
  perfilConstructorId            String
  titulo                         String
  descripcion                    String
  codigoObra                     String                          @unique
  categoria                      String
  subcategorias                  String[]
  especialidadesRequeridas       String[]
  provincia                      String
  municipio                      String
  direccion                      String
  codigoPostal                   String?
  latitud                        Float?
  longitud                       Float?
  unidadesObra                   Json
  tipoContrato                   String
  duracionEstimadaDias           Int
  fechaInicioDeseada             DateTime
  fechaFinDeseada                DateTime?
  urgencia                       String                          @default("NORMAL")
  presupuestoMinimo              Float?
  presupuestoMaximo              Float?
  formaPago                      String
  nivelSubcontratacionMaximo     Int                             @default(2)
  requiereREA                    Boolean                         @default(true)
  requiereSeguroRC               Boolean                         @default(true)
  coberturaMinima                Float?
  certificacionesEspecificas     String[]                        @default([])
  experienciaMinima              Int                             @default(0)
  tipoLicitacion                 String                          @default("PUBLICA")
  candidatosInvitados            String[]                        @default([])
  plazoRecepcionOfertas          Int                             @default(15)
  fechaCierreLicitacion          DateTime?
  numeroMaximoOfertas            Int                             @default(20)
  planosUrls                     String[]                        @default([])
  memoriaCalidades               String?
  planSeguridad                  String?
  otrosDocumentos                String[]                        @default([])
  estado                         EwoorkerEstadoObra              @default(BORRADOR)
  fechaPublicacion               DateTime?
  fechaAdjudicacion              DateTime?
  fechaInicio                    DateTime?
  fechaFin                       DateTime?
  ofertaAceptadaId               String?                         @unique
  subcontratistaAsignadoId       String?
  visitas                        Int                             @default(0)
  favoritosCount                 Int                             @default(0)
  createdAt                      DateTime                        @default(now())
  updatedAt                      DateTime
  ewoorker_contrato              ewoorker_contrato?
  ewoorker_libro_subcontratacion ewoorker_libro_subcontratacion?
  company                        company                         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ewoorker_perfil_empresa        ewoorker_perfil_empresa         @relation(fields: [perfilConstructorId], references: [id])
  ewoorker_oferta                ewoorker_oferta[]

  @@index([categoria])
  @@index([companyId])
  @@index([estado])
  @@index([fechaPublicacion])
  @@index([municipio])
  @@index([perfilConstructorId])
  @@index([provincia])
  @@index([urgencia])
}

model ewoorker_oferta {
  id                      String                  @id
  obraId                  String
  perfilSubcontratistaId  String
  presupuestoTotal        Float
  desgloseManoObra        Float
  desgloseMateriales      Float
  desgloseOtros           Float
  unidadesPresupuestadas  Json
  anticipoPorc            Float                   @default(20)
  certificaciones         Json                    @default("[]")
  diasEjecucion           Int
  fechaInicioDisponible   DateTime
  garantiaMeses           Int                     @default(12)
  descripcionDetallada    String
  metodologia             String?
  equipoTrabajo           Json?
  maquinariaAsignada      Json?
  materialesDetalle       Json?
  proyectosSimilares      Json                    @default("[]")
  clientesReferencia      Json                    @default("[]")
  documentosAdjuntos      String[]                @default([])
  certificados            String[]                @default([])
  polizaSeguro            String?
  estado                  EwoorkerEstadoOferta    @default(ENVIADA)
  validezDias             Int                     @default(30)
  fechaEnvio              DateTime                @default(now())
  fechaVista              DateTime?
  fechaRespuesta          DateTime?
  motivoRechazo           String?
  esUrgente               Boolean                 @default(false)
  esDestacada             Boolean                 @default(false)
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  ewoorker_contrato       ewoorker_contrato?
  ewoorker_obra           ewoorker_obra           @relation(fields: [obraId], references: [id], onDelete: Cascade)
  ewoorker_perfil_empresa ewoorker_perfil_empresa @relation(fields: [perfilSubcontratistaId], references: [id])

  @@unique([obraId, perfilSubcontratistaId])
  @@index([estado])
  @@index([fechaEnvio])
  @@index([obraId])
  @@index([perfilSubcontratistaId])
}

model ewoorker_pago {
  id                      String                  @id
  contratoId              String?
  perfilReceptorId        String
  tipo                    EwoorkerTipoComision
  concepto                String
  descripcion             String?
  montoBase               Float
  porcentajeComision      Float?
  montoComision           Float
  montoNeto               Float
  beneficioEwoorker       Float
  beneficioSocio          Float
  estado                  EwoorkerEstadoPago      @default(PENDIENTE)
  fechaSolicitud          DateTime                @default(now())
  fechaPago               DateTime?
  metodoPago              String?
  stripePaymentIntentId   String?                 @unique
  stripeTransferId        String?
  transaccionBancoId      String?
  retenidoEscrow          Boolean                 @default(false)
  fechaRetencion          DateTime?
  fechaLiberacion         DateTime?
  condicionesLiberacion   Json?
  metadata                Json?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  ewoorker_contrato       ewoorker_contrato?      @relation(fields: [contratoId], references: [id])
  ewoorker_perfil_empresa ewoorker_perfil_empresa @relation(fields: [perfilReceptorId], references: [id])

  @@index([contratoId])
  @@index([estado])
  @@index([fechaPago])
  @@index([perfilReceptorId])
  @@index([tipo])
}

model ewoorker_parte_trabajo {
  id                   String            @id
  contratoId           String
  fecha                DateTime
  numeroParte          String
  unidadesEjecutadas   Json
  trabajadores         Json
  totalHorasTrabajadas Float
  maquinaria           Json              @default("[]")
  materiales           Json              @default("[]")
  incidencias          Json?
  clima                String?
  temperaturaCelsius   Float?
  estado               String            @default("BORRADOR")
  firmaCapataz         String?
  nombreCapataz        String?
  fechaFirmaCapataz    DateTime?
  firmaJefeObra        String?
  nombreJefeObra       String?
  fechaAprobacion      DateTime?
  motivoRechazo        String?
  fotos                String[]          @default([])
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  ewoorker_contrato    ewoorker_contrato @relation(fields: [contratoId], references: [id], onDelete: Cascade)

  @@unique([contratoId, numeroParte])
  @@index([contratoId])
  @@index([estado])
  @@index([fecha])
}

model ewoorker_perfil_empresa {
  id                                                                            String                   @id
  companyId                                                                     String                   @unique
  tipoEmpresa                                                                   EwoorkerTipoEmpresa
  especialidades                                                                String[]
  subespecialidades                                                             String[]
  numeroREA                                                                     String?
  provinciaREA                                                                  String?
  fechaCaducidadREA                                                             DateTime?
  estadoREA                                                                     EwoorkerEstadoDocumento  @default(PENDIENTE_VALIDACION)
  numeroSeguroRC                                                                String?
  companiaSeguro                                                                String?
  coberturaRC                                                                   Float?
  fechaCaducidadSeguro                                                          DateTime?
  estadoSeguro                                                                  EwoorkerEstadoDocumento  @default(PENDIENTE_VALIDACION)
  numeroTrabajadores                                                            Int                      @default(0)
  maquinariaPropia                                                              Json                     @default("[]")
  experienciaAnios                                                              Int                      @default(0)
  zonasOperacion                                                                String[]
  radioOperacionKm                                                              Int                      @default(50)
  latitud                                                                       Float?
  longitud                                                                      Float?
  planActual                                                                    EwoorkerPlanSuscripcion  @default(OBRERO_FREE)
  fechaInicioplan                                                               DateTime                 @default(now())
  fechaProximoPago                                                              DateTime?
  stripeCustomerId                                                              String?                  @unique
  stripeSubscriptionId                                                          String?                  @unique
  valoracionMedia                                                               Float                    @default(0)
  totalReviews                                                                  Int                      @default(0)
  proyectosCompletados                                                          Int                      @default(0)
  tasaCumplimientoPlazos                                                        Float                    @default(100)
  disponible                                                                    Boolean                  @default(true)
  verificado                                                                    Boolean                  @default(false)
  destacado                                                                     Boolean                  @default(false)
  motivoSuspension                                                              String?
  portfolioFotos                                                                String[]                 @default([])
  certificadosCalidad                                                           String[]                 @default([])
  createdAt                                                                     DateTime                 @default(now())
  updatedAt                                                                     DateTime
  ultimaActividad                                                               DateTime                 @default(now())
  ewoorker_certificacion                                                        ewoorker_certificacion[]
  ewoorker_contrato_ewoorker_contrato_constructorIdToewoorker_perfil_empresa    ewoorker_contrato[]      @relation("ewoorker_contrato_constructorIdToewoorker_perfil_empresa")
  ewoorker_contrato_ewoorker_contrato_subcontratistaIdToewoorker_perfil_empresa ewoorker_contrato[]      @relation("ewoorker_contrato_subcontratistaIdToewoorker_perfil_empresa")
  ewoorker_documento                                                            ewoorker_documento[]
  ewoorker_obra                                                                 ewoorker_obra[]
  ewoorker_oferta                                                               ewoorker_oferta[]
  ewoorker_pago                                                                 ewoorker_pago[]
  company                                                                       company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ewoorker_review_ewoorker_review_reviewedPerfilIdToewoorker_perfil_empresa     ewoorker_review[]        @relation("ewoorker_review_reviewedPerfilIdToewoorker_perfil_empresa")
  ewoorker_review_ewoorker_review_reviewerPerfilIdToewoorker_perfil_empresa     ewoorker_review[]        @relation("ewoorker_review_reviewerPerfilIdToewoorker_perfil_empresa")

  @@index([disponible])
  @@index([planActual])
  @@index([tipoEmpresa])
  @@index([valoracionMedia])
  @@index([verificado])
}

model ewoorker_review {
  id                                                                                String                  @id
  contratoId                                                                        String
  reviewerPerfilId                                                                  String
  reviewedPerfilId                                                                  String
  reviewerTipo                                                                      String
  calificacionGeneral                                                               Float
  puntualidad                                                                       Float
  calidad                                                                           Float
  comunicacion                                                                      Float
  profesionalismo                                                                   Float
  cumplimientoPresupuesto                                                           Float
  cumplimientoPlazos                                                                Float?
  limpiezaObra                                                                      Float?
  seguridadTrabajo                                                                  Float?
  claridadRequerimientos                                                            Float?
  puntualidadPagos                                                                  Float?
  condicionesTrabajo                                                                Float?
  comentario                                                                        String
  aspectosPositivos                                                                 String[]                @default([])
  aspectosMejorables                                                                String[]                @default([])
  recomendaria                                                                      Boolean
  fotos                                                                             String[]                @default([])
  verificado                                                                        Boolean                 @default(false)
  respuesta                                                                         String?
  fechaRespuesta                                                                    DateTime?
  visible                                                                           Boolean                 @default(true)
  reportado                                                                         Boolean                 @default(false)
  motivoReporte                                                                     String?
  createdAt                                                                         DateTime                @default(now())
  updatedAt                                                                         DateTime
  ewoorker_contrato                                                                 ewoorker_contrato       @relation(fields: [contratoId], references: [id], onDelete: Cascade)
  ewoorker_perfil_empresa_ewoorker_review_reviewedPerfilIdToewoorker_perfil_empresa ewoorker_perfil_empresa @relation("ewoorker_review_reviewedPerfilIdToewoorker_perfil_empresa", fields: [reviewedPerfilId], references: [id])
  ewoorker_perfil_empresa_ewoorker_review_reviewerPerfilIdToewoorker_perfil_empresa ewoorker_perfil_empresa @relation("ewoorker_review_reviewerPerfilIdToewoorker_perfil_empresa", fields: [reviewerPerfilId], references: [id])

  @@unique([contratoId, reviewerPerfilId])
  @@index([calificacionGeneral])
  @@index([reviewedPerfilId])
  @@index([reviewerPerfilId])
  @@index([verificado])
}

model expenses {
  id                      String                    @id
  buildingId              String?
  unitId                  String?
  providerId              String?
  concepto                String
  categoria               ExpenseCategory
  monto                   Float
  fecha                   DateTime
  facturaPdfPath          String?
  notas                   String?
  requiereAprobacion      Boolean                   @default(false)
  estadoAprobacion        ApprovalStatus?           @default(pendiente)
  contasimpleExpenseId    String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  approvals               approvals[]
  bank_transactions       bank_transactions[]
  conciliaciones_manuales conciliaciones_manuales[]
  buildings               buildings?                @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  providers               providers?                @relation(fields: [providerId], references: [id])
  units                   units?                    @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([buildingId, categoria])
  @@index([buildingId, fecha])
  @@index([buildingId])
  @@index([categoria])
  @@index([createdAt])
  @@index([fecha])
  @@index([providerId])
  @@index([unitId])
}

model financial_alerts {
  id              String     @id
  companyId       String
  buildingId      String?
  tipo            String
  titulo          String
  descripcion     String
  severidad       RiskLevel
  monto           Float?
  fechaDeteccion  DateTime   @default(now())
  fechaResolucion DateTime?
  estado          String     @default("pendiente")
  responsable     String?
  accionTomada    String?
  metadata        Json?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  buildings       buildings? @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company         company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, tipo, estado])
  @@index([severidad, fechaDeteccion])
}

model firmantes {
  id                    String           @id
  documentoId           String
  nombre                String
  email                 String
  telefono              String?
  rol                   String
  orden                 Int              @default(1)
  signaturitId          String?
  estado                SignerStatus     @default(pendiente)
  enviadoEn             DateTime?
  vistoEn               DateTime?
  firmadoEn             DateTime?
  rechazadoEn           DateTime?
  motivoRechazo         String?
  recordatoriosEnviados Int              @default(0)
  ultimoRecordatorio    DateTime?
  ipFirma               String?
  geolocalizacion       String?
  dispositivo           String?
  documentos_firma      documentos_firma @relation(fields: [documentoId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@index([email])
  @@index([estado])
}

model flipping_expenses {
  id                String            @id
  projectId         String
  concepto          String
  categoria         String
  monto             Float
  fecha             DateTime
  proveedor         String?
  factura           String?
  createdAt         DateTime          @default(now())
  flipping_projects flipping_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model flipping_milestones {
  id                String            @id
  projectId         String
  titulo            String
  descripcion       String?
  fechaPrevista     DateTime
  fechaCompletado   DateTime?
  completado        Boolean           @default(false)
  createdAt         DateTime          @default(now())
  flipping_projects flipping_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model flipping_projects {
  id                     String                 @id
  companyId              String
  unitId                 String?
  buildingId             String?
  nombre                 String
  direccion              String
  descripcion            String?
  precioCompra           Float
  gastosCompra           Float                  @default(0)
  fechaCompra            DateTime?
  presupuestoRenovacion  Float
  gastosRealesRenovacion Float                  @default(0)
  precioVentaEstimado    Float
  precioVentaReal        Float?
  gastosVenta            Float                  @default(0)
  fechaVenta             DateTime?
  financiado             Boolean                @default(false)
  montoFinanciacion      Float?
  interesAnual           Float?
  fechaInicioObra        DateTime?
  fechaFinObra           DateTime?
  duracionEstimada       Int?
  duracionReal           Int?
  inversionTotal         Float?
  beneficioNeto          Float?
  roiPorcentaje          Float?
  estado                 ProjectStatus          @default(PROSPECTO)
  prioridad              String                 @default("media")
  fotosAntes             String[]               @default([])
  fotosDespues           String[]               @default([])
  documentos             String[]               @default([])
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  completadoEn           DateTime?
  flipping_expenses      flipping_expenses[]
  flipping_milestones    flipping_milestones[]
  buildings              buildings?             @relation(fields: [buildingId], references: [id])
  company                company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                  units?                 @relation(fields: [unitId], references: [id])
  flipping_renovations   flipping_renovations[]
}

model flipping_renovations {
  id                String             @id
  projectId         String
  categoria         RenovationCategory
  descripcion       String
  presupuestado     Float
  costoReal         Float?
  proveedorNombre   String?
  proveedorId       String?
  fechaInicio       DateTime?
  fechaFin          DateTime?
  completado        Boolean            @default(false)
  porcentajeAvance  Int                @default(0)
  notas             String?
  fotosProgreso     String[]           @default([])
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  flipping_projects flipping_projects  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model fraud_alerts {
  id            String    @id
  companyId     String
  entityType    String
  entityId      String
  tipo          String
  riesgo        String
  score         Float
  razon         String
  detalles      Json?
  factores      String[]
  revisado      Boolean   @default(false)
  revisadoPor   String?
  fechaRevision DateTime?
  accionTomada  String?
  notas         String?
  estado        String    @default("abierto")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  company       company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
  @@index([entityType, entityId])
}

model gallery_items {
  id                 String             @id
  galleryId          String
  tipo               GalleryItemType
  habitacion         RoomType
  url                String
  urlThumbnail       String?
  titulo             String?
  descripcion        String?
  orden              Int                @default(0)
  destacada          Boolean            @default(false)
  duracion           Int?
  tipo360            String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  property_galleries property_galleries @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@index([galleryId])
  @@index([habitacion])
  @@index([tipo])
}

model garden_plots {
  id               String        @id
  gardenId         String
  numeroParcela    String
  metrosCuadrados  Float
  tenantId         String?
  reservadaDesde   DateTime?
  reservadaHasta   DateTime?
  cultivos         Json?
  calendaroSiembra Json?
  estado           String        @default("disponible")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  urban_gardens    urban_gardens @relation(fields: [gardenId], references: [id], onDelete: Cascade)
  tenants          tenants?      @relation(fields: [tenantId], references: [id])

  @@index([gardenId, estado])
}

model gdpr_consents {
  id              String    @id
  companyId       String
  userId          String?
  tenantId        String?
  tipo            String
  descripcion     String?
  consentido      Boolean
  version         String?
  idioma          String    @default("es")
  fecha           DateTime  @default(now())
  ipAddress       String
  evidencia       String?
  revocado        Boolean   @default(false)
  fechaRevocacion DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  company         company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants         tenants?  @relation(fields: [tenantId], references: [id])
  users           users?    @relation(fields: [userId], references: [id])

  @@index([companyId, tenantId])
  @@index([companyId, userId])
}

model green_providers {
  id              String   @id
  companyId       String
  nombre          String
  tipo            String
  categoria       String?
  email           String?
  telefono        String?
  web             String?
  direccion       String?
  certificaciones Json?
  oferta          Json
  ratingESG       Float?
  verificado      Boolean  @default(false)
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  company         company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, tipo])
}

model habitability_certificates {
  id                 String    @id
  companyId          String
  unitId             String
  numeroCedula       String
  tipo               String
  estado             String
  fechaEmision       DateTime
  fechaVencimiento   DateTime?
  vigenciaIndefinida Boolean   @default(false)
  superficieUtil     Float?
  numeroHabitaciones Int?
  organismoExpedidor String
  registroNumero     String?
  documentoURL       String?
  documentoStorage   String?
  alertaEnviada      Boolean   @default(false)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  company            company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units              units     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, numeroCedula])
  @@index([companyId, estado])
  @@index([fechaVencimiento, alertaEnviada])
}

model in_app_notifications {
  id          String    @id
  userId      String
  companyId   String
  type        String
  title       String
  message     String
  icon        String?
  actionLabel String?
  actionRoute String?
  read        Boolean   @default(false)
  readAt      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  company     company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([read])
  @@index([userId])
}

model inspections {
  id              String            @id
  companyId       String
  unitId          String?
  buildingId      String?
  tipo            String
  estado          String            @default("programada")
  fechaProgramada DateTime
  fechaRealizada  DateTime?
  inspector       String
  descripcion     String?
  observaciones   String?
  fotos           String[]          @default([])
  reportePdfPath  String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  calendar_events calendar_events[]

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaProgramada])
  @@index([unitId])
}

model insurance_claims {
  id                 String         @id
  insuranceId        String
  numeroReclamo      String?
  fechaSiniestro     DateTime
  descripcion        String
  montoReclamado     Float?
  montoAprobado      Float?
  estado             claim_statuses @default(abierto)
  fechaApertura      DateTime       @default(now())
  fechaCierre        DateTime?
  documentosAdjuntos Json?
  notas              String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime
  insurances         insurances     @relation(fields: [insuranceId], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([fechaSiniestro])
  @@index([insuranceId])
}

model insurance_policies {
  id               String       @id
  companyId        String
  buildingId       String?
  tipoSeguro       String
  numeroPoliza     String       @unique
  aseguradora      String
  coberturas       String[]     @default([])
  montoCobertura   Float
  primaAnual       Float
  deducible        Float?
  fechaInicio      DateTime
  fechaVencimiento DateTime
  fechaRenovacion  DateTime?
  estado           PolicyStatus @default(activa)
  agente           String?
  telefonoAgente   String?
  emailAgente      String?
  documentoPath    String?
  notas            String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  buildings        buildings?   @relation(fields: [buildingId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaVencimiento])
}

model insurances {
  id                   String             @id
  companyId            String
  buildingId           String?
  unitId               String?
  numeroPoliza         String
  tipo                 insurance_types
  aseguradora          String
  nombreAsegurado      String
  telefonoAseguradora  String?
  emailAseguradora     String?
  contactoAgente       String?
  cobertura            String?
  sumaAsegurada        Float?
  franquicia           Float?
  fechaInicio          DateTime
  fechaVencimiento     DateTime
  primaMensual         Float?
  primaAnual           Float?
  estado               insurance_statuses @default(activa)
  renovacionAutomatica Boolean            @default(false)
  urlDocumento         String?
  documentosAdjuntos   Json?
  notas                String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime
  insurance_claims     insurance_claims[]
  buildings            buildings?         @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company              company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                units?             @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([companyId, numeroPoliza])
  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaVencimiento])
  @@index([tipo])
  @@index([unitId])
}

model integration_configs {
  id               String             @id
  companyId        String
  provider         String
  name             String
  category         String
  credentials      Json
  settings         Json?
  enabled          Boolean            @default(true)
  isConfigured     Boolean            @default(false)
  lastSyncAt       DateTime?
  lastTestAt       DateTime?
  testStatus       String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  createdBy        String?
  company          company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  integration_logs integration_logs[]

  @@unique([companyId, provider])
  @@index([category])
  @@index([companyId])
  @@index([enabled])
  @@index([provider])
}

model integration_logs {
  id                  String              @id
  integrationId       String
  companyId           String
  event               String
  status              String
  message             String?
  requestData         Json?
  responseData        Json?
  errorDetails        Json?
  duration            Int?
  createdAt           DateTime            @default(now())
  company             company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  integration_configs integration_configs @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([event])
  @@index([integrationId])
  @@index([status])
}

model iot_alerts {
  id              String      @id
  companyId       String
  deviceId        String
  tipo            String
  titulo          String
  mensaje         String
  severidad       String      @default("media")
  estado          String      @default("activa")
  reconocidaPor   String?
  fechaReconocida DateTime?
  fechaResuelta   DateTime?
  metadata        Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  company         company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  iot_devices     iot_devices @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
}

model iot_automations {
  id              String      @id
  companyId       String
  deviceId        String
  nombre          String
  descripcion     String?
  tipo            String
  condiciones     Json
  acciones        Json
  activa          Boolean     @default(true)
  ultimaEjecucion DateTime?
  vecesEjecutada  Int         @default(0)
  creadoPor       String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  company         company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  iot_devices     iot_devices @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model iot_devices {
  id                  String            @id
  companyId           String
  buildingId          String?
  unitId              String?
  nombre              String
  tipo                String
  marca               String?
  modelo              String?
  numeroSerie         String?
  protocolo           String?
  ubicacion           String?
  estado              String            @default("activo")
  conectado           Boolean           @default(false)
  ultimaConexion      DateTime?
  bateria             Int?
  configuracion       Json?
  umbrales            Json?
  endpoint            String?
  apiKey              String?
  instaladoPor        String?
  fechaInstalacion    DateTime?
  ultimoMantenimiento DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  iot_alerts          iot_alerts[]
  iot_automations     iot_automations[]
  buildings           buildings?        @relation(fields: [buildingId], references: [id])
  company             company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units               units?            @relation(fields: [unitId], references: [id])
  iot_readings        iot_readings[]

  @@index([buildingId])
  @@index([companyId])
}

model iot_readings {
  id          String      @id
  deviceId    String
  metrica     String
  valor       Float
  unidad      String
  timestamp   DateTime    @default(now())
  iot_devices iot_devices @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId, timestamp])
}

model lead_activities {
  id          String   @id
  leadId      String
  tipo        String
  titulo      String
  descripcion String?
  resultado   String?
  duracion    Int?
  fecha       DateTime @default(now())
  creadoPor   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [creadoPor], references: [id], onDelete: Cascade)
  leads       leads    @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([fecha])
  @@index([leadId])
  @@index([tipo])
}

model lead_documents {
  id        String   @id
  leadId    String
  nombre    String
  tipo      String
  url       String
  tamano    Int?
  creadoPor String
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [creadoPor], references: [id], onDelete: Cascade)
  leads     leads    @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
}

model leads {
  id                  String            @id
  companyId           String
  nombre              String
  apellidos           String?
  email               String
  telefono            String?
  empresa             String?
  cargo               String?
  direccion           String?
  ciudad              String?
  codigoPostal        String?
  pais                String?           @default("España")
  fuente              String
  origenDetalle       String?
  paginaOrigen        String?
  estado              String            @default("nuevo")
  etapa               String            @default("contacto_inicial")
  puntuacion          Int               @default(0)
  temperatura         String            @default("frio")
  tipoNegocio         String?
  verticalesInteres   String[]
  numeroUnidades      Int?
  presupuestoMensual  Float?
  urgencia            String?           @default("media")
  notas               String?
  motivoPerdida       String?
  probabilidadCierre  Float?
  fechaEstimadaCierre DateTime?
  asignadoA           String?
  ultimoContacto      DateTime?
  proximoSeguimiento  DateTime?
  numeroContactos     Int               @default(0)
  conversacionId      String?
  mensajeInicial      String?
  preguntasFrecuentes String[]
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  lead_activities     lead_activities[]
  lead_documents      lead_documents[]
  users               users?            @relation(fields: [asignadoA], references: [id])
  company             company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([asignadoA])
  @@index([companyId])
  @@index([createdAt])
  @@index([email])
  @@index([estado])
  @@index([etapa])
  @@index([fuente])
  @@index([temperatura])
}

model legal_inspections {
  id                 String           @id
  companyId          String
  unitId             String?
  buildingId         String?
  contractId         String?
  tenantId           String?
  tipo               InspectionType
  estado             InspectionStatus @default(programada)
  fechaProgramada    DateTime
  fechaRealizada     DateTime?
  inspector          String
  checklist          String
  observaciones      String?
  fotosAntes         String[]         @default([])
  fotosDespues       String[]         @default([])
  daniosEncontrados  String?
  costoEstimadoDanos Float?
  reportePdfPath     String?
  firmaTenant        String?
  firmaInspector     String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime

  @@index([companyId])
  @@index([estado])
  @@index([fechaProgramada])
  @@index([tipo])
  @@index([unitId])
}

model legal_templates {
  id             String                @id
  companyId      String
  nombre         String
  categoria      LegalTemplateCategory
  descripcion    String?
  contenido      String
  variables      String[]              @default([])
  jurisdiccion   String?
  aplicableA     String[]              @default([])
  activo         Boolean               @default(true)
  ultimaRevision DateTime?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime
  contracts      contracts[]

  @@index([categoria])
  @@index([companyId])
}

model maintenance_budgets {
  id                String   @id
  companyId         String
  buildingId        String?
  periodo           String
  presupuestoTotal  Float
  gastadoCorrectivo Float    @default(0)
  gastadoPreventivo Float    @default(0)
  gastadoEmergencia Float    @default(0)
  ahorroPreventivo  Float    @default(0)
  numeroOrdenes     Int      @default(0)
  fechaInicio       DateTime
  fechaFin          DateTime
  createdAt         DateTime @default(now())
  updatedAt         DateTime

  @@index([buildingId])
  @@index([companyId])
  @@index([periodo])
}

model maintenance_diagnostics {
  id                   String   @id
  maintenanceRequestId String
  equipoSistema        String
  sintomas             String
  diagnostico          String
  causaProbable        String
  solucionSugerida     String
  repuestosNecesarios  String?
  costoEstimado        Float?
  tiempoEstimado       Int?
  prioridad            String   @default("media")
  confianza            Float    @default(0.7)
  creadoPor            String
  createdAt            DateTime @default(now())

  @@index([equipoSistema])
  @@index([maintenanceRequestId])
}

model maintenance_failure_predictions {
  id                 String   @id
  companyId          String
  equipoSistema      String
  buildingId         String?
  unitId             String?
  probabilidadFalla  Float
  diasEstimados      Int
  factoresRiesgo     String
  recomendaciones    String
  historialAnalizado Int      @default(0)
  confianza          Float    @default(0.5)
  estado             String   @default("activa")
  fechaPrediccion    DateTime @default(now())
  fechaObjetivo      DateTime
  createdAt          DateTime @default(now())
  updatedAt          DateTime

  @@index([buildingId])
  @@index([companyId])
  @@index([equipoSistema])
  @@index([estado])
  @@index([fechaObjetivo])
}

model maintenance_history {
  id                   String    @id
  maintenanceRequestId String
  unitId               String?
  buildingId           String?
  equipoSistema        String
  tipoProblema         String
  descripcionProblema  String
  solucionAplicada     String?
  repuestosUsados      String?
  costoReparacion      Float?
  tiempoReparacion     Int?
  proveedorId          String?
  tecnicoAsignado      String?
  fechaDeteccion       DateTime
  fechaReparacion      DateTime?
  proximoMantenimiento DateTime?
  createdAt            DateTime  @default(now())

  @@index([buildingId])
  @@index([equipoSistema])
  @@index([fechaDeteccion])
  @@index([tipoProblema])
  @@index([unitId])
}

model maintenance_inventory {
  id                String    @id
  companyId         String
  buildingId        String?
  nombre            String
  categoria         String
  descripcion       String?
  codigoSKU         String?
  cantidad          Int       @default(0)
  cantidadMinima    Int       @default(5)
  unidadMedida      String    @default("unidad")
  costoUnitario     Float     @default(0)
  proveedor         String?
  ubicacion         String?
  fechaUltimaCompra DateTime?
  notas             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime

  @@index([buildingId])
  @@index([categoria])
  @@index([companyId])
}

model maintenance_metrics {
  id                       String   @id
  companyId                String
  buildingId               String?
  periodo                  String
  tiempoRespuestaPromedio  Float
  tiempoResolucionPromedio Float
  tasaResolucionPrimera    Float
  satisfaccionCliente      Float?
  costosPreventivo         Float    @default(0)
  costosCorrectivo         Float    @default(0)
  costosEmergencia         Float    @default(0)
  solicitudesCompletas     Int      @default(0)
  solicitudesPendientes    Int      @default(0)
  solicitudesAtrasadas     Int      @default(0)
  disponibilidadEquipos    Float    @default(100)
  createdAt                DateTime @default(now())

  @@index([buildingId])
  @@index([companyId])
  @@index([periodo])
}

model maintenance_requests {
  id                   String                 @id
  unitId               String
  titulo               String
  descripcion          String
  prioridad            MaintenancePriority    @default(media)
  estado               MaintenanceStatus      @default(pendiente)
  fechaSolicitud       DateTime               @default(now())
  fechaProgramada      DateTime?
  fechaCompletada      DateTime?
  providerId           String?
  costoEstimado        Float?
  costoReal            Float?
  fotosProblem         String[]               @default([])
  fotosCompletado      String[]               @default([])
  valoracion           Int?
  comentarios          String?
  requiereAprobacion   Boolean                @default(false)
  estadoAprobacion     ApprovalStatus?        @default(pendiente)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  approvals            approvals[]
  calendar_events      calendar_events[]
  providers            providers?             @relation(fields: [providerId], references: [id])
  units                units                  @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider_work_orders provider_work_orders[]

  @@index([createdAt])
  @@index([estado])
  @@index([estado, prioridad])
  @@index([fechaProgramada])
  @@index([prioridad])
  @@index([unitId, estado])
  @@index([unitId])
}

model maintenance_schedules {
  id               String              @id
  titulo           String
  descripcion      String
  tipo             String
  buildingId       String?
  unitId           String?
  frecuencia       RecurrenceFrequency
  proximaFecha     DateTime
  ultimaFecha      DateTime?
  diasAnticipacion Int                 @default(15)
  activo           Boolean             @default(true)
  providerId       String?
  costoEstimado    Float?
  notas            String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime
  buildings        buildings?          @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  providers        providers?          @relation(fields: [providerId], references: [id])
  units            units?              @relation(fields: [unitId], references: [id], onDelete: Cascade)
}

model market_data {
  id                   String   @id
  companyId            String
  zona                 String
  codigoPostal         String?
  precioPromedio       Float
  precioMin            Float
  precioMax            Float
  diasPromedioAlquiler Int?
  tasaOcupacion        Float?
  demanda              String
  tipoPropiedad        String?
  numHabitaciones      Int?
  metrosCuadrados      Int?
  fuente               String?
  muestras             Int      @default(1)
  periodo              String
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  company              company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, zona, periodo])
}

model marketplace_bookings {
  id                   String               @id
  companyId            String
  serviceId            String
  tenantId             String
  unitId               String?
  fechaSolicitud       DateTime             @default(now())
  fechaServicio        DateTime
  horaInicio           String?
  horaFin              String?
  precioBase           Float
  comision             Float
  precioTotal          Float
  estado               String               @default("pendiente")
  motivoCancelacion    String?
  pagado               Boolean              @default(false)
  metodoPago           String?
  stripePaymentId      String?
  rating               Int?
  comentario           String?
  fechaRating          DateTime?
  notasCliente         String?
  notasInternas        String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  company              company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  marketplace_services marketplace_services @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  tenants              tenants              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  units                units?               @relation(fields: [unitId], references: [id])

  @@index([companyId, tenantId, estado])
}

model marketplace_loyalty {
  id                String    @id
  companyId         String
  tenantId          String    @unique
  puntos            Int       @default(0)
  nivel             String    @default("bronce")
  descuentoActual   Float     @default(0)
  cashbackAcumulado Float     @default(0)
  puntosGanados     Int       @default(0)
  puntosCanjeados   Int       @default(0)
  serviciosUsados   Int       @default(0)
  ultimaActividad   DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  company           company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants           tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model marketplace_services {
  id                   String                 @id
  companyId            String
  providerId           String?
  nombre               String
  descripcion          String
  categoria            String
  subcategoria         String?
  tipoPrecio           String
  precio               Float?
  unidad               String?
  comisionPorcentaje   Float                  @default(10)
  disponible           Boolean                @default(true)
  horarios             Json?
  duracionEstimada     Int?
  requisitos           Json?
  incluye              Json?
  noIncluye            Json?
  rating               Float?
  totalReviews         Int                    @default(0)
  imagenes             Json?
  destacado            Boolean                @default(false)
  activo               Boolean                @default(true)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  marketplace_bookings marketplace_bookings[]
  company              company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers            providers?             @relation(fields: [providerId], references: [id])

  @@index([companyId, categoria, activo])
}

model messages {
  id                                    String        @id
  senderId                              String
  recipientId                           String
  asunto                                String
  mensaje                               String
  estado                                MessageStatus @default(enviado)
  createdAt                             DateTime      @default(now())
  updatedAt                             DateTime
  tenants_messages_recipientIdTotenants tenants       @relation("messages_recipientIdTotenants", fields: [recipientId], references: [id], onDelete: Cascade)
  tenants_messages_senderIdTotenants    tenants       @relation("messages_senderIdTotenants", fields: [senderId], references: [id], onDelete: Cascade)
}

model modelo_180_records {
  id                   String    @id
  companyId            String
  ejercicio            Int
  trimestre            Int
  nifArrendador        String
  nombreArrendador     String
  nifArrendatario      String
  nombreArrendatario   String
  baseImponible        Float
  tipoRetencion        Float
  importeRetenido      Float
  situacionInmueble    String
  referencialCatastral String?
  incluidoDeclaracion  Boolean   @default(false)
  revisado             Boolean   @default(false)
  presentado           Boolean   @default(false)
  fechaPresentacion    DateTime?
  numeroJustificante   String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  company              company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, ejercicio, trimestre, nifArrendatario])
  @@index([companyId, ejercicio, trimestre])
  @@index([presentado])
}

model modelo_347_records {
  id                      String    @id
  companyId               String
  ejercicio               Int
  trimestre               Int?
  nifDeclarante           String
  razonSocialDeclarante   String
  nifDeclarado            String
  razonSocialDeclarado    String
  tipoOperacion           String
  importeAnual            Float
  importeTrimestre1       Float     @default(0)
  importeTrimestre2       Float     @default(0)
  importeTrimestre3       Float     @default(0)
  importeTrimestre4       Float     @default(0)
  generadoAutomaticamente Boolean   @default(true)
  revisado                Boolean   @default(false)
  revisadoPor             String?
  fechaRevision           DateTime?
  presentado              Boolean   @default(false)
  fechaPresentacion       DateTime?
  numeroJustificante      String?
  archivoGenerado         String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime
  company                 company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, ejercicio, nifDeclarado])
  @@index([companyId, ejercicio])
  @@index([presentado])
}

model module_definitions {
  id              String             @id
  codigo          String             @unique
  nombre          String
  descripcion     String
  categoria       String
  icono           String?
  ruta            String
  requiereModulos String[]           @default([])
  tiersIncluido   SubscriptionTier[]
  esCore          Boolean            @default(false)
  orden           Int                @default(0)
  activo          Boolean            @default(true)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime

  @@index([categoria])
  @@index([codigo])
}

model module_usage_stats {
  id                     String    @id
  userId                 String
  companyId              String
  moduleId               String
  timesUsed              Int       @default(0)
  lastUsed               DateTime?
  totalSessionDuration   Int       @default(0)
  averageSessionDuration Float     @default(0)
  favorited              Boolean   @default(false)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime
  company                company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users                  users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId, moduleId])
  @@index([companyId])
  @@index([lastUsed])
  @@index([moduleId])
  @@index([userId])
}

model morosidad_historial {
  id            String    @id
  companyId     String
  tenantId      String
  paymentId     String?
  evento        String
  diasRetraso   Int?
  montoAfectado Float?
  accionTomada  String?
  notas         String?
  createdAt     DateTime  @default(now())
  payments      payments? @relation(fields: [paymentId], references: [id])
  tenants       tenants   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([evento])
  @@index([tenantId])
}

model morosidad_predicciones {
  id                  String          @id
  companyId           String
  tenantId            String
  contractId          String?
  probabilidadImpago  Float
  nivelRiesgo         MorosidadRiesgo
  scoring             Int
  factoresRiesgo      Json
  variablesAnalizadas Int             @default(40)
  prediccion30Dias    Float
  prediccion60Dias    Float
  prediccion90Dias    Float
  recomendaciones     Json
  accionPrioritaria   String?
  pagosATiempo        Int             @default(0)
  pagosAtrasados      Int             @default(0)
  diasPromedioRetraso Float?
  montoPendiente      Float?
  ratioIngresoRenta   Float?
  modeloVersion       String          @default("xgboost_v1")
  confianzaModelo     Float?
  ultimoEntrenamiento DateTime?
  alertaGenerada      Boolean         @default(false)
  fechaAlerta         DateTime?
  accionesTomadas     String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  validaHasta         DateTime
  contracts           contracts?      @relation(fields: [contractId], references: [id])
  tenants             tenants         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([contractId])
  @@index([nivelRiesgo])
  @@index([probabilidadImpago])
  @@index([tenantId])
  @@index([validaHasta])
}

model nft_certificates {
  id              String     @id
  companyId       String
  tipo            String
  unitId          String?
  buildingId      String?
  titulo          String
  descripcion     String?
  tokenId         String?    @unique
  contractAddress String?
  metadataUrl     String?
  imageUrl        String?
  propietario     String?
  walletAddress   String?
  mintedAt        DateTime?
  txHash          String?
  atributos       Json?
  estado          String     @default("minted")
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  buildings       buildings? @relation(fields: [buildingId], references: [id])
  company         company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units           units?     @relation(fields: [unitId], references: [id])

  @@index([companyId, tipo])
}

model notification_logs {
  id                     String                  @id
  companyId              String
  userId                 String?
  ruleId                 String?
  templateId             String?
  tipo                   NotificationType
  canal                  String
  destinatario           String
  asunto                 String?
  mensaje                String
  estado                 String
  intentos               Int                     @default(1)
  errorMsg               String?
  metadatos              Json?
  costoSMS               Decimal?                @db.Decimal(10, 4)
  leida                  Boolean                 @default(false)
  fechaLeida             DateTime?
  accionTomada           String?
  enviadoEn              DateTime                @default(now())
  company                company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  notification_rules     notification_rules?     @relation(fields: [ruleId], references: [id])
  notification_templates notification_templates? @relation(fields: [templateId], references: [id])
  users                  users?                  @relation(fields: [userId], references: [id])

  @@index([canal])
  @@index([companyId, enviadoEn])
  @@index([estado])
  @@index([tipo])
  @@index([userId, leida])
}

model notification_preferences {
  id                       String   @id
  userId                   String   @unique
  emailPagoAtrasado        Boolean  @default(true)
  emailContratoVencimiento Boolean  @default(true)
  emailMantenimiento       Boolean  @default(true)
  emailDocumento           Boolean  @default(true)
  pushPagoAtrasado         Boolean  @default(true)
  pushContratoVencimiento  Boolean  @default(true)
  pushMantenimiento        Boolean  @default(true)
  pushDocumento            Boolean  @default(false)
  frecuenciaResumen        String   @default("semanal")
  createdAt                DateTime @default(now())
  updatedAt                DateTime
}

model notification_rules {
  id                     String                  @id
  companyId              String
  nombre                 String
  descripcion            String?
  activa                 Boolean                 @default(true)
  tipoEvento             String
  condiciones            Json
  diasAnticipo           Int?
  canales                Json
  rolesDestinatarios     String[]
  usuariosEspecificos    String[]                @default([])
  templateId             String?
  asunto                 String?
  mensaje                String
  prioridad              RiskLevel               @default(bajo)
  vecesEjecutada         Int                     @default(0)
  ultimaEjecucion        DateTime?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  creadoPor              String
  notification_logs      notification_logs[]
  company                company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  notification_templates notification_templates? @relation(fields: [templateId], references: [id])

  @@index([companyId, activa])
  @@index([tipoEvento])
}

model notification_templates {
  id                 String               @id
  companyId          String?
  nombre             String
  categoria          String
  asuntoEmail        String?
  mensajeEmail       String?
  mensajePush        String?
  mensajeSMS         String?
  variables          String[]             @default([])
  esPlantillaGlobal  Boolean              @default(false)
  activa             Boolean              @default(true)
  vecesUsada         Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  notification_logs  notification_logs[]
  notification_rules notification_rules[]
  company            company?             @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@index([companyId])
}

model notifications {
  id          String           @id
  companyId   String
  tipo        NotificationType
  titulo      String
  mensaje     String
  leida       Boolean          @default(false)
  prioridad   RiskLevel        @default(bajo)
  fechaLimite DateTime?
  entityId    String?
  entityType  String?
  userId      String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  company     company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       users?           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId, createdAt])
  @@index([companyId, leida])
  @@index([createdAt])
  @@index([leida])
  @@index([tipo])
  @@index([userId])
  @@index([userId, leida])
}

model nps_surveys {
  id            String      @id
  companyId     String
  tenantId      String
  score         Int
  categoria     NPSCategory
  comentario    String?
  fechaEncuesta DateTime
  respondido    Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime
  company       company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants       tenants     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fechaEncuesta])
  @@index([tenantId])
}

model onboarding_tasks {
  id            String               @id
  userId        String
  companyId     String
  vertical      String
  taskId        String
  title         String
  description   String
  type          OnboardingTaskType
  status        OnboardingTaskStatus @default(pending)
  order         Int                  @default(0)
  isMandatory   Boolean              @default(false)
  estimatedTime Int                  @default(60)
  route         String?
  videoUrl      String?
  helpArticle   String?
  unlocks       String[]             @default([])
  completedAt   DateTime?
  skippedAt     DateTime?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime
  company       company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users         users                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId, taskId])
  @@index([companyId])
  @@index([status])
  @@index([userId])
}

model owner_alerts {
  id               String    @id
  ownerId          String
  companyId        String
  buildingId       String?
  nombre           String
  descripcion      String?
  tipo             String
  umbralValor      Float?
  umbralPorcentaje Float?
  activa           Boolean   @default(true)
  ultimaActivacion DateTime?
  vecesActivada    Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  company          company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  owners           owners    @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([companyId])
  @@index([ownerId, activa])
}

model owner_buildings {
  id                  String    @id
  ownerId             String
  buildingId          String
  companyId           String
  porcentajePropiedad Float     @default(100)
  verIngresos         Boolean   @default(true)
  verGastos           Boolean   @default(true)
  verOcupacion        Boolean   @default(true)
  verMantenimiento    Boolean   @default(true)
  verDocumentos       Boolean   @default(false)
  asignadoEn          DateTime  @default(now())
  asignadoPor         String?
  buildings           buildings @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company             company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  owners              owners    @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([ownerId, buildingId])
  @@index([buildingId])
  @@index([companyId])
  @@index([ownerId])
}

model owner_notifications {
  id         String           @id
  ownerId    String
  companyId  String
  titulo     String
  mensaje    String
  tipo       NotificationType
  buildingId String?
  paymentId  String?
  contractId String?
  leida      Boolean          @default(false)
  fechaLeida DateTime?
  createdAt  DateTime         @default(now())
  company    company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  owners     owners           @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([ownerId, leida])
}

model owners {
  id                     String                @id
  companyId              String
  nombreCompleto         String
  email                  String                @unique
  telefono               String?
  dni                    String?               @unique
  direccion              String?
  password               String
  activo                 Boolean               @default(true)
  emailVerificado        Boolean               @default(false)
  notificarPagos         Boolean               @default(true)
  notificarOcupacion     Boolean               @default(true)
  notificarMantenimiento Boolean               @default(true)
  notificarVencimientos  Boolean               @default(true)
  idioma                 String                @default("es")
  zona                   String?
  lastLogin              DateTime?
  resetToken             String?               @unique
  resetTokenExpiry       DateTime?
  loginAttempts          Int                   @default(0)
  lockoutUntil           DateTime?
  createdAt              DateTime              @default(now())
  createdBy              String?
  updatedAt              DateTime
  owner_alerts           owner_alerts[]
  owner_buildings        owner_buildings[]
  owner_notifications    owner_notifications[]
  company                company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([activo])
  @@index([companyId, activo])
  @@index([companyId])
  @@index([email])
}

model p2p_bookings {
  id           String       @id
  serviceId    String
  clientId     String
  fechaReserva DateTime
  horaInicio   String?
  horaFin      String?
  precio       Float
  comision     Float
  total        Float
  estado       String       @default("pendiente")
  pagado       Boolean      @default(false)
  fechaPago    DateTime?
  metodoPago   String?
  valoracion   Int?
  comentario   String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  tenants      tenants      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  p2p_services p2p_services @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([serviceId, estado])
}

model p2p_services {
  id              String         @id
  companyId       String
  providerId      String
  titulo          String
  descripcion     String
  categoria       String
  precio          Float
  moneda          String         @default("EUR")
  duracion        Int?
  unidadDuracion  String?
  disponibilidad  Json?
  fotos           String[]
  rating          Float?
  numValoraciones Int            @default(0)
  activo          Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  p2p_bookings    p2p_bookings[]
  company         company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenants         tenants        @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([companyId, categoria])
  @@index([providerId])
}

model payments {
  id                      String                    @id
  contractId              String
  periodo                 String
  monto                   Float
  fechaVencimiento        DateTime
  fechaPago               DateTime?
  estado                  PaymentStatus             @default(pendiente)
  metodoPago              String?
  reciboPdfPath           String?
  nivelRiesgo             RiskLevel                 @default(bajo)
  stripePaymentIntentId   String?                   @unique
  stripePaymentStatus     StripePaymentStatus?
  stripeClientSecret      String?
  stripeFee               Float?
  stripeNetAmount         Float?
  contasimplePaymentId    String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  stripeSubscriptionId    String?
  bad_debt_provisions     bad_debt_provisions?
  bank_transactions       bank_transactions[]
  calendar_events         calendar_events[]
  conciliaciones_manuales conciliaciones_manuales[]
  morosidad_historial     morosidad_historial[]
  contracts               contracts                 @relation(fields: [contractId], references: [id], onDelete: Cascade)
  stripe_subscriptions    stripe_subscriptions?     @relation(fields: [stripeSubscriptionId], references: [id])

  @@index([contractId, estado, fechaVencimiento])
  @@index([contractId, estado])
  @@index([contractId, fechaVencimiento])
  @@index([estado, fechaVencimiento])
  @@index([estado])
  @@index([fechaPago])
  @@index([fechaVencimiento])
  @@index([nivelRiesgo, estado])
}

model performance_metrics {
  id         String   @id
  companyId  String
  metricType String
  metricName String
  value      Float
  metadata   Json?
  createdAt  DateTime @default(now())
  company    company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([metricType])
}

model pomelli_configs {
  id                   String                 @id
  companyId            String                 @unique
  apiKey               String
  apiSecret            String
  webhookUrl           String?
  enabled              Boolean                @default(true)
  lastSyncAt           DateTime?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  company              company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pomelli_social_posts pomelli_social_posts[]
  social_profiles      social_profiles[]

  @@index([companyId])
}

model pomelli_social_posts {
  id              String            @id
  companyId       String
  pomelliConfigId String
  userId          String
  content         String
  contentType     String
  mediaUrls       String[]          @default([])
  platforms       String[]          @default([])
  status          String
  scheduledAt     DateTime?
  publishedAt     DateTime?
  pomelliPostId   String?
  impressions     Int               @default(0)
  reach           Int               @default(0)
  likes           Int               @default(0)
  comments        Int               @default(0)
  shares          Int               @default(0)
  clicks          Int               @default(0)
  engagementRate  Float             @default(0)
  errorMessage    String?
  retryCount      Int               @default(0)
  maxRetries      Int               @default(3)
  lastAttemptAt   DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  company         company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pomelli_configs pomelli_configs   @relation(fields: [pomelliConfigId], references: [id], onDelete: Cascade)
  users           users             @relation(fields: [userId], references: [id], onDelete: Cascade)
  social_profiles social_profiles[] @relation("PostProfiles")

  @@index([companyId])
  @@index([publishedAt])
  @@index([scheduledAt])
  @@index([status])
  @@index([userId])
}

model post_reactions {
  id        String   @id
  postId    String
  userId    String?
  tenantId  String?
  tipo      String   @default("like")
  createdAt DateTime @default(now())
  tenants   tenants? @relation(fields: [tenantId], references: [id])

  @@unique([postId, tenantId])
  @@index([postId])
}

model prediction_models {
  id                  String    @id
  companyId           String
  tipo                String
  nombre              String
  descripcion         String?
  parametros          String
  precision           Float?
  ultimoEntrenamiento DateTime?
  activo              Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime

  @@index([companyId])
  @@index([tipo])
}

model predictions {
  id              String   @id
  companyId       String
  modelId         String?
  tipo            String
  entityId        String?
  entityType      String?
  periodo         String
  valorPredicho   Float
  confianza       Float
  factores        String
  fechaPrediccion DateTime @default(now())
  fechaObjetivo   DateTime
  valorReal       Float?
  createdAt       DateTime @default(now())

  @@index([companyId])
  @@index([entityId])
  @@index([fechaObjetivo])
  @@index([tipo])
}

model pricing_analysis {
  id                   String    @id
  companyId            String
  unitId               String
  precioActual         Float
  precioSugerido       Float
  precioMinimo         Float
  precioMaximo         Float
  precioMercado        Float?
  competidores         Json?
  factores             Json
  estacionalidad       Json?
  eventosCercanos      Json?
  probabilidadAlquiler Int
  diasHastaAlquiler    Int?
  demandaEstimada      String?
  estrategia           String?
  recomendacion        String
  aplicado             Boolean   @default(false)
  fechaAplicacion      DateTime?
  resultadoReal        String?
  validoHasta          DateTime
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  company              company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                units     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId, unitId, createdAt])
}

model pricing_strategies {
  id                 String    @id
  companyId          String
  unitId             String?
  nombre             String
  descripcion        String?
  tipo               String
  ajusteAutomatico   Boolean   @default(false)
  limitePorcentaje   Float     @default(10)
  frecuencia         String    @default("semanal")
  reglas             Json
  restricciones      Json?
  activa             Boolean   @default(true)
  ultimaEjecucion    DateTime?
  vecesAplicada      Int       @default(0)
  incrementoIngresos Float?
  reduccionVacancia  Float?
  creadoPor          String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  company            company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units              units?    @relation(fields: [unitId], references: [id])

  @@index([companyId, activa])
}

model professional_deliverables {
  id                    String                @id
  projectId             String
  nombre                String
  descripcion           String?
  fechaLimite           DateTime
  entregado             Boolean               @default(false)
  fechaEntrega          DateTime?
  archivo               String?
  comentarios           String?
  createdAt             DateTime              @default(now())
  professional_projects professional_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model professional_meetings {
  id                    String                @id
  projectId             String
  titulo                String
  fecha                 DateTime
  duracion              Int
  ubicacion             String?
  online                Boolean               @default(false)
  enlaceReunion         String?
  asistentes            String[]              @default([])
  agenda                String?
  acta                  String?
  createdAt             DateTime              @default(now())
  professional_projects professional_projects @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model professional_projects {
  id                        String                      @id
  companyId                 String
  clienteNombre             String
  clienteEmail              String
  clienteTelefono           String?
  tipo                      ProjectType
  titulo                    String
  descripcion               String
  direccion                 String
  municipio                 String?
  provincia                 String?
  honorarios                Float
  gastos                    Float                       @default(0)
  total                     Float
  fechaInicio               DateTime
  fechaEntrega              DateTime
  estado                    ProjectProfessionalStatus   @default(PROPUESTA)
  porcentajeAvance          Int                         @default(0)
  responsable               String
  colaboradores             String[]                    @default([])
  planos                    String[]                    @default([])
  informes                  String[]                    @default([])
  certificados              String[]                    @default([])
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  professional_deliverables professional_deliverables[]
  professional_meetings     professional_meetings[]
  company                   company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model property_galleries {
  id                  String          @id
  companyId           String
  unitId              String          @unique
  portada             String?
  orden               String[]
  urlTourVirtual      String?
  embedCode           String?
  usarMarcaAgua       Boolean         @default(true)
  visitas             Int             @default(0)
  ultimaActualizacion DateTime        @default(now())
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  gallery_items       gallery_items[]
  company             company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units               units           @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([unitId])
}

model property_tokens {
  id                     String               @id
  companyId              String
  unitId                 String?
  buildingId             String?
  nombre                 String
  simbolo                String
  tokenSymbol            String
  blockchain             String               @default("Polygon")
  contractAddress        String?              @unique
  tokenStandard          String               @default("ERC-20")
  totalSupply            Int
  tokensPorPropiedad     Int
  precioPorToken         Float
  valorPropiedad         Float
  valorActual            Float?
  estado                 String               @default("draft")
  fechaEmision           DateTime?
  fechaVencimiento       DateTime?
  rentaDistribuida       Float                @default(0)
  ultimaDistribucion     DateTime?
  frecuenciaDistribucion String               @default("monthly")
  documentos             Json?
  metadata               Json?
  createdAt              DateTime             @default(now())
  updatedAt              DateTime
  buildings              buildings?           @relation(fields: [buildingId], references: [id])
  company                company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                  units?               @relation(fields: [unitId], references: [id])
  token_holders          token_holders[]
  token_transactions     token_transactions[]

  @@index([companyId, estado])
  @@index([contractAddress])
}

model provider_availability {
  id          String                     @id
  providerId  String
  companyId   String
  estado      ProviderAvailabilityStatus @default(disponible)
  fechaInicio DateTime
  fechaFin    DateTime?
  motivo      String?
  notas       String?
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime
  createdBy   String?
  company     company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers   providers                  @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([estado])
  @@index([fechaFin])
  @@index([fechaInicio])
  @@index([providerId])
}

model provider_chat_conversations {
  id                     String                   @id
  companyId              String
  providerId             String
  asunto                 String
  estado                 String                   @default("activa")
  ultimoMensaje          String?
  ultimoMensajeFecha     DateTime?
  noLeidosProveedor      Int                      @default(0)
  noLeidosGestor         Int                      @default(0)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  company                company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers              providers                @relation(fields: [providerId], references: [id], onDelete: Cascade)
  provider_chat_messages provider_chat_messages[]

  @@index([companyId])
  @@index([estado])
  @@index([providerId])
  @@index([ultimoMensajeFecha])
}

model provider_chat_messages {
  id                          String                      @id
  conversationId              String
  companyId                   String
  remitenteProveedor          Boolean
  remitenteId                 String
  remitenteNombre             String
  mensaje                     String
  archivos                    String[]
  leido                       Boolean                     @default(false)
  fechaLeido                  DateTime?
  createdAt                   DateTime                    @default(now())
  company                     company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  provider_chat_conversations provider_chat_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([conversationId])
  @@index([createdAt])
  @@index([leido])
}

model provider_invoice_payments {
  id                String            @id
  invoiceId         String
  companyId         String
  monto             Float
  fechaPago         DateTime          @default(now())
  metodoPago        String
  referencia        String?
  notas             String?
  registradoPor     String
  createdAt         DateTime          @default(now())
  company           company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  provider_invoices provider_invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fechaPago])
  @@index([invoiceId])
}

model provider_invoices {
  id                        String                      @id
  companyId                 String
  providerId                String
  workOrderId               String?
  numeroFactura             String
  fechaEmision              DateTime                    @default(now())
  fechaVencimiento          DateTime
  conceptos                 Json
  subtotal                  Float
  iva                       Float                       @default(21.0)
  montoIva                  Float
  total                     Float
  estado                    ProviderInvoiceStatus       @default(borrador)
  fechaAprobacion           DateTime?
  aprobadoPor               String?
  fechaPago                 DateTime?
  metodoPago                String?
  referenciaago             String?
  pdfUrl                    String?
  notas                     String?
  motivoRechazo             String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  provider_invoice_payments provider_invoice_payments[]
  company                   company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers                 providers                   @relation(fields: [providerId], references: [id], onDelete: Cascade)
  provider_work_orders      provider_work_orders?       @relation(fields: [workOrderId], references: [id])

  @@unique([companyId, numeroFactura])
  @@index([companyId])
  @@index([estado])
  @@index([fechaVencimiento])
  @@index([providerId])
  @@index([workOrderId])
}

model provider_password_reset_tokens {
  id         String    @id
  providerId String
  token      String    @unique
  expiresAt  DateTime
  used       Boolean   @default(false)
  usedAt     DateTime?
  createdAt  DateTime  @default(now())
  providers  providers @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([providerId])
  @@index([token])
}

model provider_quotes {
  id                   String                @id
  companyId            String
  providerId           String
  workOrderId          String?
  titulo               String
  descripcion          String
  conceptos            Json
  subtotal             Float
  iva                  Float                 @default(21.0)
  montoIva             Float
  total                Float
  estado               String                @default("pendiente")
  fechaVencimiento     DateTime?
  archivos             String[]
  notas                String?
  motivoRechazo        String?
  fechaAprobacion      DateTime?
  aprobadoPor          String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  company              company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers            providers             @relation(fields: [providerId], references: [id], onDelete: Cascade)
  provider_work_orders provider_work_orders? @relation(fields: [workOrderId], references: [id])

  @@index([companyId])
  @@index([estado])
  @@index([providerId])
  @@index([workOrderId])
}

model provider_reviews {
  id                   String                @id
  companyId            String
  providerId           String
  workOrderId          String?
  puntuacion           Int
  puntualidad          Int?
  calidad              Int?
  comunicacion         Int?
  precio               Int?
  profesionalismo      Int?
  comentario           String?
  aspectosPositivos    String[]
  aspectosMejorar      String[]
  respuesta            String?
  fechaRespuesta       DateTime?
  visible              Boolean               @default(true)
  evaluadoPor          String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  company              company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  providers            providers             @relation(fields: [providerId], references: [id], onDelete: Cascade)
  provider_work_orders provider_work_orders? @relation(fields: [workOrderId], references: [id])

  @@index([companyId])
  @@index([providerId])
  @@index([puntuacion])
  @@index([visible])
  @@index([workOrderId])
}

model provider_work_orders {
  id                   String                @id
  companyId            String
  providerId           String
  maintenanceRequestId String?
  buildingId           String
  unitId               String?
  titulo               String
  descripcion          String
  tipo                 String
  estado               WorkOrderStatus       @default(asignada)
  prioridad            String                @default("media")
  fechaAsignacion      DateTime              @default(now())
  fechaEstimada        DateTime?
  fechaInicio          DateTime?
  fechaCompletado      DateTime?
  fotosAntes           String[]
  fotosDespues         String[]
  materialesUsados     Json?
  horasTrabajadas      Float?
  presupuestoInicial   Float?
  costoMateriales      Float?
  costoManoObra        Float?
  costoTotal           Float?
  firmadoPor           String?
  firmaDigital         String?
  fechaFirma           DateTime?
  valoracion           Int?
  comentarios          String?
  asignadoPor          String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  provider_invoices    provider_invoices[]
  provider_quotes      provider_quotes[]
  provider_reviews     provider_reviews[]
  buildings            buildings             @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company              company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  maintenance_requests maintenance_requests? @relation(fields: [maintenanceRequestId], references: [id])
  providers            providers             @relation(fields: [providerId], references: [id], onDelete: Cascade)
  units                units?                @relation(fields: [unitId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([estado])
  @@index([fechaAsignacion])
  @@index([providerId])
}

model providers {
  id                             String                           @id
  companyId                      String
  nombre                         String
  tipo                           String
  telefono                       String
  email                          String?
  direccion                      String?
  rating                         Float?
  notas                          String?
  password                       String?
  activo                         Boolean                          @default(true)
  ultimoAcceso                   DateTime?
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime
  expenses                       expenses[]
  maintenance_requests           maintenance_requests[]
  maintenance_schedules          maintenance_schedules[]
  marketplace_services           marketplace_services[]
  provider_availability          provider_availability[]
  provider_chat_conversations    provider_chat_conversations[]
  provider_invoices              provider_invoices[]
  provider_password_reset_tokens provider_password_reset_tokens[]
  provider_quotes                provider_quotes[]
  provider_reviews               provider_reviews[]
  provider_work_orders           provider_work_orders[]
  company                        company                          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  service_jobs                   service_jobs[]
  service_quotes                 service_quotes[]
  service_reviews                service_reviews[]
}

model publicaciones_portales {
  id                    String            @id
  companyId             String
  unitId                String
  buildingId            String?
  titulo                String
  descripcion           String
  descripcionCorta      String?
  portales              Json
  fotosUrls             Json
  videoUrl              String?
  tourVirtualUrl        String?
  precioVenta           Float?
  precioAlquiler        Float?
  gastosIncluidos       Boolean           @default(false)
  fianza                Float?
  condicionesEspeciales String?
  caracteristicas       Json
  palabrasClave         Json?
  destacada             Boolean           @default(false)
  urgente               Boolean           @default(false)
  estado                PublicacionEstado @default(borrador)
  fechaPublicacion      DateTime?
  fechaExpiracion       DateTime?
  vistas                Int               @default(0)
  contactos             Int               @default(0)
  favoritos             Int               @default(0)
  creadoPor             String
  ultimaActualizacion   String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  buildings             buildings?        @relation(fields: [buildingId], references: [id])
  company               company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                 units             @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([estado])
  @@index([fechaPublicacion])
  @@index([unitId])
}

model push_subscriptions {
  id        String   @id
  userId    String
  endpoint  String   @unique
  p256dh    String
  auth      String
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model recommendations {
  id              String    @id
  companyId       String
  tipo            String
  prioridad       String    @default("media")
  titulo          String
  descripcion     String
  entityId        String?
  entityType      String?
  impactoEstimado Float?
  accionSugerida  String
  aplicada        Boolean   @default(false)
  fechaAplicacion DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([companyId])
  @@index([prioridad])
  @@index([tipo])
}

model reconciliation_rules {
  id               String    @id
  companyId        String
  nombre           String
  descripcion      String?
  activa           Boolean   @default(true)
  prioridad        Int       @default(1)
  condiciones      Json
  accionTipo       String
  accionConfig     Json?
  vecesAplicada    Int       @default(0)
  ultimaAplicacion DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime

  @@index([activa])
  @@index([companyId])
  @@index([prioridad])
}

model recycling_metrics {
  id                 String     @id
  companyId          String
  buildingId         String?
  periodo            String
  residuosGenerados  Float
  residuosReciclados Float
  residuosOrganicos  Float
  tasaReciclaje      Float
  participantes      Int?
  puntosOtorgados    Int?
  ahorrosCO2         Float?
  createdAt          DateTime   @default(now())
  buildings          buildings? @relation(fields: [buildingId], references: [id])
  company            company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, periodo])
}

model reservation_credits {
  id                  String   @id
  tenantId            String   @unique
  creditosActuales    Int      @default(10)
  creditosMaximos     Int      @default(10)
  creditosUsados      Int      @default(0)
  penalizacionesTotal Int      @default(0)
  ultimaRecarga       DateTime @default(now())
  proximaRecarga      DateTime
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  tenants             tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model reviews {
  id              String           @id
  companyId       String
  entityType      ReviewEntityType
  entityId        String
  reviewerId      String
  reviewerType    String
  reviewerName    String
  rating          Int
  titulo          String
  comentario      String
  aspectos        Json?
  respuesta       String?
  respondidoPor   String?
  fechaRespuesta  DateTime?
  verificado      Boolean          @default(false)
  contratoId      String?
  ordenTrabajoId  String?
  estado          ReviewStatus     @default(pendiente)
  moderadoPor     String?
  fechaModeracion DateTime?
  motivoRechazo   String?
  likes           Int              @default(0)
  dislikes        Int              @default(0)
  reportes        Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  company         company          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([entityType, entityId])
  @@index([estado])
  @@index([rating])
  @@index([reviewerId])
}

model room_contracts {
  id                 String             @id
  companyId          String
  roomId             String
  tenantId           String
  fechaInicio        DateTime
  fechaFin           DateTime
  rentaMensual       Float
  diaPago            Int                @default(1)
  deposito           Float              @default(0)
  gastosIncluidos    String[]           @default([])
  normasConvivencia  String?
  horariosVisitas    String?
  permiteMascotas    Boolean            @default(false)
  permiteFumar       Boolean            @default(false)
  frecuenciaLimpieza String?
  rotacionLimpieza   Json?
  estado             RoomContractStatus @default(activo)
  documentoURL       String?
  firmadoFecha       DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  company            company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  rooms              rooms              @relation(fields: [roomId], references: [id], onDelete: Cascade)
  tenants            tenants            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  room_payments      room_payments[]
}

model room_payments {
  id                     String             @id
  companyId              String
  contractId             String
  concepto               String             @default("Renta mensual")
  mes                    DateTime
  monto                  Float
  montoProrrateoLuz      Float?
  montoProrrateoAgua     Float?
  montoProrrateoGas      Float?
  montoProrrateoInternet Float?
  montoProrrateoLimpieza Float?
  estado                 PaymentStatus      @default(pendiente)
  fechaVencimiento       DateTime
  fechaPago              DateTime?
  metodoPago             RoomPaymentMethod?
  notas                  String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime
  company                company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  room_contracts         room_contracts     @relation(fields: [contractId], references: [id], onDelete: Cascade)
}

model room_shared_spaces {
  id              String   @id
  companyId       String
  unitId          String
  nombre          String
  tipo            String
  superficie      Float?
  nevera          Boolean  @default(false)
  horno           Boolean  @default(false)
  microondas      Boolean  @default(false)
  lavadora        Boolean  @default(false)
  secadora        Boolean  @default(false)
  lavavajillas    Boolean  @default(false)
  television      Boolean  @default(false)
  sofa            Boolean  @default(false)
  mesaComedor     Boolean  @default(false)
  normasUso       String?
  horarioAcceso   String?
  capacidadMaxima Int?
  imagenes        String[] @default([])
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  company         company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units           units    @relation(fields: [unitId], references: [id], onDelete: Cascade)
}

model rooms {
  id                 String               @id
  companyId          String
  unitId             String
  numero             String
  nombre             String?
  superficie         Float
  tipoHabitacion     String
  escritorio         Boolean              @default(false)
  armarioEmpotrado   Boolean              @default(false)
  aireAcondicionado  Boolean              @default(false)
  calefaccion        Boolean              @default(false)
  amueblada          Boolean              @default(true)
  cama               String?
  mesaNoche          Boolean              @default(false)
  cajonera           Boolean              @default(false)
  estanteria         Boolean              @default(false)
  silla              Boolean              @default(false)
  precioPorSemana    Float?
  estado             RoomStatus           @default(disponible)
  imagenes           String[]             @default([])
  descripcion        String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  banoPrivado        Boolean              @default(false)
  rentaMensual       Float
  tieneBalcon        Boolean              @default(false)
  ColivingCheckInOut ColivingCheckInOut[]
  SmartLock          SmartLock[]
  room_contracts     room_contracts[]
  company            company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units              units                @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, numero])
}

model saved_searches {
  id        String   @id
  userId    String
  companyId String
  nombre    String
  query     String
  filters   Json?
  activa    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
  company   company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([userId])
}

model scheduled_emails {
  id           String    @id
  userId       String
  templateId   String
  scheduledFor DateTime
  sentAt       DateTime?
  trigger      String
  status       String    @default("pending")
  metadata     Json?
  error        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  users        users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([scheduledFor])
  @@index([status])
  @@index([trigger])
  @@index([userId])
}

model scheduled_reports {
  id            String          @id
  companyId     String
  nombre        String
  tipo          ReportType
  frecuencia    ReportFrequency
  destinatarios String[]        @default([])
  ultimoEnvio   DateTime?
  proximoEnvio  DateTime
  activo        Boolean         @default(true)
  incluirPdf    Boolean         @default(true)
  incluirCsv    Boolean         @default(true)
  filtros       String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
}

model screening_candidatos {
  id                        String          @id
  companyId                 String
  candidateId               String          @unique
  estado                    ScreeningEstado @default(pendiente)
  scoringTotal              Float           @default(0)
  dniVerificado             Boolean         @default(false)
  dniComentarios            String?
  dniPuntos                 Float           @default(0)
  contratoTrabajoVerificado Boolean         @default(false)
  nominasVerificadas        Boolean         @default(false)
  mesesNominas              Int             @default(0)
  empresaContactada         Boolean         @default(false)
  laboralComentarios        String?
  laboralPuntos             Float           @default(0)
  ingresosVerificados       Boolean         @default(false)
  ratioIngresosRenta        Float?
  cuentaBancariaVerificada  Boolean         @default(false)
  ahorrosVerificados        Boolean         @default(false)
  economicaComentarios      String?
  economicaPuntos           Float           @default(0)
  referenciasPersonales     Int             @default(0)
  referenciasLaborales      Int             @default(0)
  referenciasPrevias        Int             @default(0)
  referenciasContactadas    Int             @default(0)
  referenciasPositivas      Int             @default(0)
  referenciasComentarios    String?
  referenciasPuntos         Float           @default(0)
  ficherosMorosidad         Boolean         @default(false)
  impagosAnteriores         Boolean         @default(false)
  demandasPrevias           Boolean         @default(false)
  antecedentesComentarios   String?
  antecedentesPuntos        Float           @default(15)
  documentosRequeridos      Json
  documentosCompletos       Boolean         @default(false)
  flagsRiesgo               Json?
  nivelRiesgoGlobal         RiskLevel       @default(medio)
  entrevistaRealizada       Boolean         @default(false)
  visitaRealizada           Boolean         @default(false)
  impresionGeneral          String?
  aprobado                  Boolean?
  motivoRechazo             String?
  condicionesEspeciales     String?
  revisadoPor               String?
  fechaRevision             DateTime?
  fechaDecision             DateTime?
  notas                     String?
  createdAt                 DateTime        @default(now())
  updatedAt                 DateTime
  candidates                candidates      @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  company                   company         @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([companyId])
  @@index([estado])
  @@index([nivelRiesgoGlobal])
  @@index([scoringTotal])
}

model search_history {
  id          String   @id
  userId      String
  companyId   String
  query       String
  filters     Json?
  resultCount Int      @default(0)
  createdAt   DateTime @default(now())
  company     company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([userId])
}

model security_audits {
  id               String    @id
  companyId        String
  tipo             String
  alcance          String?
  fechaInicio      DateTime
  fechaFin         DateTime?
  auditor          String?
  herramienta      String?
  vulnerabilidades Json?
  numCriticas      Int       @default(0)
  numAltas         Int       @default(0)
  numMedias        Int       @default(0)
  numBajas         Int       @default(0)
  recomendaciones  Json?
  scoreSeguridad   Float?
  reporteUrl       String?
  estado           String    @default("en_progreso")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  company          company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, tipo])
}

model security_events {
  id              String        @id
  companyId       String
  tipo            String
  severidad       AuditSeverity @default(warning)
  userId          String?
  ipAddress       String?
  userAgent       String?
  descripcion     String
  detalles        Json?
  resuelta        Boolean       @default(false)
  resolucionNota  String?
  resueltoPor     String?
  fechaResolucion DateTime?
  createdAt       DateTime      @default(now())
  users           users?        @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([createdAt])
  @@index([resuelta])
  @@index([severidad])
  @@index([tipo])
}

model security_incidents {
  id                  String    @id
  companyId           String
  tipo                String
  severidad           String
  titulo              String
  descripcion         String
  afectados           Json?
  datosComprometidos  Json?
  detectadoPor        String?
  fechaDeteccion      DateTime  @default(now())
  fechaIncidente      DateTime?
  estado              String    @default("detectado")
  responsable         String?
  fechaAsignacion     DateTime?
  accionesCorrectivas Json?
  fechaResolucion     DateTime?
  notificadoGDPR      Boolean   @default(false)
  fechaNotificacion   DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  company             company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, estado])
}

model service_jobs {
  id               String            @id
  companyId        String
  providerId       String
  quoteId          String?
  buildingId       String?
  unitId           String?
  titulo           String
  descripcion      String
  fechaInicio      DateTime
  fechaFin         DateTime?
  estado           JobStatus         @default(pendiente)
  montoTotal       Float
  montoPagado      Float             @default(0)
  garantiaMeses    Int?
  notasTrabajo     String?
  resultadoTrabajo String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  buildings        buildings?        @relation(fields: [buildingId], references: [id])
  providers        providers         @relation(fields: [providerId], references: [id], onDelete: Cascade)
  service_quotes   service_quotes?   @relation(fields: [quoteId], references: [id])
  units            units?            @relation(fields: [unitId], references: [id])
  service_reviews  service_reviews[]

  @@index([companyId])
  @@index([estado])
  @@index([fechaInicio])
  @@index([providerId])
}

model service_quotes {
  id                String         @id
  companyId         String
  providerId        String
  buildingId        String?
  unitId            String?
  titulo            String
  descripcion       String
  servicioRequerido String
  urgencia          String         @default("media")
  fechaSolicitud    DateTime       @default(now())
  fechaRespuesta    DateTime?
  estado            QuoteStatus    @default(solicitada)
  montoCotizado     Float?
  tiempoEstimado    String?
  notasProveedor    String?
  validezCotizacion DateTime?
  solicitadoPor     String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime
  service_jobs      service_jobs[]
  buildings         buildings?     @relation(fields: [buildingId], references: [id])
  providers         providers      @relation(fields: [providerId], references: [id], onDelete: Cascade)
  units             units?         @relation(fields: [unitId], references: [id])

  @@index([companyId])
  @@index([estado])
  @@index([fechaSolicitud])
  @@index([providerId])
}

model service_reviews {
  id           String       @id
  companyId    String
  jobId        String
  providerId   String
  calificacion Int
  puntualidad  Int?
  calidad      Int?
  comunicacion Int?
  precioJusto  Int?
  comentario   String?
  recomendaria Boolean      @default(true)
  creadoPor    String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  service_jobs service_jobs @relation(fields: [jobId], references: [id], onDelete: Cascade)
  providers    providers    @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([calificacion])
  @@index([companyId])
  @@index([jobId])
  @@index([providerId])
}

model signature_webhooks {
  id           String    @id
  signaturitId String
  tipo         String
  documentoId  String?
  payload      Json
  procesado    Boolean   @default(false)
  errorProceso String?
  createdAt    DateTime  @default(now())
  procesadoEn  DateTime?

  @@index([procesado])
  @@index([signaturitId])
  @@index([tipo])
}

model smart_contracts {
  id              String    @id
  companyId       String
  nombre          String
  descripcion     String?
  tipo            String
  blockchain      String    @default("Polygon")
  contractAddress String    @unique
  abi             Json
  bytecode        String?
  deployedBy      String?
  deploymentTx    String?
  deploymentDate  DateTime?
  estado          String    @default("active")
  verificado      Boolean   @default(false)
  gasUsed         String?
  metadata        Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  company         company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, tipo])
}

model sms_logs {
  id                 String         @id
  companyId          String
  templateId         String?
  tenantId           String?
  telefono           String
  nombreDestinatario String
  mensaje            String
  tipo               SMSTipo
  estado             SMSEstado      @default(programado)
  fechaProgramada    DateTime?
  fechaEnvio         DateTime?
  proveedorSMS       String?
  idExterno          String?
  costeEstimado      Float?
  exitoso            Boolean?
  mensajeError       String?
  relacionadoCon     String?
  relacionadoId      String?
  enviadoPor         String
  createdAt          DateTime       @default(now())
  updatedAt          DateTime
  company            company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  sms_templates      sms_templates? @relation(fields: [templateId], references: [id])
  tenants            tenants?       @relation(fields: [tenantId], references: [id])

  @@index([companyId])
  @@index([estado])
  @@index([fechaEnvio])
  @@index([fechaProgramada])
  @@index([templateId])
  @@index([tenantId])
}

model sms_templates {
  id                 String     @id
  companyId          String
  nombre             String
  descripcion        String?
  tipo               SMSTipo
  mensaje            String
  variables          Json?
  activa             Boolean    @default(true)
  envioAutomatico    Boolean    @default(false)
  eventoTrigger      String?
  anticipacionDias   Int?
  horaEnvio          String?
  vecesUsada         Int        @default(0)
  ultimoEnvio        DateTime?
  creadoPor          String
  ultimaModificacion String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime
  sms_logs           sms_logs[]
  company            company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([activa])
  @@index([companyId])
  @@index([tipo])
}

model social_analytics {
  id           String   @id
  companyId    String
  platform     String
  date         DateTime
  periodType   String
  impressions  Int      @default(0)
  reach        Int      @default(0)
  likes        Int      @default(0)
  comments     Int      @default(0)
  shares       Int      @default(0)
  clicks       Int      @default(0)
  followers    Int      @default(0)
  engagement   Float    @default(0)
  growthRate   Float    @default(0)
  bestPostTime String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  company      company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, platform, date, periodType])
  @@index([companyId])
  @@index([date])
  @@index([platform])
}

model social_comments {
  id           String       @id
  postId       String
  authorId     String?
  contenido    String
  likes        Int          @default(0)
  createdAt    DateTime     @default(now())
  tenants      tenants?     @relation(fields: [authorId], references: [id])
  social_posts social_posts @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model social_media_accounts {
  id                 String               @id
  companyId          String
  platform           SocialMediaPlatform
  accountName        String
  accountId          String
  accessToken        String?
  refreshToken       String?
  tokenExpiry        DateTime?
  pageId             String?
  businessAccountId  String?
  activo             Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  company            company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  social_media_posts social_media_posts[]

  @@unique([companyId, platform, accountId])
  @@index([companyId])
}

model social_media_posts {
  id                    String                @id
  companyId             String
  accountId             String
  estado                SocialPostStatus      @default(borrador)
  mensaje               String
  imagenesUrls          String[]              @default([])
  videoUrl              String?
  enlace                String?
  fechaProgramada       DateTime?
  fechaPublicacion      DateTime?
  postId                String?
  likes                 Int                   @default(0)
  comentarios           Int                   @default(0)
  compartidos           Int                   @default(0)
  alcance               Int                   @default(0)
  impresiones           Int                   @default(0)
  creadoPor             String
  errorMessage          String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  social_media_accounts social_media_accounts @relation(fields: [accountId], references: [id], onDelete: Cascade)
  company               company               @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([companyId])
  @@index([estado])
}

model social_posts {
  id              String            @id
  companyId       String
  authorId        String?
  buildingId      String?
  tipo            String            @default("post")
  contenido       String
  multimedia      String[]
  likes           Int               @default(0)
  likedBy         String[]
  hashtags        String[]
  visibilidad     String            @default("building")
  destacado       Boolean           @default(false)
  moderado        Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  social_comments social_comments[]
  tenants         tenants?          @relation(fields: [authorId], references: [id])
  buildings       buildings?        @relation(fields: [buildingId], references: [id])
  company         company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([authorId])
  @@index([companyId, buildingId])
}

model social_profiles {
  id                   String                 @id
  companyId            String
  pomelliConfigId      String
  platform             String
  profileId            String
  profileName          String
  profileUsername      String
  profileUrl           String?
  profileImageUrl      String?
  accessToken          String?
  refreshToken         String?
  tokenExpiresAt       DateTime?
  isActive             Boolean                @default(true)
  isConnected          Boolean                @default(true)
  lastSyncAt           DateTime?
  followersCount       Int                    @default(0)
  followingCount       Int                    @default(0)
  postsCount           Int                    @default(0)
  metadata             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  company              company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pomelli_configs      pomelli_configs        @relation(fields: [pomelliConfigId], references: [id], onDelete: Cascade)
  pomelli_social_posts pomelli_social_posts[] @relation("PostProfiles")

  @@unique([companyId, platform])
  @@index([companyId])
  @@index([isActive])
  @@index([platform])
}

model space_maintenance_predictions {
  id                         String              @id
  companyId                  String
  spaceId                    String
  periodo                    DateTime            @default(now())
  horasUsoEstimadas          Float
  numeroReservasCompletadas  Int
  promedioPersonasPorReserva Float
  indiceDesgaste             Float
  mantenimientoSugerido      Boolean             @default(false)
  tipoMantenimientoSugerido  String?
  fechaSugeridaMantenimiento DateTime?
  descripcionRecomendacion   String?
  costoEstimado              Float?
  nivelUrgencia              MaintenancePriority @default(baja)
  alertaEnviada              Boolean             @default(false)
  fechaAlerta                DateTime?
  createdAt                  DateTime            @default(now())
  updatedAt                  DateTime
  company                    company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  common_spaces              common_spaces       @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([mantenimientoSugerido])
  @@index([periodo])
  @@index([spaceId])
}

model space_ratings {
  id                 String             @id
  companyId          String
  spaceId            String
  tenantId           String
  reservationId      String             @unique
  puntuacion         Int
  categoria          RatingCategory
  comentario         String?
  aspectosPositivos  String[]           @default([])
  aspectosNegativos  String[]           @default([])
  fechaRating        DateTime           @default(now())
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  company            company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  space_reservations space_reservations @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  common_spaces      common_spaces      @relation(fields: [spaceId], references: [id], onDelete: Cascade)
  tenants            tenants            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([puntuacion])
  @@index([spaceId])
  @@index([tenantId])
}

model space_reservations {
  id                String               @id
  companyId         String
  spaceId           String
  tenantId          String
  fechaReserva      DateTime
  horaInicio        String
  horaFin           String
  estado            reservation_statuses @default(pendiente)
  monto             Float?
  pagado            Boolean              @default(false)
  numeroPersonas    Int?
  proposito         String?
  observaciones     String?
  motivoCancelacion String?
  fechaCancelacion  DateTime?
  noShow            Boolean              @default(false)
  penaltyApplied    Boolean              @default(false)
  penaltyCredits    Int?
  checkInConfirmado Boolean              @default(false)
  horaCheckIn       DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  space_ratings     space_ratings?
  company           company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  common_spaces     common_spaces        @relation(fields: [spaceId], references: [id], onDelete: Cascade)
  tenants           tenants              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([estado])
  @@index([fechaReserva])
  @@index([noShow])
  @@index([spaceId])
  @@index([tenantId])
}

model space_waitlist {
  id              String         @id
  companyId       String
  spaceId         String
  tenantId        String
  fechaSolicitud  DateTime       @default(now())
  fechaDeseada    DateTime
  horaInicio      String
  horaFin         String
  duracionHoras   Int
  prioridad       Int            @default(1)
  status          WaitlistStatus @default(activa)
  fechaNotificado DateTime?
  notasInternas   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  company         company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  common_spaces   common_spaces  @relation(fields: [spaceId], references: [id], onDelete: Cascade)
  tenants         tenants        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([fechaDeseada])
  @@index([spaceId])
  @@index([status])
  @@index([tenantId])
}

model str_bookings {
  id                     String                   @id
  companyId              String
  listingId              String
  canal                  ChannelType
  reservaExternaId       String?
  guestNombre            String
  guestEmail             String
  guestTelefono          String?
  guestPais              String?
  numHuespedes           Int
  checkInDate            DateTime
  checkOutDate           DateTime
  numNoches              Int
  precioTotal            Float
  tarifaNocturna         Float
  tarifaLimpieza         Float                    @default(0)
  tasasImpuestos         Float                    @default(0)
  comisionCanal          Float                    @default(0)
  ingresoNeto            Float
  metodoPago             String?
  estadoPago             String                   @default("pendiente")
  pagado                 Boolean                  @default(false)
  estado                 BookingStatus            @default(PENDIENTE)
  confirmadaEn           DateTime?
  checkInRealizado       DateTime?
  checkOutRealizado      DateTime?
  canceladaEn            DateTime?
  motivoCancelacion      String?
  notasEspeciales        String?
  requiereLimpieza       Boolean                  @default(true)
  limpiezaRealizada      Boolean                  @default(false)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  company                company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  str_listings           str_listings             @relation(fields: [listingId], references: [id], onDelete: Cascade)
  str_housekeeping_tasks str_housekeeping_tasks[]
}

model str_calendar {
  id             String       @id
  listingId      String
  fecha          DateTime     @db.Date
  disponible     Boolean      @default(true)
  precioPorNoche Float
  minimoNoches   Int          @default(1)
  notas          String?
  sincronizado   Boolean      @default(false)
  ultimaSync     DateTime?
  str_listings   str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([listingId, fecha])
}

model str_channel_metrics {
  id                  String       @id
  listingId           String
  canal               ChannelType
  periodo             DateTime     @db.Date
  reservasRecibidas   Int          @default(0)
  reservasCanceladas  Int          @default(0)
  reservasModificadas Int          @default(0)
  nochesReservadas    Int          @default(0)
  ingresosBrutos      Float        @default(0)
  comisionesCanal     Float        @default(0)
  ingresosNetos       Float        @default(0)
  adr                 Float        @default(0)
  tasaOcupacion       Float        @default(0)
  reviewsRecibidas    Int          @default(0)
  ratingPromedio      Float?
  impresiones         Int?
  clics               Int?
  conversionRate      Float?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  str_listings        str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([listingId, canal, periodo])
  @@index([canal])
  @@index([listingId])
  @@index([periodo])
}

model str_channel_pricing {
  id                String       @id
  listingId         String
  canal             ChannelType
  ajusteTipo        String       @default("porcentaje")
  ajusteValor       Float        @default(0)
  comisionCanal     Float        @default(0)
  compensarComision Boolean      @default(false)
  precioMinimo      Float?
  precioMaximo      Float?
  descuentoSemana   Float?
  descuentoMes      Float?
  descuentoLastMin  Float?
  activo            Boolean      @default(true)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  str_listings      str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([listingId, canal])
  @@index([listingId])
}

model str_channel_sync {
  id                    String       @id
  companyId             String
  listingId             String
  canal                 ChannelType
  activo                Boolean      @default(true)
  url                   String?
  apiKey                String?
  externalId            String?
  sincronizarPrecio     Boolean      @default(true)
  sincronizarCalendario Boolean      @default(true)
  sincronizarReservas   Boolean      @default(true)
  ultimaSync            DateTime?
  proximaSync           DateTime?
  estadoSync            String       @default("pendiente")
  erroresSync           Int          @default(0)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime
  company               company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  str_listings          str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([listingId, canal])
}

model str_competitor_analysis {
  id                String       @id
  listingId         String
  competidorUrl     String
  competidorNombre  String?
  canal             ChannelType
  precioCapturado   Float
  ocupacionEstimada Float?
  ratingCapturado   Float?
  fechaCaptura      DateTime     @default(now())
  createdAt         DateTime     @default(now())
  str_listings      str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([fechaCaptura])
  @@index([listingId])
}

model str_dynamic_pricing_rules {
  id             String        @id
  listingId      String
  nombre         String
  descripcion    String?
  prioridad      Int           @default(0)
  condiciones    Json
  accionTipo     String
  accionValor    Float
  aplicarCanales ChannelType[] @default([])
  diasSemana     Int[]         @default([])
  fechaInicio    DateTime?
  fechaFin       DateTime?
  activo         Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  str_listings   str_listings  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([activo])
  @@index([listingId])
}

model str_housekeeping_checklists {
  id                String       @id
  companyId         String
  nombre            String
  descripcion       String?
  tipo              TurnoverType @default(check_out)
  items             Json
  tiempoEstimadoMin Int?
  activo            Boolean      @default(true)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  company           company      @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([tipo])
}

model str_housekeeping_inventory {
  id                      String                    @id
  companyId               String
  listingId               String?
  nombre                  String
  categoria               String
  sku                     String?
  stockActual             Int                       @default(0)
  stockMinimo             Int                       @default(5)
  stockOptimo             Int?
  ubicacion               String?
  costoUnitario           Float?
  proveedorId             String?
  fechaUltimoConteo       DateTime?
  alertaStockBajo         Boolean                   @default(false)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  company                 company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  str_inventory_movements str_inventory_movements[]

  @@index([alertaStockBajo])
  @@index([categoria])
  @@index([companyId])
  @@index([listingId])
}

model str_housekeeping_staff {
  id                     String                   @id
  companyId              String
  nombre                 String
  email                  String?
  telefono               String
  foto                   String?
  tipo                   String                   @default("interno")
  empresaNombre          String?
  activo                 Boolean                  @default(true)
  diasDisponibles        Int[]                    @default([1, 2, 3, 4, 5])
  horaInicio             String                   @default("08:00")
  horaFin                String                   @default("18:00")
  capacidadDiaria        Int                      @default(4)
  zonasTrabajo           String[]                 @default([])
  tarifaPorTurnover      Float?
  tarifaPorHora          Float?
  tareasCompletadas      Int                      @default(0)
  calificacionPromedio   Float?
  tiempoPromedioMin      Int?
  pinAcceso              String?
  appToken               String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  company                company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  str_housekeeping_tasks str_housekeeping_tasks[]

  @@index([activo])
  @@index([companyId])
}

model str_housekeeping_tasks {
  id                      String                  @id
  companyId               String
  listingId               String
  bookingId               String?
  tipo                    TurnoverType            @default(check_out)
  status                  HousekeepingStatus      @default(pendiente)
  fechaProgramada         DateTime
  fechaInicio             DateTime?
  fechaFin                DateTime?
  asignadoA               String?
  asignadoNombre          String?
  notas                   String?
  instruccionesEspeciales String?
  prioridad               Int                     @default(0)
  checklistCompletado     Json?
  fotosAntes              String[]                @default([])
  fotosDespues            String[]                @default([])
  tiempoEstimadoMin       Int?
  tiempoRealMin           Int?
  costoMateriales         Float                   @default(0)
  costoManoObra           Float                   @default(0)
  checkInTime             DateTime?
  checkOutTime            DateTime?
  ubicacionCheckIn        Json?
  incidencias             String[]                @default([])
  requiereAtencion        Boolean                 @default(false)
  createdAt               DateTime                @default(now())
  updatedAt               DateTime
  str_housekeeping_staff  str_housekeeping_staff? @relation(fields: [asignadoA], references: [id])
  str_bookings            str_bookings?           @relation(fields: [bookingId], references: [id])
  company                 company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  str_listings            str_listings            @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([asignadoA])
  @@index([companyId])
  @@index([fechaProgramada])
  @@index([listingId])
  @@index([status])
}

model str_inventory_movements {
  id                         String                     @id
  inventoryId                String
  tipo                       String
  cantidad                   Int
  motivo                     String?
  taskId                     String?
  registradoPor              String?
  fecha                      DateTime                   @default(now())
  createdAt                  DateTime                   @default(now())
  str_housekeeping_inventory str_housekeeping_inventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)

  @@index([fecha])
  @@index([inventoryId])
}

model str_listings {
  id                        String                      @id
  companyId                 String
  unitId                    String
  titulo                    String
  descripcion               String
  tipoPropiedad             String
  capacidadMaxima           Int
  numDormitorios            Int
  numCamas                  Int
  numBanos                  Int
  amenities                 String[]                    @default([])
  reglasHospedaje           String[]                    @default([])
  precioPorNoche            Float
  precioSemana              Float?
  precioMes                 Float?
  tarifaLimpieza            Float                       @default(0)
  depositoSeguridad         Float                       @default(0)
  comisionPlataforma        Float                       @default(0)
  checkInTime               String                      @default("15:00")
  checkOutTime              String                      @default("11:00")
  cancelacionFlexible       Boolean                     @default(true)
  reservaInstantanea        Boolean                     @default(false)
  sincronizarCanales        Boolean                     @default(true)
  canalPrincipal            ChannelType?
  totalReservas             Int                         @default(0)
  ratingPromedio            Float?
  totalReviews              Int                         @default(0)
  tasaOcupacion             Float?
  pricingRules              Json?
  activo                    Boolean                     @default(true)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  str_bookings              str_bookings[]
  str_calendar              str_calendar[]
  str_channel_metrics       str_channel_metrics[]
  str_channel_pricing       str_channel_pricing[]
  str_channel_sync          str_channel_sync[]
  str_competitor_analysis   str_competitor_analysis[]
  str_dynamic_pricing_rules str_dynamic_pricing_rules[]
  str_housekeeping_tasks    str_housekeeping_tasks[]
  company                   company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                     units                       @relation(fields: [unitId], references: [id], onDelete: Cascade)
  str_reviews               str_reviews[]
  str_season_pricing        str_season_pricing[]
}

model str_reviews {
  id                 String       @id
  listingId          String
  bookingId          String?
  canal              ChannelType
  guestNombre        String
  rating             Int
  comentario         String
  fecha              DateTime
  ratingLimpieza     Int?
  ratingComunicacion Int?
  ratingUbicacion    Int?
  ratingPrecio       Int?
  respuesta          String?
  respondidoEn       DateTime?
  createdAt          DateTime     @default(now())
  str_listings       str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)
}

model str_season_pricing {
  id             String       @id
  listingId      String
  temporada      SeasonType
  nombre         String
  fechaInicio    DateTime     @db.Date
  fechaFin       DateTime     @db.Date
  precioPorNoche Float
  minimoNoches   Int          @default(1)
  activo         Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  str_listings   str_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)
}

model str_sync_history {
  id            String               @id
  channelSyncId String
  tipoEvento    SyncEventType
  direccion     ChannelSyncDirection @default(push)
  payload       Json?
  respuesta     Json?
  exitoso       Boolean              @default(false)
  mensajeError  String?
  codigoError   String?
  reintentos    Int                  @default(0)
  iniciadoEn    DateTime             @default(now())
  finalizadoEn  DateTime?
  duracionMs    Int?
  createdAt     DateTime             @default(now())

  @@index([channelSyncId])
  @@index([exitoso])
  @@index([iniciadoEn])
  @@index([tipoEvento])
}

model stripe_customers {
  id               String   @id
  tenantId         String   @unique
  stripeCustomerId String   @unique
  email            String
  name             String
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  tenants          tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model stripe_subscriptions {
  id                   String     @id
  contractId           String     @unique
  stripeSubscriptionId String     @unique
  stripeCustomerId     String
  stripePriceId        String?
  status               String
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  cancelAtPeriodEnd    Boolean    @default(false)
  canceledAt           DateTime?
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  payments             payments[]
  contracts            contracts  @relation(fields: [contractId], references: [id], onDelete: Cascade)
}

model stripe_webhook_events {
  id              String    @id
  stripeEventId   String    @unique
  type            String
  data            String
  processed       Boolean   @default(false)
  processingError String?
  createdAt       DateTime  @default(now())
  processedAt     DateTime?

  @@index([processed, createdAt])
}

model subscription_plans {
  id               String           @id
  nombre           String
  tier             SubscriptionTier
  descripcion      String
  precioMensual    Float
  maxUsuarios      Int              @default(5)
  maxPropiedades   Int              @default(10)
  modulosIncluidos Json
  activo           Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  B2BInvoice       B2BInvoice[]
  company          company[]
}

model suggestions {
  id               String             @id
  companyId        String
  userId           String?
  nombreRemitente  String
  emailRemitente   String
  titulo           String
  descripcion      String
  categoria        String
  prioridad        SuggestionPriority @default(media)
  estado           SuggestionStatus   @default(pendiente)
  respuesta        String?
  respondidoPor    String?
  fechaRespuesta   DateTime?
  navegador        String?
  sistemaOperativo String?
  urlOrigen        String?
  votos            Int                @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  company          company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users            users?             @relation(fields: [userId], references: [id])

  @@index([categoria])
  @@index([companyId])
  @@index([createdAt])
  @@index([estado])
  @@index([prioridad])
}

model support_interactions {
  id         String   @id
  userId     String
  type       String
  question   String
  response   String
  confidence Float?
  intent     String?
  sentiment  String?
  urgency    String?
  resolved   Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sentiment])
  @@index([type])
  @@index([urgency])
  @@index([userId, createdAt])
}

model system_backups {
  id           String       @id
  companyId    String
  tipo         BackupType   @default(manual)
  estado       BackupStatus @default(pendiente)
  registros    Int          @default(0)
  tamano       String?
  ubicacion    String?
  inicioPor    String
  errorDetalle String?
  createdAt    DateTime     @default(now())
  completedAt  DateTime?
  company      company      @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([estado])
}

model tasks {
  id                           String       @id
  companyId                    String
  titulo                       String
  descripcion                  String?
  estado                       TaskStatus   @default(pendiente)
  prioridad                    TaskPriority @default(media)
  fechaLimite                  DateTime?
  fechaInicio                  DateTime?
  fechaCompletada              DateTime?
  asignadoA                    String?
  creadoPor                    String
  recordatorioEnviado          Boolean      @default(false)
  notas                        String?
  createdAt                    DateTime     @default(now())
  updatedAt                    DateTime
  users_tasks_asignadoATousers users?       @relation("tasks_asignadoATousers", fields: [asignadoA], references: [id])
  company                      company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users_tasks_creadoPorTousers users        @relation("tasks_creadoPorTousers", fields: [creadoPor], references: [id], onDelete: Cascade)

  @@index([asignadoA, estado])
  @@index([asignadoA])
  @@index([companyId, estado])
  @@index([companyId])
  @@index([createdAt])
  @@index([estado])
  @@index([fechaLimite])
  @@index([prioridad])
}

model templates {
  id        String       @id
  nombre    String
  tipo      TemplateType
  contenido String
  variables String[]     @default([])
  activo    Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime
}

model tenant_behaviors {
  id                     String   @id
  tenantId               String
  fecha                  DateTime @default(now())
  pagosATiempo           Int      @default(0)
  pagosRetrasados        Int      @default(0)
  promedioRetrasosDias   Float    @default(0)
  ticketsMantenimiento   Int      @default(0)
  scoreComportamiento    Int      @default(50)
  riesgoMorosidad        String   @default("bajo")
  probabilidadRenovacion Float?
  createdAt              DateTime @default(now())
  updatedAt              DateTime

  @@index([fecha])
  @@index([tenantId])
}

model tenant_profiles {
  id                        String   @id
  tenantId                  String   @unique
  edad                      Int?
  ocupacion                 String?
  ingresos                  Float?
  idiomas                   String[] @default([])
  horariosActividad         String?
  nivelSociabilidad         Int?     @default(5)
  estiloVida                String?
  preferenciaLimpieza       Int?     @default(5)
  toleranciaRuido           Int?     @default(5)
  frecuenciaUsoComunes      String?
  numeroConvivientes        Int      @default(0)
  incidentesReportados      Int      @default(0)
  puntuacionConvivencia     Float?
  mesesEnColiving           Int      @default(0)
  prefiereHabitacionPrivada Boolean  @default(false)
  prefiereEdificioCentro    Boolean  @default(false)
  interesEventos            Boolean  @default(false)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime
  tenants                   tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model tenant_reputations {
  id                 String   @id
  tenantId           String   @unique
  puntos             Int      @default(0)
  nivel              String   @default("novato")
  serviciosOfrecidos Int      @default(0)
  serviciosRecibidos Int      @default(0)
  valoracionPromedio Float?
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  badges             badges[]
  tenants            tenants  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model tenant_segments {
  id                  String   @id
  companyId           String
  nombre              String
  descripcion         String?
  criterios           Json
  tenantIds           String[]
  metricasPromedio    Json?
  totalInquilinos     Int      @default(0)
  activo              Boolean  @default(true)
  ultimaActualizacion DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime

  @@index([activo])
  @@index([companyId])
}

model tenants {
  id                                     String                       @id
  companyId                              String
  nombreCompleto                         String
  dni                                    String                       @unique
  email                                  String                       @unique
  telefono                               String
  fechaNacimiento                        DateTime
  nacionalidad                           String?
  estadoCivil                            EstadoCivil?
  numeroOcupantes                        Int?
  direccionActual                        String?
  situacionLaboral                       SituacionLaboral?
  empresa                                String?
  puesto                                 String?
  antiguedad                             Int?
  ingresosMensuales                      Float?
  ratioRentaIngresos                     Float?
  scoring                                Int                          @default(50)
  nivelRiesgo                            RiskLevel                    @default(medio)
  password                               String?
  notas                                  String?
  contasimpleCustomerId                  String?
  createdAt                              DateTime                     @default(now())
  updatedAt                              DateTime
  ColivingCheckInOut                     ColivingCheckInOut[]
  ColivingPackage                        ColivingPackage[]
  ColivingProfile                        ColivingProfile?
  ColivingServiceBooking                 ColivingServiceBooking[]
  PasswordResetToken                     PasswordResetToken[]
  ServiceRating                          ServiceRating[]
  SmartLockAccess                        SmartLockAccess[]
  TenantInvitation                       TenantInvitation?
  TenantOnboarding                       TenantOnboarding?
  ai_conversations                       ai_conversations[]
  ambassadors                            ambassadors?
  announcement_confirmations             announcement_confirmations[]
  bank_connections                       bank_connections[]
  biometric_verifications                biometric_verifications[]
  calendar_events                        calendar_events[]
  chatbot_conversations                  chatbot_conversations[]
  circular_items                         circular_items[]
  contracts                              contracts[]
  document_shares                        document_shares[]
  documentos_firma                       documentos_firma[]
  documents                              documents[]
  event_attendees                        event_attendees[]
  event_comments                         event_comments[]
  garden_plots                           garden_plots[]
  gdpr_consents                          gdpr_consents[]
  marketplace_bookings                   marketplace_bookings[]
  marketplace_loyalty                    marketplace_loyalty?
  messages_messages_recipientIdTotenants messages[]                   @relation("messages_recipientIdTotenants")
  messages_messages_senderIdTotenants    messages[]                   @relation("messages_senderIdTotenants")
  morosidad_historial                    morosidad_historial[]
  morosidad_predicciones                 morosidad_predicciones[]
  nps_surveys                            nps_surveys[]
  p2p_bookings                           p2p_bookings[]
  p2p_services                           p2p_services[]
  post_reactions                         post_reactions[]
  reservation_credits                    reservation_credits?
  room_contracts                         room_contracts[]
  sms_logs                               sms_logs[]
  social_comments                        social_comments[]
  social_posts                           social_posts[]
  space_ratings                          space_ratings[]
  space_reservations                     space_reservations[]
  space_waitlist                         space_waitlist[]
  stripe_customers                       stripe_customers?
  tenant_profiles                        tenant_profiles?
  tenant_reputations                     tenant_reputations?
  company                                company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  token_holders                          token_holders[]
  units                                  units[]

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([companyId, scoring])
  @@index([dni])
  @@index([email])
}

model token_holders {
  id                  String          @id
  tokenId             String
  tenantId            String?
  walletAddress       String
  email               String?
  nombre              String?
  cantidadTokens      Int
  porcentajePropiedad Float
  valorInvertido      Float
  rentasRecibidas     Float           @default(0)
  ultimaRenta         DateTime?
  kycVerificado       Boolean         @default(false)
  fechaKYC            DateTime?
  activo              Boolean         @default(true)
  fechaAdquisicion    DateTime        @default(now())
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  tenants             tenants?        @relation(fields: [tenantId], references: [id])
  property_tokens     property_tokens @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@index([tokenId, walletAddress])
}

model token_transactions {
  id              String          @id
  tokenId         String
  tipo            String
  fromAddress     String?
  toAddress       String?
  cantidadTokens  Int
  precioUnitario  Float
  montoTotal      Float
  txHash          String?         @unique
  blockNumber     Int?
  estado          String          @default("pending")
  gasFee          Float?
  createdAt       DateTime        @default(now())
  property_tokens property_tokens @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@index([tokenId, tipo])
  @@index([txHash])
}

model units {
  id                        String                      @id
  numero                    String
  buildingId                String
  tipo                      UnitType
  estado                    UnitStatus                  @default(disponible)
  superficie                Float
  superficieUtil            Float?
  habitaciones              Int?
  banos                     Int?
  planta                    Int?
  orientacion               String?
  rentaMensual              Float
  tenantId                  String?
  aireAcondicionado         Boolean                     @default(false)
  calefaccion               Boolean                     @default(false)
  terraza                   Boolean                     @default(false)
  balcon                    Boolean                     @default(false)
  amueblado                 Boolean                     @default(false)
  imagenes                  String[]                    @default([])
  tourVirtual               String?
  planos                    String[]                    @default([])
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  ColivingCheckInOut        ColivingCheckInOut[]
  SmartLock                 SmartLock[]
  ar_visualizations         ar_visualizations[]
  calendar_events           calendar_events[]
  candidates                candidates[]
  community_fees            community_fees[]
  community_incidents       community_incidents[]
  contracts                 contracts[]
  documents                 documents[]
  energy_alerts             energy_alerts[]
  energy_certificates       energy_certificates[]
  energy_readings           energy_readings[]
  expenses                  expenses[]
  flipping_projects         flipping_projects[]
  habitability_certificates habitability_certificates[]
  insurances                insurances[]
  iot_devices               iot_devices[]
  maintenance_requests      maintenance_requests[]
  maintenance_schedules     maintenance_schedules[]
  marketplace_bookings      marketplace_bookings[]
  nft_certificates          nft_certificates[]
  pricing_analysis          pricing_analysis[]
  pricing_strategies        pricing_strategies[]
  property_galleries        property_galleries?
  property_tokens           property_tokens[]
  provider_work_orders      provider_work_orders[]
  publicaciones_portales    publicaciones_portales[]
  room_shared_spaces        room_shared_spaces[]
  rooms                     rooms[]
  service_jobs              service_jobs[]
  service_quotes            service_quotes[]
  str_listings              str_listings[]
  buildings                 buildings                   @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  tenants                   tenants?                    @relation(fields: [tenantId], references: [id])
  valoraciones_propiedades  valoraciones_propiedades[]
  virtual_tours             virtual_tours[]

  @@unique([buildingId, numero])
  @@index([buildingId, estado])
  @@index([buildingId, tipo, estado])
  @@index([estado])
  @@index([rentaMensual, estado])
  @@index([tenantId])
  @@index([tipo, estado])
}

model urban_gardens {
  id              String         @id
  companyId       String
  buildingId      String
  nombre          String
  descripcion     String?
  ubicacion       String
  metrosCuadrados Float
  tipoCultivo     String         @default("organico")
  fotos           String[]
  reglas          Json?
  activo          Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  garden_plots    garden_plots[]
  buildings       buildings      @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  company         company        @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, buildingId])
}

model user_celebrations {
  id        String    @id
  userId    String
  companyId String
  type      String
  title     String
  message   String
  shown     Boolean   @default(false)
  shownAt   DateTime?
  createdAt DateTime  @default(now())
  company   company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([shown])
  @@index([userId])
}

model user_company_access {
  id            String    @id
  userId        String
  companyId     String
  roleInCompany UserRole  @default(gestor)
  activo        Boolean   @default(true)
  grantedBy     String?
  grantedAt     DateTime  @default(now())
  lastAccess    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  company       company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users         users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([userId])
}

model user_dashboard_preferences {
  id                String              @id
  userId            String              @unique
  layout            String              @default("grid")
  theme             String              @default("light")
  defaultView       String              @default("overview")
  activeWidgets     String[]
  widgetPositions   Json?
  defaultFilters    Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  dashboard_widgets dashboard_widgets[]
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_notification_settings {
  id                 String   @id
  userId             String   @unique
  quietHoursEnabled  Boolean  @default(false)
  quietHoursStart    String   @default("22:00")
  quietHoursEnd      String   @default("08:00")
  quietDays          String[] @default([])
  batchNotifications Boolean  @default(false)
  batchInterval      Int      @default(60)
  language           String   @default("es")
  customRules        Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  users              users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_preferences {
  id         String   @id
  userId     String   @unique
  language   String   @default("es")
  timezone   String   @default("Europe/Madrid")
  dateFormat String   @default("DD/MM/YYYY")
  currency   String   @default("EUR")
  theme      String   @default("light")
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                           String                      @id
  email                        String                      @unique
  name                         String
  password                     String
  role                         UserRole                    @default(gestor)
  companyId                    String
  activo                       Boolean                     @default(true)
  businessVertical             BusinessVertical?
  resetToken                   String?                     @unique
  resetTokenExpiry             DateTime?
  mfaEnabled                   Boolean                     @default(false)
  mfaSecret                    String?
  mfaBackupCodes               String[]                    @default([])
  mfaVerifiedAt                DateTime?
  mfaRecoveryCodes             Int                         @default(10)
  createdAt                    DateTime                    @default(now())
  updatedAt                    DateTime
  setupProgress                String?
  experienceLevel              ExperienceLevel?            @default(intermedio)
  hiddenModules                String[]                    @default([])
  lastAction                   String?
  onboardingCompleted          Boolean                     @default(false)
  portfolioSize                PortfolioSize?              @default(size_1_5)
  preferredModules             String[]                    @default([])
  techSavviness                TechSavviness?              @default(medio)
  uiMode                       UIMode                      @default(standard)
  OnboardingProgress           OnboardingProgress[]
  SupportTicket                SupportTicket[]
  TenantInvitation             TenantInvitation[]
  ai_conversations             ai_conversations[]
  audit_logs                   audit_logs[]
  automations                  automations[]
  bank_connections             bank_connections[]
  biometric_verifications      biometric_verifications[]
  chatbot_conversations        chatbot_conversations[]
  chatbot_interactions         chatbot_interactions[]
  dashboard_widgets            dashboard_widgets[]
  documentos_firma             documentos_firma[]
  email_logs                   email_logs[]
  gdpr_consents                gdpr_consents[]
  in_app_notifications         in_app_notifications[]
  lead_activities              lead_activities[]
  lead_documents               lead_documents[]
  leads                        leads[]
  module_usage_stats           module_usage_stats[]
  notification_logs            notification_logs[]
  notifications                notifications[]
  onboarding_tasks             onboarding_tasks[]
  pomelli_social_posts         pomelli_social_posts[]
  push_subscriptions           push_subscriptions[]
  saved_searches               saved_searches[]
  scheduled_emails             scheduled_emails[]
  search_history               search_history[]
  security_events              security_events[]
  suggestions                  suggestions[]
  support_interactions         support_interactions[]
  tasks_tasks_asignadoATousers tasks[]                     @relation("tasks_asignadoATousers")
  tasks_tasks_creadoPorTousers tasks[]                     @relation("tasks_creadoPorTousers")
  user_celebrations            user_celebrations[]
  user_company_access          user_company_access[]
  user_dashboard_preferences   user_dashboard_preferences?
  user_notification_settings   user_notification_settings?
  user_preferences             user_preferences?
  company                      company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  voice_interactions           voice_interactions[]
  workflows                    workflows[]

  @@index([activo])
  @@index([companyId])
  @@index([createdAt])
  @@index([email])
  @@index([role, companyId])
}

model valoraciones_propiedades {
  id                   String              @id
  companyId            String
  unitId               String?
  buildingId           String?
  direccion            String
  municipio            String
  provincia            String
  codigoPostal         String?
  metrosCuadrados      Float
  habitaciones         Int?
  banos                Int?
  garajes              Int?
  trasteros            Int?
  ascensor             Boolean             @default(false)
  terraza              Boolean             @default(false)
  jardin               Boolean             @default(false)
  piscina              Boolean             @default(false)
  anosConstruccion     Int?
  estadoConservacion   String?
  orientacion          String?
  eficienciaEnergetica String?
  metodo               ValoracionMetodo
  finalidad            ValoracionFinalidad
  valorEstimado        Float
  valorMinimo          Float
  valorMaximo          Float
  precioM2             Float
  confianzaValoracion  Float
  numComparables       Int                 @default(0)
  comparablesData      Json?
  factoresPositivos    Json?
  factoresNegativos    Json?
  recomendacionPrecio  String?
  precioMedioZona      Float?
  demandaZona          String?
  diasPromedioVenta    Int?
  generadoPor          String
  fechaValoracion      DateTime            @default(now())
  validoHasta          DateTime?
  notas                String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  buildings            buildings?          @relation(fields: [buildingId], references: [id])
  company              company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units                units?              @relation(fields: [unitId], references: [id])

  @@index([buildingId])
  @@index([companyId])
  @@index([fechaValoracion])
  @@index([finalidad])
  @@index([municipio])
  @@index([unitId])
}

model virtual_tours {
  id             String     @id
  companyId      String
  unitId         String?
  buildingId     String?
  titulo         String
  descripcion    String?
  tipo           String
  urlPrincipal   String
  urlThumbnail   String?
  embedCode      String?
  escenas        Json?
  hotspots       Json?
  vistas         Int        @default(0)
  tiempoPromedio Int?
  compartido     Int        @default(0)
  estado         String     @default("borrador")
  publico        Boolean    @default(false)
  creadoPor      String?
  plataforma     String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  buildings      buildings? @relation(fields: [buildingId], references: [id])
  company        company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units          units?     @relation(fields: [unitId], references: [id])

  @@index([companyId, estado])
}

model visits {
  id              String            @id
  candidateId     String
  fechaVisita     DateTime
  confirmada      Boolean           @default(false)
  asistio         Boolean?
  feedback        String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  calendar_events calendar_events[]
  candidates      candidates        @relation(fields: [candidateId], references: [id], onDelete: Cascade)
}

model voice_interactions {
  id             String   @id
  companyId      String
  userId         String?
  audioUrl       String?
  duracion       Int?
  transcripcion  String?
  idioma         String   @default("es")
  respuestaTexto String?
  respuestaAudio String?
  comando        String?
  exitoso        Boolean  @default(false)
  createdAt      DateTime @default(now())
  company        company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users          users?   @relation(fields: [userId], references: [id])

  @@index([companyId])
}

model vote_records {
  id                 String          @id
  voteId             String
  tenantId           String
  opcionSeleccionada String
  comentario         String?
  fechaVoto          DateTime        @default(now())
  community_votes    community_votes @relation(fields: [voteId], references: [id], onDelete: Cascade)

  @@unique([voteId, tenantId])
  @@index([voteId])
}

model webhook_events {
  id        String    @id
  companyId String
  event     String
  payload   Json
  sentAt    DateTime?
  status    String    @default("pending")
  attempts  Int       @default(0)
  error     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime
  company   company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([event])
  @@index([status])
}

model workflow_actions {
  id         String             @id
  workflowId String
  orden      Int
  actionType WorkflowActionType
  config     Json
  conditions Json?
  createdAt  DateTime           @default(now())
  updatedAt  DateTime
  workflows  workflows          @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([orden])
  @@index([workflowId])
}

model workflow_executions {
  id          String    @id
  workflowId  String
  status      String
  startedAt   DateTime  @default(now())
  finishedAt  DateTime?
  triggerData Json?
  results     Json?
  error       String?
  workflows   workflows @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([startedAt])
  @@index([status])
  @@index([workflowId])
}

model workflows {
  id                  String                @id
  companyId           String
  nombre              String
  descripcion         String?
  status              WorkflowStatus        @default(borrador)
  version             Int                   @default(1)
  triggerType         WorkflowTriggerType
  triggerConfig       Json
  isActive            Boolean               @default(false)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  createdBy           String?
  workflow_actions    workflow_actions[]
  workflow_executions workflow_executions[]
  company             company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users               users?                @relation(fields: [createdBy], references: [id])

  @@index([companyId])
  @@index([isActive])
  @@index([status])
}

enum AccountingCategory {
  ingreso_renta
  ingreso_deposito
  ingreso_otro
  gasto_mantenimiento
  gasto_impuesto
  gasto_seguro
  gasto_servicio
  gasto_reparacion
  gasto_comunidad
  gasto_administracion
  gasto_otro
}

enum ActaEstado {
  borrador
  aprobada
  rechazada
}

enum AlertSeverity {
  info
  warning
  critical
}

enum AlertType {
  consumo_alto
  consumo_bajo
  incremento_repentino
  fuga_posible
}

enum AnnouncementPriority {
  urgente
  importante
  normal
  informativo
}

enum AnnouncementStatus {
  borrador
  activo
  programado
  expirado
  archivado
}

enum ApprovalStatus {
  pendiente
  aprobado
  rechazado
}

enum ApprovalType {
  gasto
  mantenimiento
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
}

enum AuditSeverity {
  info
  warning
  error
  critical
}

enum BackupStatus {
  pendiente
  en_progreso
  completado
  fallido
}

enum BackupType {
  completo
  incremental
  manual
}

enum BankConnectionStatus {
  conectado
  desconectado
  error
  renovacion_requerida
}

enum BookingStatus {
  PENDIENTE
  CONFIRMADA
  CHECK_IN
  CHECK_OUT
  CANCELADA
  NO_SHOW
}

enum BuildingType {
  residencial
  mixto
  comercial
}

enum BusinessModel {
  RESIDENCIAL_LARGA
  TURISTICO_STR
  COLIVING_MEDIA
  HOTEL_APARTHOT
  HOUSE_FLIPPING
  CONSTRUCCION
  SERVICIOS_PROF
}

enum BusinessVertical {
  alquiler_tradicional
  str_vacacional
  coliving
  construccion
  flipping
  servicios_profesionales
  mixto
  room_rental
  comunidades
}

enum CandidateStatus {
  nuevo
  en_revision
  preseleccionado
  aprobado
  rechazado
}

enum ChannelSyncDirection {
  push
  pull
  bidirectional
}

enum ChannelType {
  AIRBNB
  BOOKING
  VRBO
  HOMEAWAY
  WEB_PROPIA
  EXPEDIA
  TRIPADVISOR
  OTROS
}

enum ChatMessageStatus {
  enviado
  entregado
  leido
}

enum ChatStatus {
  activa
  cerrada
  archivada
}

enum ChatbotConversationStatus {
  activa
  resuelta
  escalada
}

enum CommissionStatus {
  PENDING
  APPROVED
  PAID
  CANCELLED
}

enum CommunityEventStatus {
  borrador
  publicado
  en_curso
  finalizado
  cancelado
}

enum CommunityEventType {
  social
  formacion
  networking
  asamblea
  fiesta
  deporte
  cultural
  otro
}

enum CompanyCategory {
  enterprise
  pyme
  startup
  trial
  premium
  standard
}

enum ConstructionPhase {
  PLANIFICACION
  PERMISOS
  CIMENTACION
  ESTRUCTURA
  CERRAMIENTOS
  INSTALACIONES
  ACABADOS
  ENTREGA
  GARANTIA
}

enum ContractStatus {
  activo
  vencido
  cancelado
}

enum ContractType {
  residencial
  comercial
  temporal
}

enum CouponStatus {
  activo
  inactivo
  agotado
  expirado
}

enum CouponType {
  PERCENTAGE
  FIXED
}

enum CrmActivityType {
  llamada
  email
  reunion
  visita
  seguimiento
  nota
}

enum CrmLeadSource {
  web
  referido
  llamada
  email
  redes_sociales
  anuncio
  otro
}

enum CrmLeadStatus {
  nuevo
  contactado
  calificado
  visitado
  propuesta_enviada
  negociacion
  ganado
  perdido
}

enum CuotaTipo {
  ordinaria
  extraordinaria
  derrama
}

enum DocumentType {
  contrato
  dni
  nomina
  certificado_energetico
  ite
  seguro
  factura
  otro
}

enum EmailCampaignStatus {
  borrador
  programada
  enviando
  enviada
  cancelada
}

enum EnergyType {
  electricidad
  agua
  gas
  calefaccion
}

enum EstadoCivil {
  soltero
  casado
  divorciado
  viudo
}

enum EstadoFacturaComunidad {
  borrador
  emitida
  pagada
  vencida
  cancelada
}

enum EwoorkerEstadoContrato {
  BORRADOR
  PENDIENTE_FIRMA
  ACTIVO
  EN_EJECUCION
  COMPLETADO
  CANCELADO
  EN_DISPUTA
  RESUELTO
}

enum EwoorkerEstadoDocumento {
  VERDE
  AMARILLO
  ROJO
  PENDIENTE_VALIDACION
}

enum EwoorkerEstadoObra {
  BORRADOR
  PUBLICADA
  EN_LICITACION
  ADJUDICADA
  EN_EJECUCION
  COMPLETADA
  CANCELADA
}

enum EwoorkerEstadoOferta {
  BORRADOR
  ENVIADA
  VISTA
  EN_REVISION
  PRESELECCIONADA
  RECHAZADA
  ACEPTADA
  RETIRADA
  EXPIRADA
}

enum EwoorkerEstadoPago {
  PENDIENTE
  RETENIDO_ESCROW
  LIBERADO
  PAGADO
  CANCELADO
  EN_DISPUTA
}

enum EwoorkerPlanSuscripcion {
  OBRERO_FREE
  CAPATAZ_PRO
  CONSTRUCTOR_ENTERPRISE
}

enum EwoorkerTipoComision {
  SUSCRIPCION_MENSUAL
  PAGO_SEGURO_ESCROW
  CONTRATACION_URGENTE
  MAQUINARIA_ON_DEMAND
  SERVICIO_PREMIUM
}

enum EwoorkerTipoEmpresa {
  CONTRATISTA_PRINCIPAL
  SUBCONTRATISTA_N1
  SUBCONTRATISTA_N2
  AUTONOMO
}

enum ExpenseCategory {
  mantenimiento
  impuestos
  seguros
  servicios
  reparaciones
  comunidad
  otro
}

enum ExperienceLevel {
  principiante
  intermedio
  avanzado
}

enum FondoTipo {
  reserva
  obras
  contingencia
}

enum GalleryItemType {
  foto
  video
  tour_360
  plano
}

enum HousekeepingStatus {
  pendiente
  asignado
  en_progreso
  completado
  verificado
  incidencia
}

enum IncidentPriority {
  baja
  media
  alta
  urgente
}

enum IncidentStatus {
  abierta
  en_proceso
  resuelta
  cerrada
  rechazada
}

enum IncidentType {
  ruido
  averia_comun
  limpieza
  seguridad
  convivencia
  mascota
  parking
  otro
}

enum IncrementoType {
  porcentaje
  ipc
  fijo
}

enum InspectionStatus {
  programada
  en_progreso
  completada
  pendiente_accion
  cancelada
}

enum InspectionType {
  entrada
  salida
  periodica
  precompra
  mantenimiento
  emergencia
}

enum InvitationStatus {
  pendiente
  aceptada
  expirada
  cancelada
}

enum InvoiceStatus {
  PENDIENTE
  PAGADA
  VENCIDA
  CANCELADA
  PARCIALMENTE_PAGADA
}

enum JobStatus {
  pendiente
  en_progreso
  completado
  cancelado
}

enum LeadStatus {
  NUEVO
  CONTACTADO
  CALIFICADO
  DEMO
  PROPUESTA
  NEGOCIACION
  CERRADO_GANADO
  CERRADO_PERDIDO
  DESCARTADO
}

enum LegalTemplateCategory {
  contrato_arrendamiento
  anexo_contrato
  notificacion_inquilino
  reclamacion
  finalizacion_contrato
  inspeccion
  certificado
  otro
}

enum MaintenancePriority {
  alta
  media
  baja
}

enum MaintenanceStatus {
  pendiente
  en_progreso
  programado
  completado
}

enum MessageStatus {
  enviado
  leido
}

enum MorosidadRiesgo {
  bajo
  medio
  alto
  critico
}

enum NPSCategory {
  promotor
  pasivo
  detractor
}

enum NotificationType {
  pago_atrasado
  contrato_vencimiento
  mantenimiento_urgente
  mantenimiento_preventivo
  documento_vencer
  unidad_vacante
  inspeccion_programada
  alerta_sistema
  info
}

enum OnboardingTaskStatus {
  pending
  in_progress
  completed
  skipped
}

enum OnboardingTaskType {
  wizard
  video
  action
  form
}

enum PartnerInvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum PartnerStatus {
  PENDING
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum PartnerType {
  BANCO
  MULTIFAMILY_OFFICE
  PLATAFORMA_MEMBRESIA
  ASOCIACION
  CONSULTORA
  INMOBILIARIA
  OTRO
}

enum PaymentStatus {
  pendiente
  pagado
  atrasado
}

enum PolicyStatus {
  activa
  por_renovar
  vencida
  cancelada
}

enum PortalTipo {
  idealista
  fotocasa
  habitaclia
  pisos_com
  yaencontre
  custom
}

enum PortfolioSize {
  size_1_5
  size_6_20
  size_21_100
  size_100_plus
}

enum PredictionStatus {
  favorable
  neutro
  desfavorable
}

enum ProjectProfessionalStatus {
  PROPUESTA
  ACEPTADO
  EN_CURSO
  REVISION
  ENTREGADO
  CERRADO
  CANCELADO
}

enum ProjectStatus {
  PROSPECTO
  ANALISIS
  ADQUISICION
  RENOVACION
  COMERCIALIZACION
  VENDIDO
  CANCELADO
}

enum ProjectType {
  PROYECTO_BASICO
  PROYECTO_EJECUCION
  DIRECCION_OBRA
  CERTIFICACION_ENERGETICA
  INSPECCION_TECNICA
  TASACION
  CONSULTORIA
}

enum ProviderAvailabilityStatus {
  disponible
  ocupado
  vacaciones
  enfermedad
  no_disponible
}

enum ProviderInvoiceStatus {
  borrador
  enviada
  aprobada
  rechazada
  pagada
  vencida
}

enum PublicacionEstado {
  borrador
  activa
  pausada
  expirada
  eliminada
}

enum QuoteStatus {
  solicitada
  en_revision
  cotizada
  aceptada
  rechazada
  expirada
}

enum RatingCategory {
  excelente
  muy_bueno
  bueno
  regular
  malo
}

enum RecurrenceFrequency {
  mensual
  trimestral
  semestral
  anual
}

enum ReminderChannel {
  email
  sms
  notification
  all
}

enum ReminderFrequency {
  once
  daily
  weekly
  monthly
}

enum ReminderType {
  pago_vencimiento
  contrato_expiracion
  mantenimiento_programado
  inspeccion_pendiente
  documento_vencimiento
  renovacion_seguro
  certificacion_expiracion
  reunion_proxima
  custom
}

enum RenovationCategory {
  ESTRUCTURAL
  FONTANERIA
  ELECTRICIDAD
  PINTURA
  SUELOS
  COCINA
  BANOS
  EXTERIORES
  OTROS
}

enum ReportFrequency {
  diario
  diaria
  semanal
  quincenal
  mensual
  trimestral
  anual
}

enum ReportType {
  morosidad
  ocupacion
  ingresos
  gastos
  mantenimiento
  general
}

enum ReviewEntityType {
  proveedor
  propiedad_unidad
  inquilino
  propietario
}

enum ReviewStatus {
  pendiente
  publicada
  rechazada
  reportada
}

enum RiskLevel {
  bajo
  medio
  alto
  critico
}

enum RoomContractStatus {
  activo
  vencido
  cancelado
  pendiente
}

enum RoomPaymentMethod {
  transferencia
  efectivo
  tarjeta
  domiciliacion
}

enum RoomStatus {
  disponible
  ocupada
  mantenimiento
  reservada
}

enum RoomType {
  exterior
  salon
  cocina
  dormitorio_principal
  dormitorio
  bano_principal
  bano
  terraza
  balcon
  jardin
  garaje
  trastero
  otro
}

enum SMSEstado {
  programado
  enviado
  fallido
  cancelado
}

enum SMSTipo {
  recordatorio_pago
  confirmacion_visita
  mantenimiento
  bienvenida
  alerta
  personalizado
}

enum SalesCommissionStatus {
  PENDIENTE
  APROBADA
  PAGADA
  CANCELADA
  RETENIDA
}

enum SalesCommissionType {
  CAPTACION
  RECURRENTE
  REACTIVACION
  BONIFICACION
  NIVEL2
}

enum SalesRepStatus {
  ACTIVO
  INACTIVO
  SUSPENDIDO
  CANCELADO
}

enum ScreeningEstado {
  pendiente
  en_revision
  verificado
  aprobado
  rechazado
}

enum SeasonType {
  ALTA
  MEDIA
  BAJA
  ESPECIAL
}

enum ServiceRatingType {
  mantenimiento
  atencion_cliente
  plataforma
  comunicacion
  general
}

enum SignatureStatus {
  pendiente
  firmado
  rechazado
  cancelado
  expirado
}

enum SignerStatus {
  pendiente
  visto
  firmado
  rechazado
}

enum SituacionLaboral {
  empleado
  autonomo
  estudiante
  jubilado
  desempleado
}

enum SocialMediaPlatform {
  FACEBOOK
  INSTAGRAM
  TWITTER
  LINKEDIN
  WHATSAPP_BUSINESS
  TIKTOK
}

enum SocialPostStatus {
  borrador
  programado
  publicado
  error
}

enum StripePaymentStatus {
  pending
  processing
  succeeded
  failed
  canceled
  refunded
}

enum SubscriptionTier {
  basico
  profesional
  empresarial
  personalizado
}

enum SuggestionPriority {
  baja
  media
  alta
  critica
}

enum SuggestionStatus {
  pendiente
  en_revision
  resuelta
  rechazada
}

enum SyncEventType {
  price_update
  availability_update
  booking_new
  booking_cancel
  booking_modify
  content_update
  review_received
}

enum TaskPriority {
  baja
  media
  alta
  urgente
}

enum TaskStatus {
  pendiente
  en_progreso
  completada
  cancelada
}

enum TechSavviness {
  bajo
  medio
  alto
}

enum TemplateType {
  contrato
  email
  recibo
}

enum TipoInformeComunidad {
  trimestral
  anual
  extraordinario
}

enum TipoMovimientoCaja {
  ingreso
  gasto
  traspaso
}

enum TransactionStatus {
  pendiente_revision
  conciliado
  descartado
}

enum TransactionType {
  ingreso
  gasto
}

enum TurnoverType {
  check_out
  check_in
  limpieza_profunda
  mantenimiento
  inspeccion
}

enum UIMode {
  simple
  standard
  advanced
}

enum UnitStatus {
  ocupada
  disponible
  en_mantenimiento
}

enum UnitType {
  vivienda
  local
  garaje
  trastero
}

enum UserRole {
  super_admin
  administrador
  gestor
  operador
  soporte
  community_manager
}

enum ValoracionFinalidad {
  venta
  alquiler
  seguro
  hipoteca
}

enum ValoracionMetodo {
  comparables
  renta
  coste
  mixto
}

enum VoteStatus {
  activa
  cerrada
  cancelada
}

enum VoteType {
  decision_comunidad
  mejora
  gasto
  normativa
  otro
}

enum WaitlistStatus {
  activa
  notificado
  convertida
  cancelada
  expirada
}

enum WidgetRefreshRate {
  manual
  realtime
  every_5min
  every_15min
  every_hour
  daily
}

enum WidgetSize {
  small
  medium
  large
  full
}

enum WidgetType {
  kpi
  chart_line
  chart_bar
  chart_pie
  chart_area
  table
  heatmap
  gauge
}

enum WorkOrderStatus {
  pendiente
  asignada
  aceptada
  en_progreso
  pausada
  completada
  cancelada
  rechazada
}

enum WorkflowActionType {
  enviar_notificacion
  crear_tarea
  enviar_email
  ejecutar_script
  actualizar_registro
  crear_incidencia
  generar_documento
  webhook
}

enum WorkflowStatus {
  activo
  inactivo
  borrador
}

enum WorkflowTriggerType {
  manual
  evento
  programado
  webhook
}

enum calendar_event_priorities {
  baja
  media
  alta
  critica
}

enum calendar_event_types {
  pago
  vencimiento
  visita
  mantenimiento
  inspeccion
  reunion
  recordatorio
  otro
}

enum claim_statuses {
  abierto
  en_proceso
  aprobado
  rechazado
  cerrado
}

enum common_space_types {
  salon_fiestas
  gimnasio
  piscina
  sala_reuniones
  zona_bbq
  cancha_deportiva
  lavanderia
  terraza
  otro
}

enum energy_ratings {
  A
  B
  C
  D
  E
  F
  G
}

enum insurance_statuses {
  activa
  vencida
  cancelada
  pendiente_renovacion
}

enum insurance_types {
  incendio
  robo
  responsabilidad_civil
  vida
  hogar
  comunidad
  impago_alquiler
  otro
}

enum reservation_statuses {
  pendiente
  confirmada
  cancelada
  completada
}
