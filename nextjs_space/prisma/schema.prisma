generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/homming_vidaro/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum UserRole {
  administrador
  gestor
  operador
}

enum BuildingType {
  residencial
  mixto
  comercial
}

enum UnitType {
  vivienda
  local
  garaje
  trastero
}

enum UnitStatus {
  ocupada
  disponible
  en_mantenimiento
}

enum ContractStatus {
  activo
  vencido
  cancelado
}

enum ContractType {
  residencial
  comercial
  temporal
}

enum PaymentStatus {
  pendiente
  pagado
  atrasado
}

enum RiskLevel {
  bajo
  medio
  alto
}

enum MaintenancePriority {
  alta
  media
  baja
}

enum MaintenanceStatus {
  pendiente
  en_progreso
  programado
  completado
}

enum DocumentType {
  contrato
  dni
  nomina
  certificado_energetico
  ite
  seguro
  factura
  otro
}

enum ExpenseCategory {
  mantenimiento
  impuestos
  seguros
  servicios
  reparaciones
  comunidad
  otro
}

enum NotificationType {
  pago_atrasado
  contrato_vencimiento
  mantenimiento_urgente
  mantenimiento_preventivo
  documento_vencer
  unidad_vacante
  inspeccion_programada
  alerta_sistema
  info
}

enum SituacionLaboral {
  empleado
  autonomo
  estudiante
  jubilado
  desempleado
}

enum EstadoCivil {
  soltero
  casado
  divorciado
  viudo
}

enum CandidateStatus {
  nuevo
  en_revision
  preseleccionado
  aprobado
  rechazado
}

enum IncrementoType {
  porcentaje
  ipc
  fijo
}

enum MessageStatus {
  enviado
  leido
}

enum TemplateType {
  contrato
  email
  recibo
}

model User {
  id            String          @id @default(cuid())
  email         String          @unique
  name          String
  password      String
  role          UserRole        @default(gestor)
  companyId     String
  activo        Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  company       Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  notifications Notification[]
  tasksAsignadas Task[]         @relation("TaskAssignedTo")
  tasksCreadas   Task[]         @relation("TaskCreatedBy")
  auditLogs     AuditLog[]

  @@map("users")
}

model Building {
  id                String       @id @default(cuid())
  companyId         String
  nombre            String
  direccion         String
  tipo              BuildingType
  anoConstructor    Int
  numeroUnidades    Int
  estadoConservacion String?
  certificadoEnergetico String?
  ascensor          Boolean      @default(false)
  garaje            Boolean      @default(false)
  trastero          Boolean      @default(false)
  piscina           Boolean      @default(false)
  jardin            Boolean      @default(false)
  gastosComunidad   Float?
  ibiAnual          Float?
  latitud           Float?
  longitud          Float?
  imagenes          String[]     @default([])
  etiquetas         String[]     @default([])
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  company           Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units             Unit[]
  expenses          Expense[]
  documents         Document[]
  maintenanceSchedules MaintenanceSchedule[]
  serviceQuotes     ServiceQuote[]
  serviceJobs       ServiceJob[]
  energyReadings    EnergyReading[]
  energyAlerts      EnergyAlert[]
  insurancePolicies InsurancePolicy[]

  @@map("buildings")
}

model Tenant {
  id                String            @id @default(cuid())
  companyId         String
  nombreCompleto    String
  dni               String            @unique
  email             String            @unique
  telefono          String
  fechaNacimiento   DateTime
  nacionalidad      String?
  estadoCivil       EstadoCivil?
  numeroOcupantes   Int?
  direccionActual   String?
  situacionLaboral  SituacionLaboral?
  empresa           String?
  puesto            String?
  antiguedad        Int?
  ingresosMensuales Float?
  ratioRentaIngresos Float?
  scoring           Int               @default(50)
  nivelRiesgo       RiskLevel         @default(medio)
  password          String?
  notas             String?           @db.Text
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units             Unit[]
  contracts         Contract[]
  documents         Document[]
  messagesReceived  Message[]         @relation("MessageRecipient")
  messagesSent      Message[]         @relation("MessageSender")
  stripeCustomer    StripeCustomer?
  documentShares    DocumentShare[]

  @@map("tenants")
}

model Unit {
  id                String     @id @default(cuid())
  numero            String
  buildingId        String
  tipo              UnitType
  estado            UnitStatus @default(disponible)
  superficie        Float
  superficieUtil    Float?
  habitaciones      Int?
  banos             Int?
  planta            Int?
  orientacion       String?
  rentaMensual      Float
  tenantId          String?
  aireAcondicionado Boolean    @default(false)
  calefaccion       Boolean    @default(false)
  terraza           Boolean    @default(false)
  balcon            Boolean    @default(false)
  amueblado         Boolean    @default(false)
  imagenes          String[]   @default([])
  tourVirtual       String?
  planos            String[]   @default([])
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  building          Building   @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  tenant            Tenant?    @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  contracts         Contract[]
  maintenanceRequests MaintenanceRequest[]
  maintenanceSchedules MaintenanceSchedule[]
  expenses          Expense[]
  documents         Document[]
  candidates        Candidate[]
  serviceQuotes     ServiceQuote[]
  serviceJobs       ServiceJob[]
  energyReadings    EnergyReading[]
  energyAlerts      EnergyAlert[]

  @@unique([buildingId, numero])
  @@map("units")
}

model Contract {
  id                String         @id @default(cuid())
  unitId            String
  tenantId          String
  fechaInicio       DateTime
  fechaFin          DateTime
  rentaMensual      Float
  diaPago           Int            @default(1)
  deposito          Float
  mesesFianza       Int            @default(1)
  renovacionAutomatica Boolean     @default(false)
  incrementoType    IncrementoType @default(ipc)
  incrementoValor   Float?
  gastosIncluidos   String[]       @default([])
  gastosExcluidos   String[]       @default([])
  clausulasAdicionales String?     @db.Text
  estado            ContractStatus @default(activo)
  tipo              ContractType   @default(residencial)
  contractPdfPath   String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  unit              Unit           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  tenant            Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payments          Payment[]
  documents         Document[]
  stripeSubscription StripeSubscription?

  @@map("contracts")
}

enum StripePaymentStatus {
  pending
  processing
  succeeded
  failed
  canceled
  refunded
}

model Payment {
  id                String        @id @default(cuid())
  contractId        String
  periodo           String
  monto             Float
  fechaVencimiento  DateTime
  fechaPago         DateTime?
  estado            PaymentStatus @default(pendiente)
  metodoPago        String?
  reciboPdfPath     String?
  nivelRiesgo       RiskLevel     @default(bajo)
  
  // Stripe integration fields
  stripePaymentIntentId String?   @unique
  stripePaymentStatus   StripePaymentStatus?
  stripeClientSecret    String?
  stripeFee             Float?
  stripeNetAmount       Float?
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  contract          Contract      @relation(fields: [contractId], references: [id], onDelete: Cascade)
  stripeSubscription StripeSubscription? @relation(fields: [stripeSubscriptionId], references: [id], onDelete: SetNull)
  stripeSubscriptionId String?

  @@map("payments")
}

model StripeSubscription {
  id                    String   @id @default(cuid())
  contractId            String   @unique
  stripeSubscriptionId  String   @unique
  stripeCustomerId      String
  stripePriceId         String?
  status                String   // active, canceled, past_due, etc.
  currentPeriodStart    DateTime
  currentPeriodEnd      DateTime
  cancelAtPeriodEnd     Boolean  @default(false)
  canceledAt            DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  contract              Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  payments              Payment[]

  @@map("stripe_subscriptions")
}

model StripeCustomer {
  id                String   @id @default(cuid())
  tenantId          String   @unique
  stripeCustomerId  String   @unique
  email             String
  name              String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("stripe_customers")
}

model StripeWebhookEvent {
  id                String   @id @default(cuid())
  stripeEventId     String   @unique
  type              String
  data              String   @db.Text
  processed         Boolean  @default(false)
  processingError   String?  @db.Text
  createdAt         DateTime @default(now())
  processedAt       DateTime?

  @@map("stripe_webhook_events")
  @@index([processed, createdAt])
}

model MaintenanceRequest {
  id                String              @id @default(cuid())
  unitId            String
  titulo            String
  descripcion       String              @db.Text
  prioridad         MaintenancePriority @default(media)
  estado            MaintenanceStatus   @default(pendiente)
  fechaSolicitud    DateTime            @default(now())
  fechaProgramada   DateTime?
  fechaCompletada   DateTime?
  providerId        String?
  costoEstimado     Float?
  costoReal         Float?
  fotosProblem      String[]            @default([])
  fotosCompletado   String[]            @default([])
  valoracion        Int?
  comentarios       String?             @db.Text
  requiereAprobacion Boolean            @default(false)
  estadoAprobacion  ApprovalStatus?     @default(pendiente)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  unit              Unit                @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?           @relation(fields: [providerId], references: [id], onDelete: SetNull)
  approvals         Approval[]

  @@map("maintenance_requests")
}

model Provider {
  id                String              @id @default(cuid())
  companyId         String
  nombre            String
  tipo              String
  telefono          String
  email             String?
  direccion         String?
  rating            Float?
  notas             String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  company           Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  maintenanceRequests MaintenanceRequest[]
  maintenanceSchedules MaintenanceSchedule[]
  expenses          Expense[]
  serviceQuotes     ServiceQuote[]
  serviceJobs       ServiceJob[]
  serviceReviews    ServiceReview[]

  @@map("providers")
}

enum ApprovalStatus {
  pendiente
  aprobado
  rechazado
}

model Expense {
  id                String          @id @default(cuid())
  buildingId        String?
  unitId            String?
  providerId        String?
  concepto          String
  categoria         ExpenseCategory
  monto             Float
  fecha             DateTime
  facturaPdfPath    String?
  notas             String?         @db.Text
  requiereAprobacion Boolean        @default(false)
  estadoAprobacion  ApprovalStatus? @default(pendiente)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  building          Building?       @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  unit              Unit?           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?       @relation(fields: [providerId], references: [id], onDelete: SetNull)
  approvals         Approval[]

  @@map("expenses")
}

model Document {
  id                String          @id @default(cuid())
  nombre            String
  tipo              DocumentType
  cloudStoragePath  String
  tenantId          String?
  unitId            String?
  buildingId        String?
  contractId        String?
  folderId          String?
  versionActual     Int             @default(1)
  tags              String[]        @default([])
  descripcion       String?         @db.Text
  fechaSubida       DateTime        @default(now())
  fechaVencimiento  DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  tenant            Tenant?         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit              Unit?           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  building          Building?       @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  contract          Contract?       @relation(fields: [contractId], references: [id], onDelete: Cascade)
  folder            DocumentFolder? @relation("FolderDocuments", fields: [folderId], references: [id], onDelete: SetNull)
  versions          DocumentVersion[]
  shares            DocumentShare[]

  @@index([folderId])
  @@map("documents")
}

model Notification {
  id                String            @id @default(cuid())
  companyId         String
  tipo              NotificationType
  titulo            String
  mensaje           String            @db.Text
  leida             Boolean           @default(false)
  prioridad         RiskLevel         @default(bajo)
  fechaLimite       DateTime?
  entityId          String?
  entityType        String?
  userId            String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user              User?             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId, leida])
  @@index([companyId, createdAt])
  @@map("notifications")
}

model Candidate {
  id                String           @id @default(cuid())
  unitId            String
  nombreCompleto    String
  dni               String
  email             String
  telefono          String
  fechaNacimiento   DateTime
  situacionLaboral  SituacionLaboral?
  ingresosMensuales Float?
  scoring           Int              @default(0)
  estado            CandidateStatus  @default(nuevo)
  documentos        String[]         @default([])
  notas             String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  unit              Unit             @relation(fields: [unitId], references: [id], onDelete: Cascade)
  visits            Visit[]

  @@map("candidates")
}

model Visit {
  id                String           @id @default(cuid())
  candidateId       String
  fechaVisita       DateTime
  confirmada        Boolean          @default(false)
  asistio           Boolean?
  feedback          String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  candidate         Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@map("visits")
}

model Message {
  id                String           @id @default(cuid())
  senderId          String
  recipientId       String
  asunto            String
  mensaje           String           @db.Text
  estado            MessageStatus    @default(enviado)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  sender            Tenant           @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  recipient         Tenant           @relation("MessageRecipient", fields: [recipientId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Template {
  id                String           @id @default(cuid())
  nombre            String
  tipo              TemplateType
  contenido         String           @db.Text
  variables         String[]         @default([])
  activo            Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("templates")
}

model Company {
  id                String           @id @default(cuid())
  nombre            String           @default("INMOVA")
  cif               String?
  direccion         String?
  telefono          String?
  email             String?
  logoUrl           String?
  codigoPostal      String?
  ciudad            String?
  pais              String           @default("España")
  iban              String?
  colorPrimario     String?          @default("#000000")
  colorSecundario   String?          @default("#FFFFFF")
  pieDocumento      String?          @db.Text
  activo            Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  users             User[]
  buildings         Building[]
  tenants           Tenant[]
  providers         Provider[]
  tasks             Task[]
  auditLogs         AuditLog[]
  notifications     Notification[]

  @@map("company")
}

enum RecurrenceFrequency {
  mensual
  trimestral
  semestral
  anual
}

model MaintenanceSchedule {
  id                String                @id @default(cuid())
  titulo            String
  descripcion       String                @db.Text
  tipo              String
  buildingId        String?
  unitId            String?
  frecuencia        RecurrenceFrequency
  proximaFecha      DateTime
  ultimaFecha       DateTime?
  diasAnticipacion  Int                   @default(15)
  activo            Boolean               @default(true)
  providerId        String?
  costoEstimado     Float?
  notas             String?               @db.Text
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  building          Building?             @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  unit              Unit?                 @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?             @relation(fields: [providerId], references: [id], onDelete: SetNull)

  @@map("maintenance_schedules")
}

enum TaskPriority {
  baja
  media
  alta
  urgente
}

enum TaskStatus {
  pendiente
  en_progreso
  completada
  cancelada
}

model Task {
  id                String           @id @default(cuid())
  companyId         String
  titulo            String
  descripcion       String?          @db.Text
  estado            TaskStatus       @default(pendiente)
  prioridad         TaskPriority     @default(media)
  fechaLimite       DateTime?
  fechaInicio       DateTime?
  fechaCompletada   DateTime?
  asignadoA         String?
  creadoPor         String
  recordatorioEnviado Boolean        @default(false)
  notas             String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  asignadoUser      User?            @relation("TaskAssignedTo", fields: [asignadoA], references: [id], onDelete: SetNull)
  creadorUser       User             @relation("TaskCreatedBy", fields: [creadoPor], references: [id], onDelete: Cascade)

  @@map("tasks")
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
}

model AuditLog {
  id              String        @id @default(cuid())
  companyId       String
  userId          String
  action          AuditAction
  entityType      String
  entityId        String?
  entityName      String?
  changes         String?       @db.Text
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime      @default(now())

  company         Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
  @@index([companyId, createdAt])
  @@index([userId, createdAt])
  @@index([entityType, entityId])
}

enum ReportFrequency {
  diario
  diaria
  semanal
  quincenal
  mensual
  trimestral
}

enum ReportType {
  morosidad
  ocupacion
  ingresos
  gastos
  mantenimiento
  general
}

model ScheduledReport {
  id                String          @id @default(cuid())
  companyId         String
  nombre            String
  tipo              ReportType
  frecuencia        ReportFrequency
  destinatarios     String[]        @default([])
  ultimoEnvio       DateTime?
  proximoEnvio      DateTime
  activo            Boolean         @default(true)
  incluirPdf        Boolean         @default(true)
  incluirCsv        Boolean         @default(true)
  filtros           String?         @db.Text
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@map("scheduled_reports")
}

model NotificationPreference {
  id                    String   @id @default(cuid())
  userId                String   @unique
  emailPagoAtrasado     Boolean  @default(true)
  emailContratoVencimiento Boolean @default(true)
  emailMantenimiento    Boolean  @default(true)
  emailDocumento        Boolean  @default(true)
  pushPagoAtrasado      Boolean  @default(true)
  pushContratoVencimiento Boolean @default(true)
  pushMantenimiento     Boolean  @default(true)
  pushDocumento         Boolean  @default(false)
  frecuenciaResumen     String   @default("semanal")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@map("notification_preferences")
}

enum ApprovalType {
  gasto
  mantenimiento
}

model Approval {
  id                String         @id @default(cuid())
  tipo              ApprovalType
  entityId          String
  expenseId         String?
  maintenanceId     String?
  solicitadoPor     String
  revisadoPor       String?
  estado            ApprovalStatus @default(pendiente)
  monto             Float?
  motivo            String?        @db.Text
  comentarioRechazo String?        @db.Text
  fechaSolicitud    DateTime       @default(now())
  fechaRevision     DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  expense           Expense?            @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  maintenance       MaintenanceRequest? @relation(fields: [maintenanceId], references: [id], onDelete: Cascade)

  @@map("approvals")
}

enum ChatStatus {
  activa
  cerrada
  archivada
}

enum ChatMessageStatus {
  enviado
  entregado
  leido
}

model ChatConversation {
  id                String       @id @default(cuid())
  companyId         String
  tenantId          String?
  userId            String?
  asunto            String
  estado            ChatStatus   @default(activa)
  ultimoMensaje     String?      @db.Text
  ultimoMensajeFecha DateTime?
  cerradoPor        String?
  fechaCierre       DateTime?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  messages          ChatMessage[]

  @@index([companyId, estado])
  @@index([tenantId])
  @@index([userId])
  @@map("chat_conversations")
}

model ChatMessage {
  id                String            @id @default(cuid())
  conversationId    String
  senderType        String            // "user" o "tenant"
  senderId          String
  mensaje           String            @db.Text
  leido             Boolean           @default(false)
  estado            ChatMessageStatus @default(enviado)
  adjuntos          String[]          @default([])
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  conversation      ChatConversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@map("chat_messages")
}

enum EmailCampaignStatus {
  borrador
  programada
  enviando
  enviada
  cancelada
}

model EmailCampaign {
  id                String              @id @default(cuid())
  companyId         String
  nombre            String
  asunto            String
  contenido         String              @db.Text
  plantillaId       String?
  estado            EmailCampaignStatus @default(borrador)
  programadaPara    DateTime?
  enviadaEn         DateTime?
  creadoPor         String
  segmento          String?             // "todos", "inquilinos_activos", "inquilinos_morosos", etc.
  filtros           String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  destinatarios     EmailRecipient[]

  @@map("email_campaigns")
}

model EmailRecipient {
  id                String   @id @default(cuid())
  campaignId        String
  email             String
  nombre            String
  tenantId          String?
  enviado           Boolean  @default(false)
  entregado         Boolean  @default(false)
  abierto           Boolean  @default(false)
  clicado           Boolean  @default(false)
  rebotado          Boolean  @default(false)
  fechaEnvio        DateTime?
  fechaApertura     DateTime?
  fechaClic         DateTime?
  errorEnvio        String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  campaign          EmailCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@map("email_recipients")
}

model DocumentFolder {
  id                String           @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String?          @db.Text
  parentFolderId    String?
  color             String?          @default("#000000")
  icono             String?          @default("Folder")
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  parentFolder      DocumentFolder?  @relation("FolderHierarchy", fields: [parentFolderId], references: [id], onDelete: Cascade)
  subFolders        DocumentFolder[] @relation("FolderHierarchy")
  documents         Document[]       @relation("FolderDocuments")

  @@index([companyId])
  @@index([parentFolderId])
  @@map("document_folders")
}

model DocumentVersion {
  id                String   @id @default(cuid())
  documentId        String
  versionNumero     Int
  cloud_storage_path String
  tamano            Int
  uploadedBy        String
  comentario        String?  @db.Text
  createdAt         DateTime @default(now())

  document          Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@map("document_versions")
}

model DocumentTemplate {
  id                String   @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String?  @db.Text
  tipo              String
  contenido         String   @db.Text
  variables         String[] @default([])
  activo            Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@map("document_templates")
}

model DocumentShare {
  id                String   @id @default(cuid())
  documentId        String
  tenantId          String
  compartidoPor     String
  puedeDescargar    Boolean  @default(true)
  puedeEditar       Boolean  @default(false)
  notificado        Boolean  @default(false)
  visto             Boolean  @default(false)
  fechaVisto        DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  document          Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([tenantId])
  @@map("document_shares")
}

model DocumentTag {
  id                String   @id @default(cuid())
  companyId         String
  nombre            String
  color             String   @default("#000000")
  documentos        String[] @default([])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@map("document_tags")
}

model AnalyticsSnapshot {
  id                      String   @id @default(cuid())
  companyId               String
  fecha                   DateTime @default(now())
  periodo                 String
  totalUnidades           Int
  unidadesOcupadas        Int
  unidadesVacantes        Int
  tasaOcupacion           Float
  ingresosMensuales       Float
  gastosMensuales         Float
  ingresoNeto             Float
  morosidad               Float
  tasaMorosidad           Float
  contratosPorVencer      Int
  mantenimientoPendiente  Int
  ticketPromedio          Float
  createdAt               DateTime @default(now())

  @@index([companyId])
  @@index([fecha])
  @@index([periodo])
  @@map("analytics_snapshots")
}

model BuildingMetrics {
  id                      String   @id @default(cuid())
  buildingId              String
  fecha                   DateTime @default(now())
  periodo                 String
  totalUnidades           Int
  unidadesOcupadas        Int
  tasaOcupacion           Float
  ingresosReales          Float
  ingresosPotenciales     Float
  gastos                  Float
  ingresoNeto             Float
  roi                     Float
  ticketPromedio          Float
  diasPromedioVacancia    Int
  satisfaccionInquilinos  Float?
  createdAt               DateTime @default(now())

  @@index([buildingId])
  @@index([fecha])
  @@index([periodo])
  @@map("building_metrics")
}

model TenantBehavior {
  id                      String   @id @default(cuid())
  tenantId                String
  fecha                   DateTime @default(now())
  pagosATiempo            Int      @default(0)
  pagosRetrasados         Int      @default(0)
  promedioRetrasosDias    Float    @default(0)
  ticketsMantenimiento    Int      @default(0)
  scoreComportamiento     Int      @default(50)
  riesgoMorosidad         String   @default("bajo")
  probabilidadRenovacion  Float?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([tenantId])
  @@index([fecha])
  @@map("tenant_behaviors")
}

model PredictionModel {
  id                String   @id @default(cuid())
  companyId         String
  tipo              String
  nombre            String
  descripcion       String?  @db.Text
  parametros        String   @db.Text
  precision         Float?
  ultimoEntrenamiento DateTime?
  activo            Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@index([tipo])
  @@map("prediction_models")
}

model Prediction {
  id                String   @id @default(cuid())
  companyId         String
  modelId           String?
  tipo              String
  entityId          String?
  entityType        String?
  periodo           String
  valorPredicho     Float
  confianza         Float
  factores          String   @db.Text
  fechaPrediccion   DateTime @default(now())
  fechaObjetivo     DateTime
  valorReal         Float?
  createdAt         DateTime @default(now())

  @@index([companyId])
  @@index([tipo])
  @@index([entityId])
  @@index([fechaObjetivo])
  @@map("predictions")
}

model Recommendation {
  id                String   @id @default(cuid())
  companyId         String
  tipo              String
  prioridad         String   @default("media")
  titulo            String
  descripcion       String   @db.Text
  entityId          String?
  entityType        String?
  impactoEstimado   Float?
  accionSugerida    String   @db.Text
  aplicada          Boolean  @default(false)
  fechaAplicacion   DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@index([tipo])
  @@index([prioridad])
  @@map("recommendations")
}

model MaintenanceInventory {
  id                String   @id @default(cuid())
  companyId         String
  buildingId        String?
  nombre            String
  categoria         String
  descripcion       String?  @db.Text
  codigoSKU         String?
  cantidad          Int      @default(0)
  cantidadMinima    Int      @default(5)
  unidadMedida      String   @default("unidad")
  costoUnitario     Float    @default(0)
  proveedor         String?
  ubicacion         String?
  fechaUltimaCompra DateTime?
  notas             String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([categoria])
  @@map("maintenance_inventory")
}

model MaintenanceHistory {
  id                      String   @id @default(cuid())
  maintenanceRequestId    String
  unitId                  String?
  buildingId              String?
  equipoSistema           String
  tipoProblema            String
  descripcionProblema     String   @db.Text
  solucionAplicada        String?  @db.Text
  repuestosUsados         String?  @db.Text
  costoReparacion         Float?
  tiempoReparacion        Int?
  proveedorId             String?
  tecnicoAsignado         String?
  fechaDeteccion          DateTime
  fechaReparacion         DateTime?
  proximoMantenimiento    DateTime?
  createdAt               DateTime @default(now())

  @@index([equipoSistema])
  @@index([tipoProblema])
  @@index([unitId])
  @@index([buildingId])
  @@index([fechaDeteccion])
  @@map("maintenance_history")
}

model MaintenanceFailurePrediction {
  id                String   @id @default(cuid())
  companyId         String
  equipoSistema     String
  buildingId        String?
  unitId            String?
  probabilidadFalla Float
  diasEstimados     Int
  factoresRiesgo    String   @db.Text
  recomendaciones   String   @db.Text
  historialAnalizado Int     @default(0)
  confianza         Float    @default(0.5)
  estado            String   @default("activa")
  fechaPrediccion   DateTime @default(now())
  fechaObjetivo     DateTime
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@index([equipoSistema])
  @@index([buildingId])
  @@index([estado])
  @@index([fechaObjetivo])
  @@map("maintenance_failure_predictions")
}

model MaintenanceBudget {
  id                String   @id @default(cuid())
  companyId         String
  buildingId        String?
  periodo           String
  presupuestoTotal  Float
  gastadoCorrectivo Float    @default(0)
  gastadoPreventivo Float    @default(0)
  gastadoEmergencia Float    @default(0)
  ahorroPreventivo  Float    @default(0)
  numeroOrdenes     Int      @default(0)
  fechaInicio       DateTime
  fechaFin          DateTime
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([periodo])
  @@map("maintenance_budgets")
}

model MaintenanceMetrics {
  id                      String   @id @default(cuid())
  companyId               String
  buildingId              String?
  periodo                 String
  tiempoRespuestaPromedio Float
  tiempoResolucionPromedio Float
  tasaResolucionPrimera   Float
  satisfaccionCliente     Float?
  costosPreventivo        Float    @default(0)
  costosCorrectivo        Float    @default(0)
  costosEmergencia        Float    @default(0)
  solicitudesCompletas    Int      @default(0)
  solicitudesPendientes   Int      @default(0)
  solicitudesAtrasadas    Int      @default(0)
  disponibilidadEquipos   Float    @default(100)
  createdAt               DateTime @default(now())

  @@index([companyId])
  @@index([buildingId])
  @@index([periodo])
  @@map("maintenance_metrics")
}

model MaintenanceDiagnostic {
  id                String   @id @default(cuid())
  maintenanceRequestId String
  equipoSistema     String
  sintomas          String   @db.Text
  diagnostico       String   @db.Text
  causaProbable     String   @db.Text
  solucionSugerida  String   @db.Text
  repuestosNecesarios String? @db.Text
  costoEstimado     Float?
  tiempoEstimado    Int?
  prioridad         String   @default("media")
  confianza         Float    @default(0.7)
  creadoPor         String
  createdAt         DateTime @default(now())

  @@index([maintenanceRequestId])
  @@index([equipoSistema])
  @@map("maintenance_diagnostics")
}

model PushSubscription {
  id         String   @id @default(cuid())
  userId     String
  endpoint   String   @unique
  keys       String   @db.Text
  userAgent  String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
  @@map("push_subscriptions")
}

// ============================================
// PAQUETE 8: CONTABILIDAD
// ============================================

enum TransactionType {
  ingreso
  gasto
}

enum AccountingCategory {
  ingreso_renta
  ingreso_deposito
  ingreso_otro
  gasto_mantenimiento
  gasto_impuesto
  gasto_seguro
  gasto_servicio
  gasto_reparacion
  gasto_comunidad
  gasto_administracion
  gasto_otro
}

model AccountingTransaction {
  id                String              @id @default(cuid())
  companyId         String
  buildingId        String?
  unitId            String?
  tipo              TransactionType
  categoria         AccountingCategory
  concepto          String
  monto             Float
  fecha             DateTime
  referencia        String?
  paymentId         String?
  expenseId         String?
  documentoPath     String?
  notas             String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([tipo])
  @@index([categoria])
  @@index([fecha])
  @@map("accounting_transactions")
}

model CashFlowStatement {
  id                    String   @id @default(cuid())
  companyId             String
  periodo               String
  fechaInicio           DateTime
  fechaFin              DateTime
  ingresosTotales       Float    @default(0)
  gastosTotales         Float    @default(0)
  flujoNeto             Float    @default(0)
  saldoInicial          Float    @default(0)
  saldoFinal            Float    @default(0)
  ingresosRenta         Float    @default(0)
  ingresosDeposito      Float    @default(0)
  ingresosOtros         Float    @default(0)
  gastosMantenimiento   Float    @default(0)
  gastosImpuestos       Float    @default(0)
  gastosSeguros         Float    @default(0)
  gastosServicios       Float    @default(0)
  gastosOtros           Float    @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([companyId])
  @@index([periodo])
  @@map("cash_flow_statements")
}

// ============================================
// PAQUETE 9: CRM
// ============================================

enum CrmLeadStatus {
  nuevo
  contactado
  calificado
  visitado
  propuesta_enviada
  negociacion
  ganado
  perdido
}

enum CrmLeadSource {
  web
  referido
  llamada
  email
  redes_sociales
  anuncio
  otro
}

enum CrmActivityType {
  llamada
  email
  reunion
  visita
  seguimiento
  nota
}

model CrmLead {
  id                String         @id @default(cuid())
  companyId         String
  nombreCompleto    String
  email             String
  telefono          String
  unitId            String?
  estado            CrmLeadStatus  @default(nuevo)
  fuente            CrmLeadSource  @default(web)
  scoring           Int            @default(0)
  presupuesto       Float?
  fechaMudanza      DateTime?
  necesidades       String?        @db.Text
  notas             String?        @db.Text
  asignadoA         String?
  ultimoContacto    DateTime?
  proximoSeguimiento DateTime?
  probabilidadCierre Float         @default(0)
  valorEstimado     Float?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  activities        CrmActivity[]

  @@index([companyId])
  @@index([estado])
  @@index([asignadoA])
  @@index([scoring])
  @@map("crm_leads")
}

model CrmActivity {
  id                String          @id @default(cuid())
  leadId            String
  tipo              CrmActivityType
  asunto            String
  descripcion       String?         @db.Text
  fecha             DateTime
  duracion          Int?
  resultado         String?         @db.Text
  proximaAccion     String?         @db.Text
  completada        Boolean         @default(false)
  creadoPor         String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  lead              CrmLead         @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([tipo])
  @@index([fecha])
  @@map("crm_activities")
}

// ============================================
// PAQUETE 10: GESTIÓN LEGAL
// ============================================

enum LegalTemplateCategory {
  contrato_arrendamiento
  anexo_contrato
  notificacion_inquilino
  reclamacion
  finalizacion_contrato
  inspeccion
  certificado
  otro
}

enum InspectionStatus {
  programada
  completada
  pendiente_accion
}

enum InspectionType {
  entrada
  salida
  periodica
  emergencia
}

enum PolicyStatus {
  activa
  por_renovar
  vencida
  cancelada
}

model LegalTemplate {
  id                String                @id @default(cuid())
  companyId         String
  nombre            String
  categoria         LegalTemplateCategory
  descripcion       String?               @db.Text
  contenido         String                @db.Text
  variables         String[]              @default([])
  jurisdiccion      String?
  aplicableA        String[]              @default([])
  activo            Boolean               @default(true)
  ultimaRevision    DateTime?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  @@index([companyId])
  @@index([categoria])
  @@map("legal_templates")
}

model LegalInspection {
  id                String            @id @default(cuid())
  companyId         String
  unitId            String?
  buildingId        String?
  contractId        String?
  tenantId          String?
  tipo              InspectionType
  estado            InspectionStatus  @default(programada)
  fechaProgramada   DateTime
  fechaRealizada    DateTime?
  inspector         String
  checklist         String            @db.Text
  observaciones     String?           @db.Text
  fotosAntes        String[]          @default([])
  fotosDespues      String[]          @default([])
  daniosEncontrados String?           @db.Text
  costoEstimadoDanos Float?
  reportePdfPath    String?
  firmaTenant       String?
  firmaInspector    String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@index([companyId])
  @@index([unitId])
  @@index([tipo])
  @@index([estado])
  @@index([fechaProgramada])
  @@map("legal_inspections")
}

model InsurancePolicy {
  id                String        @id @default(cuid())
  companyId         String
  buildingId        String?
  building          Building?     @relation(fields: [buildingId], references: [id], onDelete: SetNull)
  tipoSeguro        String
  numeroPoliza      String        @unique
  aseguradora       String
  coberturas        String[]      @default([])
  montoCobertura    Float
  primaAnual        Float
  deducible         Float?
  fechaInicio       DateTime
  fechaVencimiento  DateTime
  fechaRenovacion   DateTime?
  estado            PolicyStatus  @default(activa)
  agente            String?
  telefonoAgente    String?
  emailAgente       String?
  documentoPath     String?
  notas             String?       @db.Text
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([estado])
  @@index([fechaVencimiento])
  @@map("insurance_policies")
}

model ComplianceAlert {
  id                String    @id @default(cuid())
  companyId         String
  tipo              String
  titulo            String
  descripcion       String    @db.Text
  fechaLimite       DateTime
  estado            String    @default("pendiente")
  prioridad         String    @default("media")
  entityId          String?
  entityType        String?
  accionRequerida   String?   @db.Text
  completada        Boolean   @default(false)
  fechaCompletada   DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([companyId])
  @@index([estado])
  @@index([fechaLimite])
  @@map("compliance_alerts")
}


// ============================================
// PAQUETE 11: MARKETPLACE DE SERVICIOS
// ============================================

enum QuoteStatus {
  solicitada
  en_revision
  cotizada
  aceptada
  rechazada
  expirada
}

enum JobStatus {
  pendiente
  en_progreso
  completado
  cancelado
}

model ServiceQuote {
  id                String       @id @default(cuid())
  companyId         String
  providerId        String
  provider          Provider     @relation(fields: [providerId], references: [id], onDelete: Cascade)
  buildingId        String?
  building          Building?    @relation(fields: [buildingId], references: [id], onDelete: SetNull)
  unitId            String?
  unit              Unit?        @relation(fields: [unitId], references: [id], onDelete: SetNull)
  titulo            String
  descripcion       String       @db.Text
  servicioRequerido String
  urgencia          String       @default("media")
  fechaSolicitud    DateTime     @default(now())
  fechaRespuesta    DateTime?
  estado            QuoteStatus  @default(solicitada)
  montoCotizado     Float?
  tiempoEstimado    String?
  notasProveedor    String?      @db.Text
  validezCotizacion DateTime?
  solicitadoPor     String
  serviceJobs       ServiceJob[]
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([providerId])
  @@index([estado])
  @@index([fechaSolicitud])
  @@map("service_quotes")
}

model ServiceJob {
  id                String       @id @default(cuid())
  companyId         String
  providerId        String
  provider          Provider     @relation(fields: [providerId], references: [id], onDelete: Cascade)
  quoteId           String?
  quote             ServiceQuote? @relation(fields: [quoteId], references: [id], onDelete: SetNull)
  buildingId        String?
  building          Building?    @relation(fields: [buildingId], references: [id], onDelete: SetNull)
  unitId            String?
  unit              Unit?        @relation(fields: [unitId], references: [id], onDelete: SetNull)
  titulo            String
  descripcion       String       @db.Text
  fechaInicio       DateTime
  fechaFin          DateTime?
  estado            JobStatus    @default(pendiente)
  montoTotal        Float
  montoPagado       Float        @default(0)
  garantiaMeses     Int?
  notasTrabajo      String?      @db.Text
  resultadoTrabajo  String?      @db.Text
  reviews           ServiceReview[]
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([providerId])
  @@index([estado])
  @@index([fechaInicio])
  @@map("service_jobs")
}

model ServiceReview {
  id                String       @id @default(cuid())
  companyId         String
  jobId             String
  job               ServiceJob   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  providerId        String
  provider          Provider     @relation(fields: [providerId], references: [id], onDelete: Cascade)
  calificacion      Int          // 1-5 estrellas
  puntualidad       Int?         // 1-5
  calidad           Int?         // 1-5
  comunicacion      Int?         // 1-5
  precioJusto       Int?         // 1-5
  comentario        String?      @db.Text
  recomendaria      Boolean      @default(true)
  creadoPor         String
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([jobId])
  @@index([providerId])
  @@index([calificacion])
  @@map("service_reviews")
}

// ============================================
// PAQUETE 12: BUSINESS INTELLIGENCE
// ============================================

enum WidgetType {
  kpi
  chart_line
  chart_bar
  chart_pie
  table
  heatmap
}

enum AlertSeverity {
  info
  warning
  critical
}

model BiWidget {
  id                String       @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String?      @db.Text
  tipo              WidgetType
  dataSource        String       // Tipo de dato: "occupancy", "revenue", "payments", etc.
  config            Json         // Configuración específica del widget
  posicion          Int          @default(0)
  activo            Boolean      @default(true)
  creadoPor         String
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([activo])
  @@map("bi_widgets")
}

model BiReport {
  id                String           @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String?          @db.Text
  tipo              String           // "financiero", "ocupacion", "mantenimiento"
  frecuencia        ReportFrequency
  filtros           Json             // Filtros configurables
  columnas          Json             // Columnas a incluir
  ultimaEjecucion   DateTime?
  proximaEjecucion  DateTime?
  activo            Boolean          @default(true)
  emailDestinatarios String[]
  creadoPor         String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@index([companyId])
  @@index([activo])
  @@index([proximaEjecucion])
  @@map("bi_reports")
}

model BiAlert {
  id                String           @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String           @db.Text
  metrica           String           // "occupancy_rate", "payment_delay", etc.
  condicion         String           // "less_than", "greater_than", "equals"
  umbral            Float
  severidad         AlertSeverity    @default(warning)
  activa            Boolean          @default(true)
  ultimaActivacion  DateTime?
  vecesActivada     Int              @default(0)
  emailNotificar    Boolean          @default(true)
  destinatarios     String[]
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@index([companyId])
  @@index([activa])
  @@index([metrica])
  @@map("bi_alerts")
}

model TenantSegment {
  id                String       @id @default(cuid())
  companyId         String
  nombre            String
  descripcion       String?      @db.Text
  criterios         Json         // Criterios de segmentación
  tenantIds         String[]     // IDs de inquilinos en este segmento
  metricasPromedio  Json?        // Métricas promedio del segmento
  totalInquilinos   Int          @default(0)
  activo            Boolean      @default(true)
  ultimaActualizacion DateTime   @default(now())
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([activo])
  @@map("tenant_segments")
}

// ============================================
// PAQUETE 13: GESTIÓN DE ENERGÍA
// ============================================

enum EnergyType {
  electricidad
  agua
  gas
  calefaccion
}

enum AlertType {
  consumo_alto
  consumo_bajo
  incremento_repentino
  fuga_posible
}

model EnergyReading {
  id                String       @id @default(cuid())
  companyId         String
  buildingId        String?
  building          Building?    @relation(fields: [buildingId], references: [id], onDelete: SetNull)
  unitId            String?
  unit              Unit?        @relation(fields: [unitId], references: [id], onDelete: SetNull)
  tipo              EnergyType
  lecturaAnterior   Float?
  lecturaActual     Float
  consumo           Float        // Diferencia entre lecturas
  fechaLectura      DateTime
  periodo           String       // "2024-01", formato año-mes
  costo             Float?
  registradoPor     String
  notas             String?      @db.Text
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([unitId])
  @@index([tipo])
  @@index([fechaLectura])
  @@index([periodo])
  @@map("energy_readings")
}

model EnergyAlert {
  id                String       @id @default(cuid())
  companyId         String
  buildingId        String?
  building          Building?    @relation(fields: [buildingId], references: [id], onDelete: SetNull)
  unitId            String?
  unit              Unit?        @relation(fields: [unitId], references: [id], onDelete: SetNull)
  tipo              EnergyType
  tipoAlerta        AlertType
  titulo            String
  descripcion       String       @db.Text
  consumoActual     Float
  consumoPromedio   Float?
  desviacionPorcentaje Float?
  severidad         String       @default("media")
  fechaDeteccion    DateTime     @default(now())
  resuelta          Boolean      @default(false)
  fechaResolucion   DateTime?
  accionTomada      String?      @db.Text
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([companyId])
  @@index([buildingId])
  @@index([unitId])
  @@index([tipo])
  @@index([resuelta])
  @@map("energy_alerts")
}