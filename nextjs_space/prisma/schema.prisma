generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/homming_vidaro/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum UserRole {
  administrador
  gestor
  operador
}

enum BuildingType {
  residencial
  mixto
  comercial
}

enum UnitType {
  vivienda
  local
  garaje
  trastero
}

enum UnitStatus {
  ocupada
  disponible
  en_mantenimiento
}

enum ContractStatus {
  activo
  vencido
  cancelado
}

enum ContractType {
  residencial
  comercial
  temporal
}

enum PaymentStatus {
  pendiente
  pagado
  atrasado
}

enum RiskLevel {
  bajo
  medio
  alto
}

enum MaintenancePriority {
  alta
  media
  baja
}

enum MaintenanceStatus {
  pendiente
  en_progreso
  programado
  completado
}

enum DocumentType {
  contrato
  dni
  nomina
  certificado_energetico
  ite
  seguro
  factura
  otro
}

enum ExpenseCategory {
  mantenimiento
  impuestos
  seguros
  servicios
  reparaciones
  comunidad
  otro
}

enum NotificationType {
  pago_atrasado
  contrato_vencimiento
  mantenimiento_urgente
  mantenimiento_preventivo
  documento_vencer
  unidad_vacante
  inspeccion_programada
  alerta_sistema
  info
}

enum SituacionLaboral {
  empleado
  autonomo
  estudiante
  jubilado
  desempleado
}

enum EstadoCivil {
  soltero
  casado
  divorciado
  viudo
}

enum CandidateStatus {
  nuevo
  en_revision
  preseleccionado
  aprobado
  rechazado
}

enum IncrementoType {
  porcentaje
  ipc
  fijo
}

enum MessageStatus {
  enviado
  leido
}

enum TemplateType {
  contrato
  email
  recibo
}

model User {
  id            String          @id @default(cuid())
  email         String          @unique
  name          String
  password      String
  role          UserRole        @default(gestor)
  companyId     String
  activo        Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  company       Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  notifications Notification[]

  @@map("users")
}

model Building {
  id                String       @id @default(cuid())
  companyId         String
  nombre            String
  direccion         String
  tipo              BuildingType
  anoConstructor    Int
  numeroUnidades    Int
  estadoConservacion String?
  certificadoEnergetico String?
  ascensor          Boolean      @default(false)
  garaje            Boolean      @default(false)
  trastero          Boolean      @default(false)
  piscina           Boolean      @default(false)
  jardin            Boolean      @default(false)
  gastosComunidad   Float?
  ibiAnual          Float?
  latitud           Float?
  longitud          Float?
  imagenes          String[]     @default([])
  etiquetas         String[]     @default([])
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  company           Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units             Unit[]
  expenses          Expense[]
  documents         Document[]
  maintenanceSchedules MaintenanceSchedule[]

  @@map("buildings")
}

model Tenant {
  id                String            @id @default(cuid())
  companyId         String
  nombreCompleto    String
  dni               String            @unique
  email             String            @unique
  telefono          String
  fechaNacimiento   DateTime
  nacionalidad      String?
  estadoCivil       EstadoCivil?
  numeroOcupantes   Int?
  direccionActual   String?
  situacionLaboral  SituacionLaboral?
  empresa           String?
  puesto            String?
  antiguedad        Int?
  ingresosMensuales Float?
  ratioRentaIngresos Float?
  scoring           Int               @default(50)
  nivelRiesgo       RiskLevel         @default(medio)
  password          String?
  notas             String?           @db.Text
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  units             Unit[]
  contracts         Contract[]
  documents         Document[]
  messagesReceived  Message[]         @relation("MessageRecipient")
  messagesSent      Message[]         @relation("MessageSender")

  @@map("tenants")
}

model Unit {
  id                String     @id @default(cuid())
  numero            String
  buildingId        String
  tipo              UnitType
  estado            UnitStatus @default(disponible)
  superficie        Float
  superficieUtil    Float?
  habitaciones      Int?
  banos             Int?
  planta            Int?
  orientacion       String?
  rentaMensual      Float
  tenantId          String?
  aireAcondicionado Boolean    @default(false)
  calefaccion       Boolean    @default(false)
  terraza           Boolean    @default(false)
  balcon            Boolean    @default(false)
  amueblado         Boolean    @default(false)
  imagenes          String[]   @default([])
  tourVirtual       String?
  planos            String[]   @default([])
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  building          Building   @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  tenant            Tenant?    @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  contracts         Contract[]
  maintenanceRequests MaintenanceRequest[]
  maintenanceSchedules MaintenanceSchedule[]
  expenses          Expense[]
  documents         Document[]
  candidates        Candidate[]

  @@unique([buildingId, numero])
  @@map("units")
}

model Contract {
  id                String         @id @default(cuid())
  unitId            String
  tenantId          String
  fechaInicio       DateTime
  fechaFin          DateTime
  rentaMensual      Float
  diaPago           Int            @default(1)
  deposito          Float
  mesesFianza       Int            @default(1)
  renovacionAutomatica Boolean     @default(false)
  incrementoType    IncrementoType @default(ipc)
  incrementoValor   Float?
  gastosIncluidos   String[]       @default([])
  gastosExcluidos   String[]       @default([])
  clausulasAdicionales String?     @db.Text
  estado            ContractStatus @default(activo)
  tipo              ContractType   @default(residencial)
  contractPdfPath   String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  unit              Unit           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  tenant            Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payments          Payment[]
  documents         Document[]

  @@map("contracts")
}

model Payment {
  id                String        @id @default(cuid())
  contractId        String
  periodo           String
  monto             Float
  fechaVencimiento  DateTime
  fechaPago         DateTime?
  estado            PaymentStatus @default(pendiente)
  metodoPago        String?
  reciboPdfPath     String?
  nivelRiesgo       RiskLevel     @default(bajo)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  contract          Contract      @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model MaintenanceRequest {
  id                String              @id @default(cuid())
  unitId            String
  titulo            String
  descripcion       String              @db.Text
  prioridad         MaintenancePriority @default(media)
  estado            MaintenanceStatus   @default(pendiente)
  fechaSolicitud    DateTime            @default(now())
  fechaProgramada   DateTime?
  fechaCompletada   DateTime?
  providerId        String?
  costoEstimado     Float?
  costoReal         Float?
  fotosProblem      String[]            @default([])
  fotosCompletado   String[]            @default([])
  valoracion        Int?
  comentarios       String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  unit              Unit                @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?           @relation(fields: [providerId], references: [id], onDelete: SetNull)

  @@map("maintenance_requests")
}

model Provider {
  id                String              @id @default(cuid())
  companyId         String
  nombre            String
  tipo              String
  telefono          String
  email             String?
  direccion         String?
  rating            Float?
  notas             String?             @db.Text
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  company           Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  maintenanceRequests MaintenanceRequest[]
  maintenanceSchedules MaintenanceSchedule[]
  expenses          Expense[]

  @@map("providers")
}

model Expense {
  id                String          @id @default(cuid())
  buildingId        String?
  unitId            String?
  providerId        String?
  concepto          String
  categoria         ExpenseCategory
  monto             Float
  fecha             DateTime
  facturaPdfPath    String?
  notas             String?         @db.Text
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  building          Building?       @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  unit              Unit?           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?       @relation(fields: [providerId], references: [id], onDelete: SetNull)

  @@map("expenses")
}

model Document {
  id                String          @id @default(cuid())
  nombre            String
  tipo              DocumentType
  cloudStoragePath  String
  tenantId          String?
  unitId            String?
  buildingId        String?
  contractId        String?
  fechaSubida       DateTime        @default(now())
  fechaVencimiento  DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  tenant            Tenant?         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit              Unit?           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  building          Building?       @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  contract          Contract?       @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model Notification {
  id                String            @id @default(cuid())
  tipo              NotificationType
  titulo            String
  mensaje           String            @db.Text
  leida             Boolean           @default(false)
  prioridad         RiskLevel         @default(bajo)
  fechaLimite       DateTime?
  entityId          String?
  entityType        String?
  userId            String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  user              User?             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Candidate {
  id                String           @id @default(cuid())
  unitId            String
  nombreCompleto    String
  dni               String
  email             String
  telefono          String
  fechaNacimiento   DateTime
  situacionLaboral  SituacionLaboral?
  ingresosMensuales Float?
  scoring           Int              @default(0)
  estado            CandidateStatus  @default(nuevo)
  documentos        String[]         @default([])
  notas             String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  unit              Unit             @relation(fields: [unitId], references: [id], onDelete: Cascade)
  visits            Visit[]

  @@map("candidates")
}

model Visit {
  id                String           @id @default(cuid())
  candidateId       String
  fechaVisita       DateTime
  confirmada        Boolean          @default(false)
  asistio           Boolean?
  feedback          String?          @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  candidate         Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@map("visits")
}

model Message {
  id                String           @id @default(cuid())
  senderId          String
  recipientId       String
  asunto            String
  mensaje           String           @db.Text
  estado            MessageStatus    @default(enviado)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  sender            Tenant           @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  recipient         Tenant           @relation("MessageRecipient", fields: [recipientId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Template {
  id                String           @id @default(cuid())
  nombre            String
  tipo              TemplateType
  contenido         String           @db.Text
  variables         String[]         @default([])
  activo            Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("templates")
}

model Company {
  id                String           @id @default(cuid())
  nombre            String           @default("INMOVA")
  cif               String?
  direccion         String?
  telefono          String?
  email             String?
  logoUrl           String?
  codigoPostal      String?
  ciudad            String?
  pais              String           @default("Espa√±a")
  iban              String?
  colorPrimario     String?          @default("#000000")
  colorSecundario   String?          @default("#FFFFFF")
  pieDocumento      String?          @db.Text
  activo            Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  users             User[]
  buildings         Building[]
  tenants           Tenant[]
  providers         Provider[]

  @@map("company")
}

enum RecurrenceFrequency {
  mensual
  trimestral
  semestral
  anual
}

model MaintenanceSchedule {
  id                String                @id @default(cuid())
  titulo            String
  descripcion       String                @db.Text
  tipo              String
  buildingId        String?
  unitId            String?
  frecuencia        RecurrenceFrequency
  proximaFecha      DateTime
  ultimaFecha       DateTime?
  diasAnticipacion  Int                   @default(15)
  activo            Boolean               @default(true)
  providerId        String?
  costoEstimado     Float?
  notas             String?               @db.Text
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  building          Building?             @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  unit              Unit?                 @relation(fields: [unitId], references: [id], onDelete: Cascade)
  provider          Provider?             @relation(fields: [providerId], references: [id], onDelete: SetNull)

  @@map("maintenance_schedules")
}
